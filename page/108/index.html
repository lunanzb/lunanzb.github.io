<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客">
<meta property="og:url" content="https://luna.newban.cn/page/108/index.html">
<meta property="og:site_name" content="开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://luna.newban.cn/page/108/">





  <title>开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者的博客 – 全栈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="http://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cNTLMSSO多个IIS但具有相同的域控制器堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cNTLMSSO多个IIS但具有相同的域控制器堆栈内存溢出.html" itemprop="url">cNTLMSSO多个IIS但具有相同的域控制器堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
NTLM SSO multiple IIS but same domain controller



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在考虑实施单点登录...


这是我的情况：


我有一个域控制器和多个应用程序服务器（IIS + ASP.NET）。 他们具有NTLM身份验证。


因此，当我必须在一个应用程序与另一个应用程序之间通过Intranet切换时，我需要重新输入登录名和密码。


有什么方法可以实现单点登录NTLM并与所有应用程序共享会话？ 在ASP.NET/C# + AJAX中


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cNETCoreWebAPI中具有applicationxwwwformurlencoded内容类型但XML主体的请求处理堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cNETCoreWebAPI中具有applicationxwwwformurlencoded内容类型但XML主体的请求处理堆栈内存溢出.html" itemprop="url">cNETCoreWebAPI中具有applicationxwwwformurlencoded内容类型但XML主体的请求处理堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Handle Request with application/x-www-form-urlencoded content-type but XML body in NET Core Web API



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我有一个.NET Core 2.1 Web API控制器和方法，应该通过HTTP使用来自外部服务的POST XML请求。 以下是控制器操作的方法标头。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[HttpPost] [Produces(&quot;application/xml&quot;)] public async Task&lt;IActionResult&gt; PostReceivedMessage([FromBody] ReceivedMessage receivedMessage)</span><br></pre></td></tr></table></figure>


我编写了一个自定义XML输入格式化程序来处理XML请求，当我将示例XML请求从Postman发布到应用程序的控制器操作时，该请求就可以正常工作。 但是，当服务发送类似请求时，来自应用程序的响应状态为400，即错误请求。


经过一些调试后，我发现请求来自


内容类型：application / x-www-form-urlencoded


而不是人们可能期望的application / xml或text / xml。 如果我更改标题以匹配外部服务发送的请求中的内容类型，则应用程序也会表现出相同的行为。


我假设x-www-form-urlencoded用于表单数据，因为当我将操作标头更改为以下内容时，模型绑定不起作用：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public async Task&lt;IActionResult&gt; PostReceivedMessage([FromForm] ReceivedMessage receivedMessage)</span><br></pre></td></tr></table></figure>


由于我无法控制外部服务，因此如何使控制器动作能够处理以x-www-form-urlencoded为内容类型的XML请求？


更新：下面是一个示例请求：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /check/api/receivedmessages HTTP/1.1 Cache-Control: no-cache Pragma: no-cache User-Agent: Java/1.7.0_45 Host: xxx.xxx.xxx.xxx Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2 Connection: keep-alive Content-type: application/x-www-form-urlencoded Content-Length: 270 &lt;Request&gt;&lt;requestId&gt;95715274355861000&lt;/requestId&gt;&lt;msisdn&gt;345678955041&lt;/msisdn&gt;&lt;timeStamp&gt;2019/10/20 02:23:55&lt;/timeStamp&gt;&lt;keyword&gt;MO&lt;/keyword&gt;&lt;dataSet&gt;&lt;param&gt;&lt;id&gt;UserData&lt;/id&gt;&lt;value&gt;VHVqrA==&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;id&gt;DA&lt;/id&gt;&lt;value&gt;555&lt;/value&gt;&lt;/param&gt;&lt;/dataSet&gt;&lt;/Request&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

获取字符串并将xml字符串转换为C＃对象很简单：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> [HttpPost]</span><br><span class="line">[Produces(&quot;application/xml&quot;)]      </span><br><span class="line">public async Task&lt;IActionResult&gt; PostReceivedMessage([FromForm]string receivedMessage)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        XmlSerializer serializer = new XmlSerializer(typeof(ReceivedMessage));</span><br><span class="line">        ReceivedMessage data;</span><br><span class="line">        using (TextReader reader = new StringReader(receivedMessage))</span><br><span class="line">        &#123;</span><br><span class="line">             data = (ReceivedMessage)serializer.Deserialize(reader);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return Ok(data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0 已采纳</strong></p>

我最终接受了评论中提供的@Xing Zou建议，并实现了自定义模型活页夹。 我不确定这是否太过分了，但至少可以使控制器动作保持“精简”状态。 自定义模型联编程序如下所示： 现在已将模型装饰到，以便可以使用自定义模型绑定程序绑定到它。 要注意的一件事。 外部服务发送的XML包含以base64编码的值。 这意味着有两个“ =”符号，我的猜测是这导致正文被解释为具有1个键和1个值的形式。 例如： 因此，造成我的模型绑定器笨拙地将请求主体提取到字符串中的原因。 我想如果不是这种情况，可以通过仅读取表单中的第一个（也是唯一的键）来获取主体。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">public class ReceivedMessageEntityBinder : IModelBinder</span><br><span class="line">   &#123;</span><br><span class="line">       public Task BindModelAsync(ModelBindingContext bindingContext)</span><br><span class="line">       &#123;</span><br><span class="line">           if (bindingContext == null)</span><br><span class="line">           &#123;</span><br><span class="line">               throw new ArgumentNullException(nameof(bindingContext));</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           var request = bindingContext.HttpContext.Request;</span><br><span class="line"></span><br><span class="line">           var firstKey = request.Form.Keys.First();</span><br><span class="line">           StringValues formValue = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">           request.Form.TryGetValue(firstKey, out formValue);</span><br><span class="line"></span><br><span class="line">           var requestBody = firstKey + &quot;=&quot; + formValue;</span><br><span class="line"></span><br><span class="line">           bindingContext.Result = ModelBindingResult.Success(FromXmlString(requestBody));</span><br><span class="line"></span><br><span class="line">           return Task.CompletedTask;  </span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private ReceivedMessage FromXmlString(string requestBody)</span><br><span class="line">       &#123;</span><br><span class="line">           XElement request = XElement.Parse(requestBody);</span><br><span class="line"></span><br><span class="line">           var receivedMessage = new ReceivedMessage();</span><br><span class="line"></span><br><span class="line">           receivedMessage.RequestId = (string)</span><br><span class="line">                                       (from el in request.Descendants(&quot;requestId&quot;)</span><br><span class="line">                                        select el).First();</span><br><span class="line"></span><br><span class="line">           receivedMessage.Msisdn = (string)</span><br><span class="line">                                       (from el in request.Descendants(&quot;msisdn&quot;)</span><br><span class="line">                                        select el).First();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           receivedMessage.Timestamp = DateTime.Parse(</span><br><span class="line">                                       (string)</span><br><span class="line">                                       (from el in request.Descendants(&quot;timeStamp&quot;)</span><br><span class="line">                                        select el).First());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           receivedMessage.Keyword = (string)</span><br><span class="line">                                       (from el in request.Descendants(&quot;keyword&quot;)</span><br><span class="line">                                        select el).First();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           IEnumerable&lt;XElement&gt; dataSet = from el in request.Descendants(&quot;param&quot;)</span><br><span class="line">                                           select el;</span><br><span class="line"></span><br><span class="line">           foreach (var param in dataSet)</span><br><span class="line">           &#123;</span><br><span class="line">               var firstNode = param.Descendants().First();</span><br><span class="line"></span><br><span class="line">               switch (firstNode.Value)</span><br><span class="line">               &#123;</span><br><span class="line">                   case &quot;UserData&quot;:</span><br><span class="line">                       receivedMessage.UserData = (firstNode.NextNode as XElement).Value;</span><br><span class="line">                       break;</span><br><span class="line"></span><br><span class="line">                   case &quot;DA&quot;:</span><br><span class="line">                       receivedMessage.Da = (firstNode.NextNode as XElement).Value;</span><br><span class="line">                       break;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           return receivedMessage;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cNETCore2x中的默认会话到期时间是多少堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cNETCore2x中的默认会话到期时间是多少堆栈内存溢出.html" itemprop="url">cNETCore2x中的默认会话到期时间是多少堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
What is the default session expiry in .NET Core 2.x?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
在我的启动类中，我使用此行启用会话存储：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddDistributedMemoryCache() .AddSession(options =&gt; &#123; options.IdleTimeout = TimeSpan.FromMinutes(20); options.Cookie.HttpOnly = true; &#125;)</span><br></pre></td></tr></table></figure>


但是，如果我理解正确，那么设置IdleTimeout属性只会说明如果用户未完成任何操作超过20分钟，会话将重新开始。 我的应用程序有轮询，每5-10秒在会话存储中使用用户信息，所以我认为这不会在这里使用。 用户权限和角色可以从当前用户浏览器之外的操作更改，因此我希望将会话存储限制为1分钟。 我似乎无法找到关于默认过期是什么或如何正确设置它的任何确切的措辞。


CookieBuilder类有Expiration和MaxAge选项，但我不知道哪一个是必需的。 我还读到Expiration被忽略了 ，所以这给我在这个主题上的困惑增加了更多。


更新：当我尝试设置过期时收到此消息：“无法为SessionOption定义的cookie设置过期”，因此我将MaxAge设置为1分钟，但我可以看到会话仍然具有旧的用户数据超过1分钟过去了。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：2</strong></p>

会话没有像cookie那样的“到期”，但默认的空闲超时是20分钟，可以使用IdleTimeout选项进行调整。 会话仅在空闲超时时间结束后到期。 此外，空闲超时在收到最后一个请求后开始。 对于您的情况，会话将不会过期，因为您每隔5-10秒轮询一次（检查会话数据）。 此轮询被视为对.net核心的“请求”，并重置超时。 您可以通过禁用轮询来验证这一点，并使用检查会话数据的按钮创建页面。 等待一段时间（例如：20秒），然后单击按钮。 确保将空闲超时设置为较低的值： 以下是会话文档的链接。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options.IdleTimeout = TimeSpan.FromSeconds(10);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../css引导程序无法使用webpack工作堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../css引导程序无法使用webpack工作堆栈内存溢出.html" itemprop="url">css引导程序无法使用webpack工作堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
bootstrap not workin using webpack



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
即时通讯与Webpack一起使用引导程序，但是当我运行我的应用程序时，没有引导程序也没有CSS！


这是我的webpack.config.js：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;); const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;); const &#123; CleanWebpackPlugin &#125; = require(&apos;clean-webpack-plugin&apos;); const ManifestPlugin = require(&apos;webpack-manifest-plugin&apos;); const UglifyJsPlugin = require(&apos;uglifyjs-webpack-plugin&apos;); var OptimizeCSSAssetsPlugin = require(&apos;optimize-css-assets-webpack-plugin&apos;); const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;); module.exports = &#123; // mode: &apos;production&apos;, entry: &apos;./src/index.js&apos;, output: &#123; path: path.resolve(__dirname, &apos;build&apos;), publicPath: &apos;&apos;, filename: &apos;bundle.js&apos; &#125;, devServer: &#123; contentBase: path.join(__dirname, &apos;./build&apos;), compress: true, port: 3000 &#125;, performance: &#123; maxEntrypointSize: 512000, maxAssetSize: 512000 &#125;, module: &#123; rules: [ &#123; test: /\.s?css$/, use: [ &#123; loader: &quot;file-loader&quot;, options: &#123; name: &quot;[name].css&quot; &#125; &#125;, &#123; loader: &quot;extract-loader&quot; &#125;, &#123; loader: &quot;css-loader&quot;, &#125;, &#123; loader: &quot;sass-loader&quot; &#125; ] &#125;, &#123; test: /\.(js|jsx)$/, exclude: /node_modules/, use: &#123; loader: &quot;babel-loader&quot; &#125; &#125;, &#123; test: /\.(png|svg|jpg|gif)$/, use: [&quot;file-loader&quot;] &#125;, &#123; test: /\.(woff(2)?|ttf|otf|eot|svg)(\?v=\d+\.\d+\.\d+)?$/, use: [ &#123; loader: &apos;file-loader&apos;, options: &#123; name: &apos;[name].[ext]&apos;, outputPath: &apos;fonts/&apos; &#125; &#125; ] &#125; ] &#125;, //remove comments from JS files optimization: &#123; minimizer: [ new UglifyJsPlugin(&#123; uglifyOptions: &#123; output: &#123; comments: false, &#125;, &#125;, &#125;), new OptimizeCSSAssetsPlugin(&#123; cssProcessorPluginOptions: &#123; preset: [&apos;default&apos;, &#123; discardComments: &#123; removeAll: true &#125; &#125;], &#125; &#125;) ], &#125;, plugins: [ new MiniCssExtractPlugin(&#123; filename: &quot;[name].css&quot; &#125;), new ManifestPlugin(), new CleanWebpackPlugin(), new HtmlWebpackPlugin(&#123; template: path.resolve(&apos;./public/index.html&apos;), &#125;), ] &#125;;</span><br></pre></td></tr></table></figure>


我在浏览器控制台中遇到这种错误：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught Error: Module build failed (from ./node_modules/mini-css-extract-plugin/dist/loader.js): ModuleBuildError: Module build failed (from ./node_modules/css-loader/dist/cjs.js): CssSyntaxError (192:1) Unknown word</span><br></pre></td></tr></table></figure>


请问有什么身体可以帮我吗，我真的不知道这个错误来自哪里


预先感谢您的帮助


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

下面是两个版本的dev / prod以及您可以在此处看到的所有代码： webpack-boilerplate 开发人员： 产品：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  test: /\.(css|sass|scss)$/,</span><br><span class="line">  use: [</span><br><span class="line">    &apos;style-loader&apos;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: &apos;css-loader&apos;,</span><br><span class="line">      options: &#123;</span><br><span class="line">        importLoaders: 2,</span><br><span class="line">        sourceMap: true</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: &apos;sass-loader&apos;,</span><br><span class="line">      options: &#123;</span><br><span class="line">        sourceMap: true,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c在每个请求中新会话在Webapi中生成堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c在每个请求中新会话在Webapi中生成堆栈内存溢出.html" itemprop="url">c在每个请求中新会话在Webapi中生成堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
In Every Request New Session is Generating in the web api



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
每当一个新的请求在控制器中被命中时，新的会话ID就会在那时产生，所以我会丢失先前的值。


使用.net Core API 2.2.0


“Startup.cs”


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.Configure&lt;CookiePolicyOptions&gt;(options =&gt; &#123; // This lambda determines whether user consent for non-essential cookies is needed for a given request. options.CheckConsentNeeded = context =&gt; false; // Default is true, make it false options.MinimumSameSitePolicy = SameSiteMode.None; &#125;); services.AddDistributedMemoryCache(); services.AddSession();</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

看起来你正在处理一个API。 如果我猜的话，你不及格的Cookie头与每个请求，使用该服务器通过最初返回的值Set-Cookie响应头。 Web浏览器会自动为Web应用程序请求处理此类事物。 但是，API是一个不同的包，你需要手动完成。 也就是说，API 应该是无状态的，因此通常不支持会话和/或cookie的想法。 你不应该利用Session与API项目，在所有。 每个请求都应包含服务该请求所需的所有数据。 否则，您将在API中引入各种问题。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c在桌面复制API中获取帧之间的CPU使用率高具有不同的超时间隔堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c在桌面复制API中获取帧之间的CPU使用率高具有不同的超时间隔堆栈内存溢出.html" itemprop="url">c在桌面复制API中获取帧之间的CPU使用率高具有不同的超时间隔堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
High CPU usage, with different timeouts interval, between frames acquiring in Desktop Duplication API



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在尝试以16 毫秒的超时时间来捕获屏幕，在全屏4k 60fps视频上测试捕获时，我的帧速为60-65 FPS 。 在这种情况下，CPU使用率约为0-1％ 。 但是，当鼠标光标在屏幕上移动时，FPS和CPU使用率分别提高了100+帧和25-30％ 。 所以，有一个问题：如果超时设置为16，为什么我的FPS大于70？


如果超时设置为0：使用相同的值捕获FPS的数量 ，但即使屏幕上显示静态图像， CPU使用率也保持稳定在20-30％ 。 在这种情况下，超时错误的数量会大大增加。 这是否在某种程度上与先前的问题？


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">do &#123; hr = lDeskDupl-&gt;AcquireNextFrame( TimeoutMS, &amp;lFrameInfo, &amp;lDesktopResource); if (SUCCEEDED(hr)) &#123; accumFramesCount += lFrameInfo.AccumulatedFrames; break; &#125; if (hr == DXGI_ERROR_INVALID_CALL) &#123; lDeskDupl-&gt;ReleaseFrame(); &#125; if (hr == DXGI_ERROR_WAIT_TIMEOUT) &#123; timeoutsCount++; &#125; &#125; while (true);</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

答案在AcquireNextFrame文档中： 当操作系统更新桌面位图图像或更改硬件指针的形状或位置时， AcquireNextFrame获取一个新的桌面框架。 AcquireNextFrame获取的新框架可能仅更新了桌面图像，仅更新了指针形状或位置，或同时更新了两者 。 当您移动鼠标时，您会在超时之前从桌面复制API获得更新。 这样，您的更新量将超过超时值所暗示的数量。 对于异常高的CPU负载，很可能是API出现了问题：是的，没有明显的原因，鼠标移动与CPU过度消耗相关。 也许是一些自旋锁相关的问题。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../css标记为空时防止XML列崩溃堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../css标记为空时防止XML列崩溃堆栈内存溢出.html" itemprop="url">css标记为空时防止XML列崩溃堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Prevent XML column from collapsing when tag is empty



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我有一个格式化的XML表。 当标签为空时，该列会折叠，随后的列将打印到该空间中，从而弄乱了列格式。


XSL文件具有一系列列的样式，如下所示：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.drawingrev &#123; float: left; width: 0.8in; text-align:center; &#125;</span><br></pre></td></tr></table></figure>


显示每一列的数据：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;drawingrev&quot;&gt;&lt;xsl:value-of select=&quot;Obj_RevisionNumber&quot;/&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>


如果value of为空，则条目折叠，并将下一个数据写入该空间。


在寻找合适的设置来保留空间方面，我将不胜感激，


谢谢！


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

如果您使用CSS 并将您的课程更改为 然后确保div s的class="drawingrev"有一个父div class="drawing-container" ，在CSS柔性盒布局应该只是确保你平等的布局div S，他们是否有内容或不：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> .drawing-container &#123;</span><br><span class="line">  display: flex; </span><br><span class="line">  flex-wrap: wrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../css跨平台Windows和OSX的样式差异堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../css跨平台Windows和OSX的样式差异堆栈内存溢出.html" itemprop="url">css跨平台Windows和OSX的样式差异堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Difference in styles across platforms (Windows and OSX)



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我在react中有一张antd表，但是它的样式在各个平台（Windows和OSX）上都不同。 分隔两行的底线在Windows上并不完全正确，而在OSX上则完全不同。 我已附上一张图片，显示它在Windows计算机上的显示方式。


有没有人遇到过类似的问题？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

似乎自定义高度已应用于第三和第四列-删除该高度或将其设置为自动可能会解决问题。 如果可能，请共享css和html代码段。

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

您在两个平台上都使用相同的浏览器吗？ 它是细胞的边界吗？ 我认为您需要将相同的CSS应用于所有单元格，且min-width和max-width或仅固定width 。 注意：也请查看您的padding ，这可能是问题所在。

<p><strong>===============&gt;&gt;#3 票数：0</strong></p>

您是否尝试过Normalize.css或reset.css来提高跨浏览器的一致性？ 我曾经在safari / firefox浏览器中遇到过一些问题，但在chrome中我的布局很好。 因此，我使用reset.css消除了不一致之处。 index.css （当OP尚未说明在跨平台使用相同的浏览器或使用不同的浏览器时问题是否仍然存在时，我发布了此答案） PS：使用reset.css或Normalize.css


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> @import url(&quot;./reset.css&quot;); /* path to reset.css */</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">/* rest of your code */</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cstdcin和stdgetline的问题堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cstdcin和stdgetline的问题堆栈内存溢出.html" itemprop="url">cstdcin和stdgetline的问题堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Problems with std::cin and std:.getline



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
你好[对不起我的英语不好]


我已经用C ++用Winsock编写了一个小型网卡游戏（控制台应用程序）。 基本上，程序执行以下方式：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1) Open Socket and wait for a peer to connect 2) If connected -&gt; start game 3) If its your turn -&gt; decide which action should be taken next and type it in 3.1) If its not your turn -&gt; wait for your peers decision</span><br></pre></td></tr></table></figure>


当用户等待时，他们可以在控制台中键入一些内容（实际上在键入时不会打印出来）。 如果用户轮到他，可能会出现三种结果：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1) The user inputs only valid data -&gt; program runs fine 2) The user inputs trash while waiting but doesnt press enter (no \n) 3) The user inputs trash while waiting and does press enter (\n)</span><br></pre></td></tr></table></figure>


在情况2）和3）中，我遇到了一个大问题：由于输入缓冲区中似乎还剩下一些输入，因此我对std :: getline的调用（以获取用户输入）占用了用户先前输入的垃圾。


示例：我启动程序并等待其他用户加入我的游戏。 等待期间，我在控制台中输入“ abc”，然后按Enter。 另一个用户加入了游戏。 在完成一些设置工作之后，程序应该接受我的输入，以便我可以决定下一步要执行的操作。 但这不会发生。 首先，'abc'被打印在屏幕上，其次该程序不等待我的输入，因为它使用'abc'作为std :: getline调用的输入。


这是重现我的“问题”的代码示例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main() &#123; std::string str; std::cout &lt;&lt; &quot;Before sleep&quot;; std::this_thread::sleep_for(5s); std::cin.ignore(std::numeric_limits&lt;std::streamsize&gt;::max()); std::cin.clear(); std::getline(std::cin, str); &#125;</span><br></pre></td></tr></table></figure>


我使用this_thread :: sleep_for（5s）模拟了“等待”。 在等待期间，您可以输入垃圾，并根据您的输入在5秒后将其打印出来，并等待更多输入，或者如果您不使用std :: cin.ignore和std :: cin.clear则结束程序。


std :: ignore（）和std :: clear似乎不按照我认为的工作方式工作（清除输入缓冲区并重置std :: cin状态标志）


我的问题：


1）如何在获得用户输入之前清空输入缓冲区？


2）为什么控制台会打印我的输入？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

在“ cin”语句后使用“ std :: cin.ignore（std :: numeric_limits :: max（），'\\ n'）;”会丢弃输入流中的所有内容，包括换行符。 这是我的代码： 我在等待时间内输入“ ASD”，并在等待时间过后打印“ ASD”。 然后，我继续输入字符，仅输出稍后输入的字符。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> int main()</span><br><span class="line">&#123;</span><br><span class="line">    std::string str;</span><br><span class="line">    std::cout &lt;&lt; &quot;Before sleep\n&quot;;</span><br><span class="line"></span><br><span class="line">    ……//Simulate wait time</span><br><span class="line"></span><br><span class="line">    std::string str1;</span><br><span class="line">    std::cin &gt;&gt; str1;</span><br><span class="line">    std::cin.ignore(std::numeric_limits&lt;std::streamsize&gt;::max(),&apos;\n&apos;);  </span><br><span class="line">    std::getline(std::cin, str);</span><br><span class="line">    std::cout &lt;&lt; str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cstdofstream不写入文件堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cstdofstream不写入文件堆栈内存溢出.html" itemprop="url">cstdofstream不写入文件堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
std::ofstream not writing to file



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在尝试编写一个记录击键的简单程序。 该代码的问题摘要如下。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::ofstream of; of.open(file_name.c_str(), std::ofstream::out | std::ofstream::app); if (!of) &#123; std::cerr &lt;&lt; &quot;can&apos;t open output file&quot; &lt;&lt; std::endl; &#125; while (1) &#123; for (char i = 0; i &lt; 127; i++) &#123; if (GetAsyncKeyState(i) == -32767) &#123; // this is not writing to the file! of &lt;&lt; i; &#125; &#125; &#125; //close file of.close();</span><br></pre></td></tr></table></figure>


当我检查文件时，它完全是空的。 如果我将条件GetAsyncKeyState（i）== -32767替换为true，那么实际上我在文件中得到了一些文本。 如果我返回使用较旧的C风格文件编写代码，则它可以正常工作。 但是，我真的必须知道为什么它不能正常运行。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1 已采纳</strong></p>

由于您使用的是std::ofstream ，我的猜测是您的数据已缓冲并且没有提交给输出文件。 首先，您应该了解of << i; 会将数据插入流中，实际上不负责将数据写入输出文件。 因此，您应该将数据显式写入硬盘。 一种方法是使用of.close(); 缓冲之后，但是由于您处于无限循环中，并且可能不想每次迭代都调用close()并再次重新打开文件，因此最好的方法是使用flush()函数。 basic_ostream＆flush（）：将未提交的更改写入基础输出序列。 请注意， basic_ostream是basic_ofstream的父类 因此，您的代码将发生如下变化：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> while (1) &#123;</span><br><span class="line">    for (char i = 0; i &lt; 127; i++) &#123;</span><br><span class="line">        if (GetAsyncKeyState(i) == -32767) &#123;</span><br><span class="line">            of &lt;&lt; i;</span><br><span class="line">            of.flush();  // Add this line to commit your buffer to output file.</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

抱歉，我不能发表评论。 我没有足够的声誉:( 因此，我必须提出一种解决方案来帮助您。 我已经测试了您的程序，并且可以在Visual Studio 2015-Windows SDK 10.0.17763.0中运行 三个执行后，我已经用NotePad ++打开了文件，这就是内容。 也许内容没有写入文件，因为它已被缓冲并且您 突然关闭程序。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> #include &lt;iostream&gt;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    string file_name = &quot;out.txt&quot;;</span><br><span class="line"></span><br><span class="line">    std::ofstream of;</span><br><span class="line">    of.open(file_name.c_str(), std::ofstream::out | std::ofstream::app);</span><br><span class="line">    if (!of) &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;can&apos;t open output file&quot; &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    while (1) &#123;</span><br><span class="line">        for (char i = 0; i &lt; 127; i++) &#123;</span><br><span class="line">            if (GetAsyncKeyState(i) == -32767) &#123;</span><br><span class="line">                // this is not writing to the file!</span><br><span class="line">                of &lt;&lt; i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //close file</span><br><span class="line">    of.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../107/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../107/">107</a><span class="page-number current">108</span><a class="page-number" href="../109/">109</a><span class="space">&hellip;</span><a class="page-number" href="../173/">173</a><a class="extend next" rel="next" href="../109/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="http://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">1724</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
