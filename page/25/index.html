<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客">
<meta property="og:url" content="https://luna.newban.cn/page/25/index.html">
<meta property="og:site_name" content="开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://luna.newban.cn/page/25/">





  <title>开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者的博客 – 全栈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="http://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c如何在C中创建复杂的XML结构堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c如何在C中创建复杂的XML结构堆栈内存溢出.html" itemprop="url">c如何在C中创建复杂的XML结构堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
How to Create complex XML structure in C#



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
在我的应用程序中，我必须使用PayGate API来处理在线支付。


请求必须采用以下格式：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;SOAP-ENV:Header/&gt; &lt;SOAP-ENV:Body&gt; &lt;SinglePaymentRequest xmlns=&quot;http://www.paygate.co.za/PayHOST&quot;&gt; &lt;CardPaymentRequest&gt; &lt;Account&gt; &lt;PayGateId&gt;10011072130&lt;/PayGateId&gt; &lt;Password&gt;test&lt;/Password&gt; &lt;/Account&gt; &lt;Customer&gt; &lt;Title&gt;Mr&lt;/Title&gt; &lt;FirstName&gt;Joe&lt;/FirstName&gt; &lt;LastName&gt;Soap&lt;/LastName&gt; &lt;Telephone&gt;0861234567&lt;/Telephone&gt; &lt;Mobile&gt;0735552233&lt;/Mobile&gt; &lt;Email&gt;joe@soap.com&lt;/Email&gt; &lt;/Customer&gt; &lt;CardNumber&gt;4000000000000002&lt;/CardNumber&gt; &lt;CardExpiryDate&gt;122020&lt;/CardExpiryDate&gt; &lt;CVV&gt;999&lt;/CVV&gt; &lt;BudgetPeriod&gt;0&lt;/BudgetPeriod&gt; &lt;Redirect&gt; &lt;NotifyUrl&gt;https://www.mytestsite.com/notify&lt;/NotifyUrl&gt; &lt;ReturnUrl&gt;https://www.mytestsite.com/return&lt;/ReturnUrl&gt; &lt;/Redirect&gt; &lt;Order&gt; &lt;MerchantOrderId&gt;INV101&lt;/MerchantOrderId&gt; &lt;Currency&gt;ZAR&lt;/Currency&gt; &lt;Amount&gt;100&lt;/Amount&gt; &lt;/Order&gt; &lt;/CardPaymentRequest&gt; &lt;/SinglePaymentRequest&gt; &lt;/SOAP-ENV:Body&gt; &lt;/SOAP-ENV:Envelope&gt;</span><br></pre></td></tr></table></figure>


我正在尝试使用C＃中的XElement类来创建此结构，但是每个在它们前面包含单词：“ SOAP-ENV：”的标记都不会正确解析。


这是我的功能：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private string ParseCardRequestToXml() &#123; XNamespace soapEnv = &quot;SOAP-ENV&quot;; XNamespace spReq = &quot;http://www.paygate.co.za/PayHOST&quot;; //Envelope XElement xmlEnvlelope = new XElement(soapEnv + &quot;Envelope&quot;, new XAttribute(XNamespace.Xmlns + &quot;SOAP-ENV&quot;, &quot;http://schemas.xmlsoap.org/soap/envelope/&quot;)); //Header XElement xmlHeader = new XElement(soapEnv + &quot;Header&quot;); //Body element XElement xmlBody = new XElement(&quot;Body&quot;); //SinglePaymentRequest XElement xmlSinglePaymentRequest = new XElement(spReq + &quot;SinglePaymentRequest&quot;); //CardPaymentRequest XElement xmlCardPaymentRequest = new XElement(&quot;CardPaymentRequest&quot;); //Account XElement xmlAccount = new XElement(&quot;Account&quot;); xmlAccount.Add(new XElement(&quot;PayGateId&quot;, &quot;10011072130&quot;)); xmlAccount.Add(new XElement(&quot;Password&quot;, &quot;test&quot;)); //Add account to &quot;CardPaymentRequest&quot; tag xmlCardPaymentRequest.Add(xmlAccount); //Customer XElement xmlCustomer = new XElement(&quot;Customer&quot;); xmlCustomer.Add(new XElement(&quot;Title&quot;, &quot;Mr&quot;)); xmlCustomer.Add(new XElement(&quot;FirstName&quot;, &quot;Joe&quot;)); xmlCustomer.Add(new XElement(&quot;LastName&quot;, &quot;Soap&quot;)); xmlCustomer.Add(new XElement(&quot;Telephone&quot;, &quot;0861234567&quot;)); xmlCustomer.Add(new XElement(&quot;Mobile&quot;, &quot;0735552233&quot;)); xmlCustomer.Add(new XElement(&quot;Email&quot;, &quot;joe@soap.com&quot;)); //Add customer to &quot;CardPaymentRequest&quot; tag xmlCardPaymentRequest.Add(xmlCustomer); //Add Card info to &quot;CardPaymentRequest&quot; tag xmlCardPaymentRequest.Add(new XElement(&quot;CardNumber&quot;, &quot;4000000000000002&quot;)); xmlCardPaymentRequest.Add(new XElement(&quot;CardExpiryDate&quot;, &quot;122020&quot;)); xmlCardPaymentRequest.Add(new XElement(&quot;CVV&quot;, 999)); xmlCardPaymentRequest.Add(new XElement(&quot;BudgetPeriod&quot;, 0)); //Redirect XElement xmlRedirect = new XElement(&quot;Redirect&quot;); xmlRedirect.Add(new XElement(&quot;NotifyUrl&quot;, &quot;https://www.mytestsite.com/notify&quot;)); xmlRedirect.Add(new XElement(&quot;ReturnUrl&quot;, &quot;https://www.mytestsite.com/return&quot;)); //Add redirect to &quot;CardPaymentRequest&quot; tag xmlCardPaymentRequest.Add(xmlRedirect); //Order XElement xmlOrder = new XElement(&quot;Order&quot;); xmlOrder.Add(new XElement(&quot;MerchantOrderId&quot;, &quot;INV101&quot;)); xmlOrder.Add(new XElement(&quot;Currency&quot;, &quot;ZAR&quot;)); xmlOrder.Add(new XElement(&quot;Amount&quot;, 100)); //Add order to &quot;CardPaymentRequest&quot; tag xmlCardPaymentRequest.Add(xmlOrder); xmlSinglePaymentRequest.Add(xmlCardPaymentRequest); xmlBody.Add(xmlSinglePaymentRequest); xmlEnvlelope.Add(xmlHeader); xmlEnvlelope.Add(xmlBody); return xmlEnvlelope.ToString(); &#125;</span><br></pre></td></tr></table></figure>


这是我得到的结果：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Envelope xmlns:SOAP-ENV=\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot; xmlns=\&quot;SOAP-ENV\&quot;&gt; &lt;Header /&gt; &lt;Body xmlns=\&quot;\&quot;&gt; &lt;SinglePaymentRequest xmlns=\&quot;http://www.paygate.co.za/PayHOST\&quot;&gt; &lt;CardPaymentRequest xmlns=\&quot;\&quot;&gt; &lt;Account&gt; &lt;PayGateId&gt;10011072130&lt;/PayGateId&gt; &lt;Password&gt;test&lt;/Password&gt; &lt;/Account&gt; &lt;Customer&gt; &lt;Title&gt;&lt;/Title&gt; &lt;FirstName&gt;Joe&lt;/FirstName&gt; &lt;LastName&gt;Soap&lt;/LastName&gt; &lt;Telephone&gt;0861234567&lt;/Telephone&gt; &lt;Mobile&gt;0735552233&lt;/Mobile&gt; &lt;Email&gt;joe@soap.com&lt;/Email&gt; &lt;/Customer&gt; &lt;CardNumber&gt;4000000000000002&lt;/CardNumber&gt; &lt;CardExpiryDate&gt;122020&lt;/CardExpiryDate&gt; &lt;CVV&gt;999&lt;/CVV&gt; &lt;BudgetPeriod&gt;0&lt;/BudgetPeriod&gt; &lt;Redirect&gt; &lt;NotifyUrl&gt;https://www.mytestsite.com/notify&lt;/NotifyUrl&gt; &lt;ReturnUrl&gt;https://www.mytestsite.com/return&lt;/ReturnUrl&gt; &lt;/Redirect&gt; &lt;Order&gt; &lt;MerchantOrderId&gt;INV101&lt;/MerchantOrderId&gt; &lt;Currency&gt;ZAR&lt;/Currency&gt; &lt;Amount&gt;100&lt;/Amount&gt; &lt;/Order&gt; &lt;/CardPaymentRequest&gt; &lt;/SinglePaymentRequest&gt; &lt;/Body&gt; &lt;/Envelope&gt;</span><br></pre></td></tr></table></figure>


根据Microsoft的本指南，我使用了XNamespace类，但是我似乎错过了一些东西。 编辑：在该示例中，make变量XNamespace aw可是我不能创建这样的变量，因为不允许在命名中使用“-”。


编辑2：好的，所以我去尝试使用StringBuilder建立请求。


这是功能：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private string GetDemoCardRequestXML() &#123; StringBuilder builder = new StringBuilder(); builder.Append(&quot;&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;).Append(&apos;&quot;&apos;).Append(&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;).Append(&apos;&quot;&apos;).Append(&quot;&gt;&quot;); builder.Append(&quot;&lt;SOAP-ENV:Header/&gt;&quot;); builder.Append(&quot;&lt;SOAP-ENV:Body&gt;&quot;); builder.Append(&quot;&lt;SinglePaymentRequest xmlns=&quot;).Append(&apos;&quot;&apos;).Append(&quot;http://www.paygate.co.za/PayHOST&quot;).Append(&apos;&quot;&apos;).Append(&quot;&gt;&quot;); builder.Append(&quot;&lt;CardPaymentRequest&gt;&quot;); builder.Append(&quot;&lt;Account&gt;&quot;); builder.Append(&quot;&lt;PayGateId&gt;&quot;).Append(&quot;10011072130&quot;).Append(&quot;&lt;/PayGateId&gt;&quot;); builder.Append(&quot;&lt;Password&gt;&quot;).Append(&quot;test&quot;).Append(&quot;&lt;/Password&gt;&quot;); builder.Append(&quot;&lt;/Account&gt;&quot;); builder.Append(&quot;&lt;Customer&gt;&quot;); builder.Append(&quot;&lt;Title&gt;&quot;).Append(&quot;Mr&quot;).Append(&quot;&lt;/Title&gt;&quot;); builder.Append(&quot;&lt;FirstName&gt;&quot;).Append(&quot;Joe&quot;).Append(&quot;&lt;/FirstName&gt;&quot;); builder.Append(&quot;&lt;LastName&gt;&quot;).Append(&quot;Soap&quot;).Append(&quot;&lt;/LastName&gt;&quot;); builder.Append(&quot;&lt;Telephone&gt;&quot;).Append(&quot;0861234567&quot;).Append(&quot;&lt;/Telephone&gt;&quot;); builder.Append(&quot;&lt;Mobile&gt;&quot;).Append(&quot;0735552233&quot;).Append(&quot;&lt;/Mobile&gt;&quot;); builder.Append(&quot;&lt;Email&gt;&quot;).Append(&quot;joe@soap.com&quot;).Append(&quot;&lt;/Email&gt;&quot;); builder.Append(&quot;&lt;/Customer&gt;&quot;); builder.Append(&quot;&lt;CardNumber&gt;&quot;).Append(&quot;4000000000000002&quot;).Append(&quot;&lt;/CardNumber&gt;&quot;); builder.Append(&quot;&lt;CardExpiryDate&gt;&quot;).Append(&quot;122020&quot;).Append(&quot;&lt;/CardExpiryDate&gt;&quot;); builder.Append(&quot;&lt;CVV&gt;&quot;).Append(&quot;999&quot;).Append(&quot;&lt;/CVV&gt;&quot;); builder.Append(&quot;&lt;BudgetPeriod&gt;&quot;).Append(&quot;0&quot;).Append(&quot;&lt;/BudgetPeriod&gt;&quot;); builder.Append(&quot;&lt;Redirect&gt;&quot;); builder.Append(&quot;&lt;NotifyUrl&gt;&quot;).Append(&quot;https://www.mytestsite.com/notify&quot;).Append(&quot;&lt;/NotifyUrl&gt;&quot;); builder.Append(&quot;&lt;ReturnUrl&gt;&quot;).Append(&quot;https://www.mytestsite.com/return&quot;).Append(&quot;&lt;/ReturnUrl&gt;&quot;); builder.Append(&quot;&lt;/Redirect&gt;&quot;); builder.Append(&quot;&lt;Order&gt;&quot;); builder.Append(&quot;&lt;MerchantOrderId&gt;&quot;).Append(&quot;INV101&quot;).Append(&quot;&lt;/MerchantOrderId&gt;&quot;); builder.Append(&quot;&lt;Currency&gt;&quot;).Append(&quot;ZAR&quot;).Append(&quot;&lt;/Currency&gt;&quot;); builder.Append(&quot;&lt;Amount&gt;&quot;).Append(&quot;100&quot;).Append(&quot;&lt;/Amount&gt;&quot;); builder.Append(&quot;&lt;/Order&gt;&quot;); builder.Append(&quot;&lt;/CardPaymentRequest&gt;&quot;); builder.Append(&quot;&lt;/SinglePaymentRequest&gt;&quot;); builder.Append(&quot;&lt;/SOAP-ENV:Body&gt;&quot;); builder.Append(&quot;&lt;/SOAP-ENV:Envelope&gt;&quot;); return builder.ToString(); &#125;</span><br></pre></td></tr></table></figure>


结果：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot;&gt; &lt;SOAP-ENV:Header/&gt; &lt;SOAP-ENV:Body&gt; &lt;SinglePaymentRequest xmlns=\&quot;http://www.paygate.co.za/PayHOST\&quot;&gt; &lt;CardPaymentRequest&gt; &lt;Account&gt; &lt;PayGateId&gt;10011072130&lt;/PayGateId&gt; &lt;Password&gt;test&lt;/Password&gt; &lt;/Account&gt; &lt;Customer&gt; &lt;Title&gt;Mr&lt;/Title&gt; &lt;FirstName&gt;Joe&lt;/FirstName&gt; &lt;LastName&gt;Soap&lt;/LastName&gt; &lt;Telephone&gt;0861234567&lt;/Telephone&gt; &lt;Mobile&gt;0735552233&lt;/Mobile&gt; &lt;Email&gt;joe@soap.com&lt;/Email&gt; &lt;/Customer&gt; &lt;CardNumber&gt;4000000000000002&lt;/CardNumber&gt; &lt;CardExpiryDate&gt;122020&lt;/CardExpiryDate&gt; &lt;CVV&gt;999&lt;/CVV&gt; &lt;BudgetPeriod&gt;0&lt;/BudgetPeriod&gt; &lt;Redirect&gt; &lt;NotifyUrl&gt;https://www.mytestsite.com/notify&lt;/NotifyUrl&gt; &lt;ReturnUrl&gt;https://www.mytestsite.com/return&lt;/ReturnUrl&gt; &lt;/Redirect&gt; &lt;Order&gt; &lt;MerchantOrderId&gt;INV101&lt;/MerchantOrderId&gt; &lt;Currency&gt;ZAR&lt;/Currency&gt; &lt;Amount&gt;100&lt;/Amount&gt; &lt;/Order&gt; &lt;/CardPaymentRequest&gt; &lt;/SinglePaymentRequest&gt; &lt;/SOAP-ENV:Body&gt; &lt;/SOAP-ENV:Envelope&gt;</span><br></pre></td></tr></table></figure>


现在，请求看起来更好了，但是xmlns url区域中的转义字符“ \\”阻止了它成为有效的XML。 任何想法我怎么能删除那些？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong><br><strong>===============&gt;&gt;#2 票数：0</strong></p>

正如我在第一条评论中所述，您需要将名称空间soapEnv添加到"Body"并将spReq到所有从"CardPaymentRequest"开始的元素 它将产生类似XML 不幸的是，我错了，这在形式上不是相同的xml，并且不会通过针对相同模式的检查。 要获取exat xml，您必须将soapEnv更改为http://schemas.xmlsoap.org/soap/envelope/


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns=&quot;SOAP-ENV&quot;&gt;</span><br><span class="line">  &lt;Header /&gt;</span><br><span class="line">  &lt;Body&gt;</span><br><span class="line">    &lt;SinglePaymentRequest xmlns=&quot;http://www.paygate.co.za/PayHOST&quot;&gt;</span><br><span class="line">      &lt;CardPaymentRequest&gt;</span><br><span class="line">       ...</span><br><span class="line">      &lt;/CardPaymentRequest&gt;</span><br><span class="line">    &lt;/SinglePaymentRequest&gt;</span><br><span class="line">  &lt;/Body&gt;</span><br><span class="line">&lt;/Envelope&gt;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c如何在ASPNETMVC5中使用局部视图进行分页堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c如何在ASPNETMVC5中使用局部视图进行分页堆栈内存溢出.html" itemprop="url">c如何在ASPNETMVC5中使用局部视图进行分页堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
How to do paging using partial view in asp.net mvc 5



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我试图在这里从源代码进行分页，它不适用于部分视图。看起来该教程是用json返回的，但我以前是用模型的部分视图返回的。 分页不起作用，我认为PaggingTemplate（response.TotalPages，response.CurrentPage）此代码不起作用。 请帮我解决一下这个。


_PostList


这是我的部分看法。 请检查我的局部视图。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@using PagedList @model AungMyoSannPortal.Models.PagedData&lt;AungMyoSannPortal.Models.Post&gt; @foreach (var item in Model.Data) &#123; &lt;div class=&quot;container-fluid&quot; style=&quot;margin-top:25px!important&quot;&gt; &lt;div class=&quot;col-sm-8&quot; style=&quot;padding-left:30%&quot;&gt; &lt;div class=&quot;card w-40&quot; style=&quot; max-width: 60rem; border: 1px solid; padding: 0px; &quot;&gt; &lt;img src=&quot;~/Content/images/pic01.jpg&quot; /&gt; &lt;div class=&quot;card-body&quot; style=&quot;font-family: Times New Roman, Times, serif;&quot;&gt; &lt;div&gt;&lt;b&gt;@item.PostTitle&lt;/b&gt;&lt;/div&gt; &lt;br /&gt; &lt;div class=&quot;card-footer&quot;&gt; &lt;div class=&quot;row&quot;&gt; &lt;div class=&quot;col-sm-2&quot;&gt; &lt;i class=&quot;fa fa-thumbs-up&quot; style=&quot;font-size:20px;cursor:pointer; color:black;&quot;&gt;&lt;i style=&quot;font-family: Times New Roman, Times, serif; font-style:normal;margin-left:10px&quot;&gt;Like&lt;/i&gt;&lt;/i&gt; &lt;/div&gt; &lt;div class=&quot;col-sm-3&quot;&gt; &lt;i class=&quot;fa fa-commenting&quot; style=&quot;font-size:20px;cursor:pointer; color:black;margin-right:80%&quot; onclick=&quot;ADD1(@item.Id)&quot;&gt;&lt;i style=&quot;font-family: Times New Roman, Times, serif; font-style:normal;margin-left:10px&quot;&gt;Comment&lt;/i&gt;&lt;/i&gt; &lt;/div&gt; &lt;div class=&quot;col-sm-2&quot;&gt; &lt;i class=&quot;fa fa-share-square-o&quot; style=&quot;font-size:20px;cursor:pointer; color:black;&quot;&gt;&lt;i style=&quot;font-family: Times New Roman, Times, serif; font-style:normal;margin-left:10px&quot;&gt;Share&lt;/i&gt;&lt;/i&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;modal fade&quot; id=&quot;myModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-labelledby=&quot;myModalLabel&quot; aria-hidden=&quot;true&quot;&gt; &lt;div id=&quot;addmodal&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &#125; &lt;br /&gt; &lt;div class=&quot;row justify-content-center&quot;&gt; &lt;div id=&quot;paged&quot;&gt; &lt;/div&gt; &lt;/div&gt;</span><br></pre></td></tr></table></figure>


Post.cshtml


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@&#123; ViewBag.Title = &quot;Post&quot;; &#125; &lt;div class=&quot;container-fluid&quot;&gt; &lt;div class=&quot;col-sm-8&quot; style=&quot;padding-left:30%&quot;&gt; &lt;div class=&quot;card w-40&quot; style=&quot;text-align:center; max-width: 60rem;&quot;&gt; &lt;div style=&quot;background-color:#0077B5; color:white;&quot;&gt; &lt;i class=&quot;fa fa-pencil-square-o&quot; style=&quot;font-size:36px;cursor:pointer; padding:20px&quot; onclick=&quot;PostADD()&quot;&gt;&lt;i style=&quot;font-family: Times New Roman, Times, serif; font-style:normal&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;Start Post&lt;/i&gt;&lt;/i&gt; &lt;/div&gt; &lt;div class=&quot;modal fade&quot; id=&quot;myModal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-labelledby=&quot;myModalLabel&quot; aria-hidden=&quot;true&quot;&gt; &lt;div id=&quot;addmodal&quot;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&quot;PostList&quot;&gt; &lt;/div&gt; @section scripts&#123; &lt;script type=&quot;text/javascript&quot;&gt; $(function () &#123; PostList(); @*PostList(&apos;@Url.Action(&quot;_PostList&quot;, &quot;Community&quot;)&apos;, &apos;.PostList&apos;); initComponents();*@ &#125;); @*function initComponents() &#123; $(&apos;.PostList&apos;).on(&quot;click&quot;, &quot;.pagedList a&quot;, function (e) &#123; e.preventDefault(); var $a = $(this).attr(&quot;href&quot;); try &#123; var buttonlink = $a.split(/=/); page = buttonlink [1]; if (page == null) &#123; page = 1; &#125; &#125; catch (e) &#123; page = 1; &#125; PostList(&apos;@Url.Action(&quot;_PostList&quot;, &quot;Community&quot;)&apos;, &apos;.PostList&apos;); &#125;); &#125;*@ function PostList() &#123; $.ajax(&#123; cache: false, url: &quot;@Url.Action(&quot;_PostList&quot;, &quot;Community&quot;)&quot;, beforeSend: function () &#123; &#125;, success: function (PostData) &#123; $(&quot;.PostList&quot;).empty().append(PostData); &#125;, complete: function () &#123; &#125; &#125;); &#125; function CommentList() &#123; $.ajax(&#123; cache: false, url: &quot;@Url.Action(&quot;_CommentList&quot;, &quot;Community&quot;)&quot;, beforeSend: function () &#123; &#125;, success: function (CommentData) &#123; $(&quot;.CommentList&quot;).empty().append(CommentData); &#125;, complete: function () &#123; &#125; &#125;); &#125; function PostADD() &#123; $(&apos;#myModal&apos;).modal(&apos;show&apos;); $.ajax(&#123; cache: false, url: &apos;@Url.Action(&quot;_Form&quot;, &quot;Community&quot;)&apos;, data: &#123; FormType: &apos;Add&apos;, ID:0 &#125;, beforeSend: function () &#123; &#125;, success: function (myData) &#123; if (myData != null) &#123; $(&quot;#addmodal&quot;).empty().append(myData); &#125; &#125;, complete: function () &#123; $(&quot;#addform&quot;).submit(function (e) &#123; e.preventDefault(); $.ajax(&#123; cache: false, url: &apos;@Url.Action(&quot;ADD&quot;, &quot;Community&quot;)&apos;, type: &quot;POST&quot;, data: $(this).serialize(), beforeSend: function () &#123; &#125;, success: function (myData) &#123; if (myData != null) &#123; alert(&quot;Success&quot;); $(&apos;#myModal&apos;).modal(&apos;hide&apos;); &#125; &#125;, complete: function () &#123; &#125; &#125;); &#125;); &#125; &#125;) &#125; function ADD(id) &#123; ADD1(id); &#125; function ADD1(ID) &#123; $(&apos;#myModal&apos;).modal(&apos;show&apos;); $.ajax(&#123; cache: false, url: &apos;@Url.Action(&quot;_ComForm&quot;, &quot;Community&quot;)&apos;, data: &#123; FormType: &apos;Add&apos;, ID:ID &#125;, beforeSend: function () &#123; &#125;, success: function (myData) &#123; if (myData != null) &#123; $(&quot;#addmodal&quot;).empty().append(myData); &#125; &#125;, complete: function () &#123; $(&quot;#addform&quot;).submit(function (e) &#123; e.preventDefault(); $.ajax(&#123; cache: false, url: &apos;@Url.Action(&quot;ComADD&quot;, &quot;Community&quot;)&apos;, type: &quot;POST&quot;, data: $(this).serialize(), beforeSend: function () &#123; &#125;, success: function (myData) &#123; if (myData != null) &#123; alert(&quot;Success&quot;); $(&apos;#myModal&apos;).modal(&apos;hide&apos;); &#125; &#125;, complete: function () &#123; &#125; &#125;); &#125;); &#125; &#125;) &#125; $(document).ready(function () &#123; //Initially load pagenumber=1 GetPageData(1); &#125;); function GetPageData(pageNum, pageSize) &#123; //After every trigger remove previous data and paging $(&quot;.PostList&quot;).empty(); $(&quot;#paged&quot;).empty(); $.ajax(&#123; cache: false, url: &apos;@Url.Action(&quot;_PostList&quot;,&quot;Community&quot;)&apos;, data: &#123; pageNumber: pageNum, pageSize: pageSize &#125;, beforeSend: function () &#123; &#125;, success: function (response) &#123; // var rowData; //for (var i = 0; i &lt; response.Data.length; i++) &#123; // rowData = rowData + &apos;&lt;tr&gt;&lt;td&gt;&apos; + response.Data[i].Id + &apos;&lt;/td&gt;&lt;td&gt;&apos; + response.Data[i].Name + &apos;&lt;/td&gt;&lt;/tr&gt;&apos;; $(&quot;.PostList&quot;).append(response); PaggingTemplate(response.TotalPages, response.CurrentPage); &#125;, complete: function () &#123; &#125; &#125;); &#125; //This is paging temlpate ,you should just copy paste function PaggingTemplate(totalPage, currentPage) &#123; var template = &quot;&quot;; var TotalPages = totalPage; var CurrentPage = currentPage; var PageNumberArray = Array(); var countIncr = 1; for (var i = currentPage; i &lt;= totalPage; i++) &#123; PageNumberArray[0] = currentPage; if (totalPage != currentPage &amp;&amp; PageNumberArray[countIncr - 1] != totalPage) &#123; PageNumberArray[countIncr] = i + 1; &#125; countIncr++; &#125;; PageNumberArray = PageNumberArray.slice(0, 5); var FirstPage = 1; var LastPage = totalPage; if (totalPage != currentPage) &#123; var ForwardOne = currentPage + 1; &#125; var BackwardOne = 1; if (currentPage &gt; 1) &#123; BackwardOne = currentPage - 1; &#125; template = &quot;&lt;p&gt;&quot; + CurrentPage + &quot; of &quot; + TotalPages + &quot; pages&lt;/p&gt;&quot; template = template + &apos;&lt;ul class=&quot;pager&quot;&gt;&apos; + &apos;&lt;li class=&quot;previous&quot;&gt;&lt;a href=&quot;#&quot; onclick=&quot;GetPageData(&apos; + FirstPage + &apos;)&quot;&gt;&lt;i class=&quot;fa fa-fast-backward&quot;&gt;&lt;/i&gt;&amp;nbsp;First&lt;/a&gt;&lt;/li&gt;&apos; + &apos;&lt;li&gt;&lt;a href=&quot;#&quot; onclick=&quot;GetPageData(&apos; + BackwardOne + &apos;)&quot;&gt;&lt;i class=&quot;glyphicon glyphicon-backward&quot;&gt;&lt;/i&gt;&lt;/a&gt;&apos;; var numberingLoop = &quot;&quot;; for (var i = 0; i &lt; PageNumberArray.length; i++) &#123; numberingLoop = numberingLoop + &apos;&lt;a class=&quot;page-number active&quot; onclick=&quot;GetPageData(&apos; + PageNumberArray[i] + &apos;)&quot; href=&quot;#&quot;&gt;&apos; + PageNumberArray[i] + &apos; &amp;nbsp;&amp;nbsp;&lt;/a&gt;&apos; &#125; template = template + numberingLoop + &apos;&lt;a href=&quot;#&quot; onclick=&quot;GetPageData(&apos; + ForwardOne + &apos;)&quot; &gt;&lt;i class=&quot;glyphicon glyphicon-forward&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;&apos; + &apos;&lt;li class=&quot;next&quot;&gt;&lt;a href=&quot;#&quot; onclick=&quot;GetPageData(&apos; + LastPage + &apos;)&quot;&gt;Last&amp;nbsp;&lt;i class=&quot;fa fa-fast-forward&quot;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&apos;; $(&quot;#paged&quot;).append(template); $(&apos;#selectedId&apos;).change(function () &#123; GetPageData(1, $(this).val()); &#125;); &#125; &lt;/script&gt; &#125;</span><br></pre></td></tr></table></figure>


控制者


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public ActionResult _PostList(int pageNumber = 1, int pageSize = 5) &#123; using (AungMyoSannABCContext post = new AungMyoSannABCContext()) &#123; List&lt;Post&gt; listData = post.Post.ToList(); var pagedData = Pagination.PagedResult(listData, pageNumber, pageSize); return PartialView(&quot;_PostList&quot;, pagedData); //return Json(pagedData, JsonRequestBehavior.AllowGet); //PostCount&lt;Post&gt; result = new PostCount&lt;Post&gt;(); //var pagedList = new StaticPagedList&lt;Post&gt;(result.Result, page, pageSize, result.TotalCount); //var model = new PostCountList&lt;Post&gt; //&#123; // Result = pagedList, // TotalPage = result.TotalPage, // TotalCount = result.TotalCount //&#125;; //return PartialView(&quot;_PostList&quot;, model); //List&lt;Post&gt; result = post.Post.ToList(); //return PartialView(&quot;_PostList&quot;, result); &#125; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c在1个按钮中单击即可链接控制器动作和或Promise堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c在1个按钮中单击即可链接控制器动作和或Promise堆栈内存溢出.html" itemprop="url">c在1个按钮中单击即可链接控制器动作和或Promise堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Chaining Controller Actions and/or promises in 1 button click



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
目前，我的项目大约有75％的时间在工作，我创建报表/报告将其添加到zip文件中，然后将其解压缩到某个位置。 当我在调试模式下运行它时，它可以正常工作。 当我正常运行它时，有时ajax会乱七八糟，它将尝试在压缩文件之前解压缩文件（没有文件）。 我一直在尝试和尝试这种不同的方法来使它正常工作。


我尝试了多种方法来做到这一点：成功的ajax。 我在ajax之后尝试了一个.done承诺。 我尝试了bool：if语句尝试了许多不同的条件。 当我第一次打开项目并选择记录并单击按钮时，它似乎终于能以正确的顺序工作。 只有1次才能成功。 当我尝试选择新记录并第二次运行它时，将始终不会创建unzip文件夹，或者是否将创建它，但它将是空的（没有解压缩报告）。


这是我目前拥有的，有时可以正常工作。 一旦一切顺利，我就必须创建最后一步，即创建电子邮件并附加文档。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (isValid) &#123; $.ajax(&#123; type: &quot;GET&quot;, url: &quot;/Service/ExportFiles/&quot;, contentType: &quot;application/json; charset=utf-8&quot;, traditional: true, data: &#123; &quot;quoteIDs&quot; : arrSelectedChks &#125;, success: function () &#123; window.location = &apos;/Service/DownloadAsZip/&apos;; // DownloadAsZip?mimeType=&apos; + data; &#125;, error: function (request, status, error) &#123; alert(&quot;Error Generating Files&quot;); //+ request.responseText); &#125; &#125;).done(function () &#123; $.ajax(&#123; type: &quot;POST&quot;, url: &quot;/Service/UnZipDownload&quot;, data: &#123;&#125;, contentType: &quot;application/json; charset=utf-8&quot;, success: function (response) &#123; //alert(&quot;success in unzip&quot;); CallEmail(); &#125; &#125;) &#125;);</span><br></pre></td></tr></table></figure>


这是我这样做的另一种方式。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (isValid) &#123; /* At least 1 record is selected */ var phaseOne = $.ajax(&#123; type: &quot;GET&quot;, async: false, url: &quot;/Service/ExportFiles/&quot;, contentType: &quot;application/json; charset=utf-8&quot;, traditional: true, data: &#123; &quot;quoteIDs&quot;: arrSelectedChks &#125;, success: function (response) &#123; window.location = &apos;/Service/DownloadAsZip&apos;; successful = true &#125;, complete: function () &#123; if (successful) isZipped = true; &#125; &#125;); &#125; $.when(phaseOne).always(function () &#123; if (isZipped) &#123; /* Files are Zipped to start this phase */ $.ajax(&#123; type: &quot;POST&quot;, async: false, url: &quot;/Service/UnZipDocument&quot;, data: &#123;&#125;, contentType: &quot;application/json; charset=utf-8&quot;, traditional: true, &#125;); &#125; &#125;)</span><br></pre></td></tr></table></figure>


PS：如果需要查看我将发布的操作，我既有Controller Actions也有UnZipDownload和UnZipDocument（两者相似）。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

仅当第一个函数成功时才必须调用第二个函数


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">if (isValid) &#123;</span><br><span class="line">       $.ajax(&#123;</span><br><span class="line">           type: &quot;GET&quot;,</span><br><span class="line">           url: &quot;/Service/ExportFiles/&quot;,</span><br><span class="line">           contentType: &quot;application/json; charset=utf-8&quot;,</span><br><span class="line">           traditional: true,</span><br><span class="line">           data: &#123; &quot;quoteIDs&quot; : arrSelectedChks &#125;</span><br><span class="line">       &#125;).done(function()&#123;</span><br><span class="line">            window.location = &apos;/Service/DownloadAsZip/&apos;;</span><br><span class="line">               // DownloadAsZip?mimeType=&apos; + data;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">               type: &quot;POST&quot;,</span><br><span class="line">               url: &quot;/Service/UnZipDownload&quot;,</span><br><span class="line">               data: &#123;&#125;,</span><br><span class="line">               contentType: &quot;application/json; charset=utf-8&quot;</span><br><span class="line">           &#125;).done(function()&#123;</span><br><span class="line">                //alert(&quot;success in unzip&quot;);</span><br><span class="line">                   CallEmail();</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;).fail(function()&#123;</span><br><span class="line">            alert(&quot;Error Generating Files&quot;);</span><br><span class="line">               //+ request.responseText);</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

因此，我尝试了许多不同的结果，以尝试通过单击1按钮使其工作。 但是，我发现要使它起作用的唯一方法是使用1个按钮来执行报告的创建和文件压缩。 然后要有第二个按钮（当前是模式中的地雷），然后在此按钮上单击“我将文件解压缩并创建电子邮件”。 我无法在一次通话中完成所有操作。 当我尝试在我的zip函数之前调用我的unzip函数时，我尝试了多种方法来尝试避免这种情况的发生[成功，.done（），延迟的对象，javascript承诺）


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"> $(&apos;#btnGetChkEmail&apos;).on(&apos;click&apos;, function() &#123;</span><br><span class="line">            var arrChkBoxes = [];</span><br><span class="line">            var arrSelectedChks = [];</span><br><span class="line">            var myJSON = &#123;&#125;;</span><br><span class="line">            var phaseOne, phaseTwo;</span><br><span class="line">            var isValid = false;</span><br><span class="line">            var bool = false;</span><br><span class="line">            var isZipped = false;</span><br><span class="line">            //var unZipped = false;</span><br><span class="line">            var successful = false;</span><br><span class="line"></span><br><span class="line">            // Turn all selected checkbox T/F values into QuoteIDs</span><br><span class="line">            $(&quot;input:checked&quot;).each(function (index, value) &#123;</span><br><span class="line">                arrChkBoxes.push($(value).val());</span><br><span class="line">            &#125;);</span><br><span class="line">            // Push all Selected QIDs on NEW ARRAY</span><br><span class="line">            $.each(arrChkBoxes, function (key, value) &#123;</span><br><span class="line">                if (IsPositiveInteger(value)) &#123;</span><br><span class="line">                    arrSelectedChks.push(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            if (arrSelectedChks.length === 0) &#123; // Create Modal (Error ~ None ~ Selected)</span><br><span class="line">                isValid = false;</span><br><span class="line">                alert(&quot;No Records Selected&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                isValid = true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        /* EDITION LIKE GETCHKS */</span><br><span class="line">            if (isValid) &#123;</span><br><span class="line">                $.ajax(&#123;</span><br><span class="line">                    type: &quot;GET&quot;,</span><br><span class="line">                    url: &quot;/Service/ExportFiles/&quot;,</span><br><span class="line">                    contentType: &quot;application/json; charset=utf-8&quot;,</span><br><span class="line">                    traditional: true,</span><br><span class="line">                    data: &#123; &quot;quoteIDs&quot;: arrSelectedChks &#125;,</span><br><span class="line">                    success: function (response) &#123;</span><br><span class="line">                        window.location = &apos;/Service/DownloadAsZip&apos;;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    error: function (request, status, error) &#123;</span><br><span class="line">                        alert(&quot;Error Generating Reports&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).done(function (data) &#123;</span><br><span class="line">                    /* Only way to do this 100% at the moment is to bring up a Button in a Modal */</span><br><span class="line">                    var zipModal = $(&quot;#zipModEmail&quot;);</span><br><span class="line">                    var modalHead = &quot;&lt;h3 class=&apos;modal-title&apos;&gt;Generate Email Messages&lt;/h3&gt;&quot;;</span><br><span class="line">                    var modalBody = &quot;&lt;span class=&apos;glyphicon glyphicon-ok-sign&apos; style=&apos;font-size:5em; color:green;&apos;&gt;&lt;/span&gt;&quot; +</span><br><span class="line">                        &quot;&lt;p&gt;&lt;b&gt;Attach PDF&apos;s to email Confirmation&lt;/b&gt;&lt;/p&gt;&quot; +</span><br><span class="line">                        &quot;&lt;p&gt;Click &apos;OK&apos; to Confirm&lt;/p&gt;&quot;;</span><br><span class="line">                    //var modalFoot = &quot;&quot;;</span><br><span class="line">                    zipModal.find(&quot;.modal-header&quot;).html(modalHead);</span><br><span class="line">                    zipModal.find(&quot;.modal-header&quot;).addClass(&quot;alert-success&quot;);</span><br><span class="line">                    zipModal.find(&quot;.modal-body&quot;).html(modalBody);</span><br><span class="line">                    zipModal.modal(&quot;show&quot;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">$(&quot;#btnUnNemail&quot;).click(function (e) &#123;</span><br><span class="line">            var myJSON = &#123;&#125;;</span><br><span class="line">            var bool = false;</span><br><span class="line"></span><br><span class="line">            var ajaxCall = $.ajax(&#123;</span><br><span class="line">                            type: &quot;POST&quot;,</span><br><span class="line">                            url: &quot;/Service/UnZipDocument&quot;,</span><br><span class="line">                            data: &#123;&#125;,</span><br><span class="line">                            contentType: &quot;application/json; charset=utf-8&quot;,</span><br><span class="line">                            success: function (response) &#123;</span><br><span class="line">                                debugger;</span><br><span class="line">                                if (response.Status == &quot;Unzipped&quot;) &#123;</span><br><span class="line">                                    myJSON = &#123; &quot;Status&quot;: &quot;Unzipped&quot;, &quot;FilePath&quot;: response.FilePath, &quot;FileName&quot;: response.FileName, &quot;FileNames&quot;: response.FileNames &#125;;</span><br><span class="line">                                    bool = true;</span><br><span class="line">                                &#125;</span><br><span class="line">                                $(&quot;#zipModEmail&quot;).modal(&quot;hide&quot;);</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line"></span><br><span class="line">            // Try switching to &apos;POST&apos;</span><br><span class="line">            $.when(ajaxCall).then(function () &#123;</span><br><span class="line">                if (bool) &#123;</span><br><span class="line">                    //debugger;</span><br><span class="line">                    $.ajax(&#123;</span><br><span class="line">                        type: &quot;GET&quot;,</span><br><span class="line">                        url: &apos;@Url.Action(&quot;CreateEmailReport&quot;, &quot;Service&quot;)&apos;,</span><br><span class="line">                        contentType: &quot;application/json; charset=utf-8;&quot;,</span><br><span class="line">                        data: &#123; &quot;folderData&quot;: myJSON &#125;,</span><br><span class="line">                        traditional: true,</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);          </span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c反复选择文件或Excel格式的文件时将引发此异常堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c反复选择文件或Excel格式的文件时将引发此异常堆栈内存溢出.html" itemprop="url">c反复选择文件或Excel格式的文件时将引发此异常堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
When files are selected repeatedly or files in Excel format, this exception is thrown



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
问候朋友，


FileStream或Process，请帮助弄清楚。


以下Windows窗体应用程序首先从openFileDialog1中选择一个或多个文件，检查这些文件是否在数据库中（GetInsertNummer），然后将它们写入数据库（InsertInTable）。


然后，它从数据库中读取它们并在Windows（FileGetSimple）中写入。 接下来，将打开，关闭这些文件，然后通过电子邮件（CreateMessage）发送这些文件。


一切似乎都可以正常工作，但是当反复选择文件或Excel格式的文件时，会引发此异常。


该进程无法访问文件”，因为它正在被另一个进程使用。


运行程序时，我只按了一次按钮（btnSales_Click。）第一次，一切正常。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public bool FileGetSimple(int Identifier, string filePath) &#123; pa = Path.Combine(Path.GetTempPath(), Path.GetFileName(filePath)); var statement = &quot;SELECT Id, Data, FileName FROM StoredFile WHERE Id = @id;&quot;; var mc = MakeConnection(statement); mc.Parameters.AddWithValue(&quot;@id&quot;, Identifier); SqlDataReader reader = mc.ExecuteReader(); if (reader.HasRows) &#123; reader.Read(); // the blob field int ndx = reader.GetOrdinal(&quot;Data&quot;); var blob = new Byte[(reader.GetBytes(ndx, 0, null, 0, int.MaxValue))]; reader.GetBytes(ndx, 0, blob, 0, blob.Length); reader.Close(); using (FileStream fs = new FileStream(pa, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.ReadWrite)) &#123; fs.Write(blob, 0, blob.Length); &#125; OpenFiles(pa); &#125; return true; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

查看了您的代码（在评论中）： 很难阅读，甚至更难弄清楚应该发生什么。 看起来像是从不同教程/ stackoverflow帖子中复制/粘贴frankencode。 你知道发生了什么吗？ 我该怎么办？ 也， FileStream或Process，请帮助弄清楚 你怎么不知道 您正在获取异常，您应该知道异常发生的位置。 抱歉，此答案没有用，但可能是您得到的最好的答案。 提供一个最小的，可复制的示例，然后再次询问。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"> public partial class Form1 : Form</span><br><span class="line">&#123;</span><br><span class="line">    public List&lt;string&gt; files &#123; get; set; &#125;</span><br><span class="line">    public List&lt;string&gt; outputfiles &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">    // these fields are public but not properties, why?</span><br><span class="line">    public int insertNummer;</span><br><span class="line">    public int row_id;</span><br><span class="line">    public Process sp;</span><br><span class="line">    public string ExceptionMessage &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">    public Form1()</span><br><span class="line">    &#123;</span><br><span class="line">        InitializeComponent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void btnSales_Click(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        outputfiles = null;</span><br><span class="line">        files = null;</span><br><span class="line">        sp = null;</span><br><span class="line"></span><br><span class="line">        // didn&apos;t compile</span><br><span class="line">        if (InformationWindow(&quot;Выбирете пожалйста фалы и сохраните в Windows&quot;, &quot;&quot;, MessageBoxButtons.OKCancel, MessageBoxIcon.Information) == System.Windows.Forms.DialogResult.OK)</span><br><span class="line">        &#123;</span><br><span class="line">            // invert and return</span><br><span class="line">            if (openFileDialog1.ShowDialog() == DialogResult.OK)</span><br><span class="line">            &#123;</span><br><span class="line">                foreach (var item in openFileDialog1.FileNames)</span><br><span class="line">                &#123;</span><br><span class="line">                    files = new List&lt;string&gt;();</span><br><span class="line">                    files.Add(item);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                // useless since files is already null at this point</span><br><span class="line">                files = null;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            GetInsertNummer(@&quot;SELECT (SELECT MAX(id) FROM StoredFile) id, MAX(InsertNummer) InsertNummer FROM StoredFile&quot;);</span><br><span class="line"></span><br><span class="line">            // useless if return above</span><br><span class="line">            if (files != null)</span><br><span class="line">            &#123;</span><br><span class="line">                for (int i = 0; i &lt; files.Count; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    InsertInTable(i);</span><br><span class="line"></span><br><span class="line">                    // use ++row_id in FileGetSimple instead</span><br><span class="line">                    row_id++;</span><br><span class="line"></span><br><span class="line">                    FileGetSimple(row_id, files[i]);</span><br><span class="line">                &#125;</span><br><span class="line">                // doesn&apos;t compile</span><br><span class="line">                InformationWindow(&quot;Все в порядке с выбранными файлами?&quot;, &quot;&quot;, MessageBoxButtons.OKCancel, MessageBoxIcon.Question);</span><br><span class="line">                CreateMessage(&quot;smtp.strato.de&quot;);</span><br><span class="line"></span><br><span class="line">                MessageBox.Show(&quot;success&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public DialogResult InformationWindow(string v1, string v2, MessageBoxButtons oKCancel, MessageBoxIcon information)</span><br><span class="line">    &#123;</span><br><span class="line">        // bad practise, rename v1 to caption and v2 to message in method parameter</span><br><span class="line">        string message = v2;</span><br><span class="line">        string caption = v1;</span><br><span class="line">        // unnecessary variable definitions, also weird name &quot;oKCancel&quot; for dynamically assigned MessageBoxButtons that aren&apos;t always Ok/Cancel?</span><br><span class="line">        MessageBoxButtons buttons = oKCancel;</span><br><span class="line">        DialogResult result;</span><br><span class="line"></span><br><span class="line">        // Displays the MessageBox.</span><br><span class="line">        // return the value directly instead of an unneeded assignment</span><br><span class="line">        return result = MessageBox.Show(message, caption, buttons, information);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void CreateMessage(string server)</span><br><span class="line">    &#123;</span><br><span class="line">        using (SmtpClient client = new SmtpClient(server))</span><br><span class="line">        &#123;</span><br><span class="line">            client.Port = 587;</span><br><span class="line">            client.EnableSsl = true;</span><br><span class="line"></span><br><span class="line">            client.Credentials = new NetworkCredential(&quot;s.dadashev@gebr-naim.de&quot;, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">            // didn&apos;t compile ---</span><br><span class="line">            MailAddress from = new MailAddress(&quot;---&quot;, &quot;&quot;);</span><br><span class="line">            MailAddress to = new MailAddress(&quot;---&quot;, &quot;&quot;);</span><br><span class="line">            MailMessage message = new MailMessage(from, to);</span><br><span class="line"></span><br><span class="line">            message.Subject = &quot;Es funktioniert.&quot;;</span><br><span class="line">            // unnecessary @</span><br><span class="line">            message.Body = @&quot;Вы получили письмо с вложением&quot;;</span><br><span class="line"></span><br><span class="line">            // outputfiles will always only contain a single file --&gt; the loop will only run once, ever!</span><br><span class="line">            foreach (var item in outputfiles)</span><br><span class="line">            &#123;</span><br><span class="line">                // dispose of possibly previously disposed process, not necessary or using statement of sp not necessary</span><br><span class="line">                if (!sp.HasExited)</span><br><span class="line">                &#123;</span><br><span class="line">                    sp.Kill();</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                    sp = null;</span><br><span class="line"></span><br><span class="line">                message.Attachments.Add(new Attachment(item));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            InformationWindow(&quot;Success&quot;, $&quot;Sending an email message to&quot; + to.Address + &quot; by using the SMTP host &quot; + client.Host + &quot;.&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line"></span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                client.Send(message);</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                InformationWindow(&quot;Exception&quot;, ex.ToString(), MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void InsertInTable(int i)</span><br><span class="line">    &#123;</span><br><span class="line">        // **** Write BLOB to the Database</span><br><span class="line">        byte[] filebyte = File.ReadAllBytes(files[i]);</span><br><span class="line"></span><br><span class="line">        // unnecessary variable declaration (it&apos;s only used once), put statement directly in MakeConnection(&quot;...&quot;)</span><br><span class="line">        string sql = @&quot;insert into StoredFile(FileName,Data,InsertNummer,Date) values(@FileName,@Data,@InsertNummer,@Date)&quot;;</span><br><span class="line"></span><br><span class="line">        var cmd = MakeConnection(sql);</span><br><span class="line"></span><br><span class="line">        // unnecessary variable declarations, parameter1..5 is never used anywhere</span><br><span class="line">        SqlParameter parameter1 = cmd.Parameters.AddWithValue(&quot;@FileName&quot;, Path.GetFileName(files[i]));</span><br><span class="line">        SqlParameter parameter2 = cmd.Parameters.AddWithValue(&quot;@Data&quot;, filebyte);</span><br><span class="line">        SqlParameter parameter3 = cmd.Parameters.AddWithValue(&quot;@InsertNummer&quot;, insertNummer);</span><br><span class="line">        SqlParameter parameter4 = cmd.Parameters.AddWithValue(&quot;@Id&quot;, row_id);</span><br><span class="line">        SqlParameter parameter5 = cmd.Parameters.AddWithValue(&quot;@Date&quot;, DateTime.Now);</span><br><span class="line"></span><br><span class="line">        cmd.ExecuteNonQuery();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public bool FileGetSimple(int Identifier, string filePath)</span><br><span class="line">    &#123;</span><br><span class="line">        // why did you start using var instead of the types?</span><br><span class="line">        var pa = Path.Combine(Path.GetTempPath(), Path.GetFileName(filePath));</span><br><span class="line"></span><br><span class="line">        var statement = &quot;SELECT Id, Data, FileName FROM StoredFile WHERE Id = @id;&quot;;</span><br><span class="line">        var mc = MakeConnection(statement);</span><br><span class="line"></span><br><span class="line">        mc.Parameters.AddWithValue(&quot;@id&quot;, Identifier);</span><br><span class="line">        SqlDataReader reader = mc.ExecuteReader();</span><br><span class="line"></span><br><span class="line">        if (reader.HasRows)</span><br><span class="line">        &#123;</span><br><span class="line">            reader.Read();</span><br><span class="line"></span><br><span class="line">            // the blob field</span><br><span class="line">            int ndx = reader.GetOrdinal(&quot;Data&quot;);</span><br><span class="line"></span><br><span class="line">            // that is wrong and not how to read a buffer, read up on how to use buffers/GetBytes correctly!</span><br><span class="line">            var blob = new Byte[(reader.GetBytes(ndx, 0, null, 0, int.MaxValue))];</span><br><span class="line">            // oh jeez</span><br><span class="line">            reader.GetBytes(ndx, 0, blob, 0, blob.Length);</span><br><span class="line">            reader.Close();</span><br><span class="line"></span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                if (File.Exists(pa))</span><br><span class="line">                &#123;</span><br><span class="line">                    File.Delete(pa);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                using (var fs = new FileStream(pa, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.None))</span><br><span class="line">                &#123;</span><br><span class="line">                    fs.Write(blob, 0, blob.Length);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (IOException e)</span><br><span class="line">            &#123;</span><br><span class="line">                InformationWindow(&quot;Warning&quot;, e.Message + &quot; Schlie&amp;#223;en Sie diese Datei, um fortzusetzen.&quot;, MessageBoxButtons.OK, MessageBoxIcon.Warning);</span><br><span class="line">                FileGetSimple(Identifier, filePath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // function is called OpenFiles but only a single file is supplied?</span><br><span class="line">        OpenFiles(pa);</span><br><span class="line"></span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void OpenFiles(string tempFilePath)</span><br><span class="line">    &#123;</span><br><span class="line">        // what is this even supposed to do?</span><br><span class="line">        // create new process instance</span><br><span class="line">        using (sp = new Process())</span><br><span class="line">        &#123;</span><br><span class="line">            // then throw away the instance and start a process instead</span><br><span class="line">            sp = Process.Start(tempFilePath);</span><br><span class="line">            // then dispose process</span><br><span class="line">        &#125;</span><br><span class="line">        // quiz: has new Process() or Process.Start been disposed by the using statement?</span><br><span class="line"></span><br><span class="line">        // every time a file is opened the outputfiles list is re-initialized and a single element is addded?</span><br><span class="line">        // it&apos;s never going to contain more than one element!</span><br><span class="line">        outputfiles = new List&lt;string&gt;();</span><br><span class="line">        outputfiles.Add(tempFilePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void GetInsertNummer(string ins_num_query)</span><br><span class="line">    &#123;</span><br><span class="line">        // using dynamic sql statements but accessing columns statically, how do you guarantee that these columns exist?</span><br><span class="line">        // is there a point in providing a parameter, why can the statement not be inside this function, it never changes!</span><br><span class="line">        var ins_num = MakeConnection(ins_num_query);</span><br><span class="line">        SqlDataReader read_ins_nummer = ins_num.ExecuteReader();</span><br><span class="line"></span><br><span class="line">        while (read_ins_nummer.Read())</span><br><span class="line">        &#123;</span><br><span class="line">            int ins = read_ins_nummer.GetOrdinal(&quot;InsertNummer&quot;);</span><br><span class="line">            int ins_id = read_ins_nummer.GetOrdinal(&quot;Id&quot;);</span><br><span class="line">            // use previously defined variable &quot;ins&quot; instead of re-executing GetOrdial</span><br><span class="line">            if (!read_ins_nummer.IsDBNull(read_ins_nummer.GetOrdinal(&quot;InsertNummer&quot;)))</span><br><span class="line">            &#123;</span><br><span class="line">                // insertNummer and row_id is the same, dont&apos; execute GetInt32 twice, use the same value instead!</span><br><span class="line">                insertNummer = read_ins_nummer.GetInt32(ins);</span><br><span class="line">                row_id = read_ins_nummer.GetInt32(ins_id);</span><br><span class="line">                insertNummer++;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                insertNummer = 1;</span><br><span class="line">                row_id = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SqlCommand MakeConnection(string sql)</span><br><span class="line">    &#123;</span><br><span class="line">        SqlConnection connection = new SqlConnection(&quot;&quot;);</span><br><span class="line">        connection.Open();</span><br><span class="line"></span><br><span class="line">        // you&apos;re using object initializer here, why not everywhere else?</span><br><span class="line">        using (SqlCommand cmd = new SqlCommand() &#123; Connection = connection, CommandText = sql &#125;)</span><br><span class="line">        &#123;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                return cmd;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                // this is never used anywhere</span><br><span class="line">                ExceptionMessage = ex.Message;</span><br><span class="line">                return cmd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void exitToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        Application.Exit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

@preciousbetine请找到问题的简短描述 从数据库将文件写入OS之后，我将其打开 然后关闭它们 但不幸的是，我找不到打开的文件已在哪个进程中打开。 从代码中可以看到，我尝试以不同的方式关闭此过程。 在excel中，我还使用了Marshal.ReleaseComObject（sp）。 它没有解决。 我在某个地方正在使用此文件。 请帮我弄清楚.. 是的，因为我们在循环中调用FileGetSimple函数，所以当我们从openFileDialog1中选择文件时（可以选择一个或多个文件），每次List都会填充路径和文件名值 请在下面找到代码 你是否同意我的观点？


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">    public bool FileGetSimple(int Identifier, string filePath)</span><br><span class="line">            &#123;</span><br><span class="line">                var pa = Path.Combine(Path.GetTempPath(), Path.GetFileName(filePath));</span><br><span class="line"></span><br><span class="line">                var statement = &quot;SELECT Id, Data, FileName FROM StoredFile WHERE Id = @id;&quot;;</span><br><span class="line">                var mc = MakeConnection(statement);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                mc.Parameters.AddWithValue(&quot;@id&quot;, Identifier);</span><br><span class="line">                SqlDataReader reader = mc.ExecuteReader();</span><br><span class="line"></span><br><span class="line">                if (reader.HasRows)</span><br><span class="line">                &#123;</span><br><span class="line">                    reader.Read();</span><br><span class="line"></span><br><span class="line">                    // the blob field</span><br><span class="line">                    int ndx = reader.GetOrdinal(&quot;Data&quot;);</span><br><span class="line"></span><br><span class="line">                    var blob = new Byte[(reader.GetBytes(ndx, 0, null, 0, int.MaxValue))];</span><br><span class="line"></span><br><span class="line">                    reader.GetBytes(ndx, 0, blob, 0, blob.Length);</span><br><span class="line">                    reader.Close();</span><br><span class="line"></span><br><span class="line">                    try</span><br><span class="line">                    &#123;</span><br><span class="line">                        //using (var fs = new FileStream(pa, FileMode.Create, FileAccess.Write, FileShare.ReadWrite))</span><br><span class="line">                        //&#123;</span><br><span class="line">                        //    fs.Write(blob, 0, blob.Length);</span><br><span class="line">                        //&#125;</span><br><span class="line"></span><br><span class="line">                        if (File.Exists(pa))</span><br><span class="line">                        &#123;</span><br><span class="line">                            File.Delete(pa);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        using (var fs = new FileStream(pa, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.None))</span><br><span class="line">                        &#123;</span><br><span class="line">                            fs.Write(blob, 0, blob.Length);</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        //using (FileStream fs = File.Create(pa))</span><br><span class="line">                        //&#123;</span><br><span class="line">                        //    fs.Write(blob, 0, blob.Length);</span><br><span class="line">                        //&#125;</span><br><span class="line"></span><br><span class="line">                        //using (var stream = File.Create(pa))</span><br><span class="line">                        //&#123;</span><br><span class="line">                        //File.WriteAllBytes(pa, blob);</span><br><span class="line">                        //&#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    catch (IOException e) &#123;</span><br><span class="line">                        InformationWindow(&quot;Warning&quot;, e.Message + &quot; Schließen Sie diese Datei, um fortzusetzen.&quot;, MessageBoxButtons.OK, MessageBoxIcon.Warning);</span><br><span class="line">                        FileGetSimple(Identifier, filePath);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                OpenFiles(pa);</span><br><span class="line"></span><br><span class="line">                return true;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            private void OpenFiles(string tempFilePath)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                using (sp = new Process())</span><br><span class="line">                &#123;</span><br><span class="line">                    sp = Process.Start(tempFilePath);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                outputfiles = new List&lt;string&gt;();</span><br><span class="line">                outputfiles.Add(tempFilePath);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">`</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c使MAFAddInProcessexe为长路径感知堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c使MAFAddInProcessexe为长路径感知堆栈内存溢出.html" itemprop="url">c使MAFAddInProcessexe为长路径感知堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Make MAF AddInProcess.exe “Long Path Aware”



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在尝试使Windows 10的Addin（使用MAF ）AddInProcess.exe（由AddInProcess类创建）“长路径感知”。


困难源于我不拥有 AddInProcess.exe的事实。 它是.NET Framework的一部分，位于C:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\AddInProcess.exe


这是我所做的事情（基于遵循Jeremy Kuhne的Blog条目.NET 4.6.2的指导以及Windows 10上的长路径 ）：


将AppContext开关Switch.System.IO.UseLegacyPathHandling和Switch.System.IO.BlockLongPaths为false 。 这使某些 .NET API开始接受长路径。 但是，在调用本机 win32的情况下，调用仍然失败，并出现System.IO.DirectoryNotFoundException或其他异常。 我应该做的下一件事，但不能做的是编辑应用程序的清单并在下面添加设置。 但是，我没有一种（正确的）方法可以做到这一点。 如果我能做到这一点， 那就行了 。 为了证明它会起作用，我做了以下工作：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;application xmlns=&quot;urn:schemas-microsoft-com:asm.v3&quot;&gt; &lt;windowsSettings&gt; &lt;longPathAware xmlns=&quot;http://schemas.microsoft.com/SMI/2016/WindowsSettings&quot;&gt;true&lt;/longPathAware&gt; &lt;/windowsSettings&gt; &lt;/application&gt;</span><br></pre></td></tr></table></figure>


尽管上述破解工作正常，但在最终用户的计算机上执行此操作显然是不合理的，而且，它会更改所有 AddInProcess.exe的行为，而不仅仅是我创建的行为。


问：是否有做一个过程中，你不必在（控制一个合法的方式AddInProcess.exe ）是longPathAware ？


有没有办法在运行时更改此清单设置？


注意事项 ：


其他参考资料 ：


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

@RbMm在注释中建议的未记录方法（将PEB的IsLongPathAwareProcess位设置为1 ）有效（至少在我使用的Windows 10版本上：1903）。 由于该方法是本机C / C ++方法，因此我只需要将其转换为C＃可消耗的东西。 可以使用多种方法（C ++ / CLI，pinvoke）。 由于我只是在做“概念验证”，所以我决定只使用pinvoke，并且对代码的质量有点懒。 笔记： 测试代码： 如果您在自然是longPathAware的控制台应用程序中使用此代码，则仍可以通过在app.manifest手动将longPathAware设置为false来测试其是否正常运行：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"> class Program</span><br><span class="line">&#123;</span><br><span class="line">    static void Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        SetIsLongPathAwareProcess();</span><br><span class="line"></span><br><span class="line">        string reallyLongDirectory = @&quot;C:\Test\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">        reallyLongDirectory = reallyLongDirectory + @&quot;\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">        reallyLongDirectory = reallyLongDirectory + @&quot;\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">        CreateDirTest(reallyLongDirectory);</span><br><span class="line">        Directory.Delete(@&quot;C:\Test&quot;, recursive: true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void CreateDirTest(string name)</span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine($&quot;Creating a directory that is &#123;name.Length&#125; characters long&quot;);</span><br><span class="line"></span><br><span class="line">        // Test managed CreateDirectory</span><br><span class="line">        Directory.CreateDirectory(name);</span><br><span class="line"></span><br><span class="line">        // Test Native CreateDirectory.  Note this method will only create the &quot;last part&quot; of the directory (not the full path).</span><br><span class="line">        // Also note that it fails if the directory already exists.</span><br><span class="line">        // https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createdirectorya</span><br><span class="line">        string nativeName = Path.Combine(name, &quot;TestEnding&quot;);</span><br><span class="line">        var r = Native.CreateDirectory(nativeName, null);</span><br><span class="line">        if (!r)</span><br><span class="line">        &#123;</span><br><span class="line">            int currentError = Marshal.GetLastWin32Error();</span><br><span class="line">            Debug.Fail($&quot;Native.CreateDirectory failed: &#123;currentError&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // Adapted from https://www.pinvoke.net/default.aspx/ntdll.ntqueryinformationprocess</span><br><span class="line">    private static void SetIsLongPathAwareProcess()</span><br><span class="line">    &#123;</span><br><span class="line">        var currentProcess = Process.GetCurrentProcess();</span><br><span class="line">        IntPtr hProc = currentProcess.Handle;</span><br><span class="line"></span><br><span class="line">        IntPtr pPbi = Marshal.AllocHGlobal(Marshal.SizeOf(typeof(Native.PROCESS_BASIC_INFORMATION)));</span><br><span class="line">        IntPtr outLong = Marshal.AllocHGlobal(sizeof(long));</span><br><span class="line"></span><br><span class="line">        int status = Native.NtQueryInformationProcess(hProc, 0, pPbi, (uint)Marshal.SizeOf(typeof(Native.PROCESS_BASIC_INFORMATION)), outLong);</span><br><span class="line"></span><br><span class="line">        Marshal.FreeHGlobal(outLong);</span><br><span class="line"></span><br><span class="line">        //STATUS_SUCCESS = 0</span><br><span class="line">        if (status == 0)</span><br><span class="line">        &#123;</span><br><span class="line">            var pbi = Marshal.PtrToStructure&lt;Native.PROCESS_BASIC_INFORMATION&gt;(pPbi);</span><br><span class="line">            var pPeb = pbi.PebBaseAddress;</span><br><span class="line"></span><br><span class="line">            var peb = Marshal.PtrToStructure&lt;Native.PEB_Beginning&gt;(pPeb);</span><br><span class="line"></span><br><span class="line">            var bitField1 = peb.BitField1;</span><br><span class="line">            peb.BitField1 = bitField1 | Native.PEBBitField1.IsLongPathAwareProcess;</span><br><span class="line">            Marshal.StructureToPtr&lt;Native.PEB_Beginning&gt;(peb, pPeb, false);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //Free allocated space</span><br><span class="line">        Marshal.FreeHGlobal(pPbi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    static class Native</span><br><span class="line">    &#123;</span><br><span class="line">        // http://pinvoke.net/default.aspx/Structures/PROCESS_BASIC_INFORMATION.html</span><br><span class="line">        [StructLayout(LayoutKind.Sequential, Pack = 1)]</span><br><span class="line">        internal struct PROCESS_BASIC_INFORMATION</span><br><span class="line">        &#123;</span><br><span class="line">            public IntPtr ExitStatus;</span><br><span class="line">            public IntPtr PebBaseAddress;</span><br><span class="line">            public IntPtr AffinityMask;</span><br><span class="line">            public IntPtr BasePriority;</span><br><span class="line">            public UIntPtr UniqueProcessId;</span><br><span class="line">            public IntPtr InheritedFromUniqueProcessId;</span><br><span class="line"></span><br><span class="line">            public int Size</span><br><span class="line">            &#123;</span><br><span class="line">                get &#123; return (int)Marshal.SizeOf(typeof(PROCESS_BASIC_INFORMATION)); &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [Flags]</span><br><span class="line">        internal enum PEBBitField1 : byte</span><br><span class="line">        &#123;</span><br><span class="line">            None = 0,</span><br><span class="line">            ImageUsesLargePages = 1 &lt;&lt; 0,</span><br><span class="line">            IsProtectedProcess = 1 &lt;&lt; 1,</span><br><span class="line">            IsImageDynamicallyRelocated = 1 &lt;&lt; 2,</span><br><span class="line">            SkipPatchingUser32Forwarders = 1 &lt;&lt; 3,</span><br><span class="line">            IsPackagedProcess = 1 &lt;&lt; 4,</span><br><span class="line">            IsAppContainer = 1 &lt;&lt; 5,</span><br><span class="line">            IsProtectedProcessLight = 1 &lt;&lt; 6,</span><br><span class="line">            IsLongPathAwareProcess = 1 &lt;&lt; 7</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Note: this only contains the &quot;beginning&quot; of the PEB structure</span><br><span class="line">        // but that is all we need for access to the IsLongPathAwareProcess bit</span><br><span class="line">        // Used as a guide: https://github.com/processhacker/processhacker/blob/master/phnt/include/ntpebteb.h#L75</span><br><span class="line">        // Related: https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb</span><br><span class="line">        [StructLayout(LayoutKind.Sequential, Pack = 1)]</span><br><span class="line">        internal struct PEB_Beginning</span><br><span class="line">        &#123;</span><br><span class="line">            Byte InheritedAddressSpace;</span><br><span class="line">            Byte ReadImageFileExecOptions;</span><br><span class="line">            Byte BeingDebugged;</span><br><span class="line">            public PEBBitField1 BitField1;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        // https://www.pinvoke.net/default.aspx/ntdll.ntqueryinformationprocess</span><br><span class="line">        [DllImport(&quot;ntdll.dll&quot;, SetLastError = true)]</span><br><span class="line">        internal static extern int NtQueryInformationProcess(IntPtr processHandle, int processInformationClass, IntPtr processInformation, uint processInformationLength, IntPtr returnLength);</span><br><span class="line"></span><br><span class="line">        // The below is for test purposes only:</span><br><span class="line">        // Include CreateDirectory for testing if the long path aware changes work or not.</span><br><span class="line">        // Requires SECURITY_ATTRIBUTES</span><br><span class="line">        // http://pinvoke.net/default.aspx/kernel32/CreateDirectory.html?diff=y</span><br><span class="line">        [DllImport(&quot;kernel32.dll&quot;, SetLastError = true, CharSet = CharSet.Auto, BestFitMapping = false)]</span><br><span class="line">        internal static extern bool CreateDirectory(String path, SECURITY_ATTRIBUTES lpSecurityAttributes);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // https://www.pinvoke.net/default.aspx/Structures/SECURITY_ATTRIBUTES.html</span><br><span class="line">        [StructLayout(LayoutKind.Sequential)]</span><br><span class="line">        internal class SECURITY_ATTRIBUTES</span><br><span class="line">        &#123;</span><br><span class="line">            internal int nLength = 0;</span><br><span class="line">            // don&apos;t remove null, or this field will disappear in bcl.small</span><br><span class="line">            internal unsafe byte* pSecurityDescriptor = null;</span><br><span class="line">            internal int bInheritHandle = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cXSD生成的数据集类的对象实例化期间出现错误堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cXSD生成的数据集类的对象实例化期间出现错误堆栈内存溢出.html" itemprop="url">cXSD生成的数据集类的对象实例化期间出现错误堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Getting error during object instantiation for xsd generated dataset class



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
提供了一个XML文件和一个适当的XSD文件。 我使用xsd.exe程序基于XSD文件（ xsd /dataset TestV7.xsd ）生成数据集类，并将其导入到VS2019（社区版）C＃项目中。 当我尝试使用NewDataSet testset = new NewDataSet;实例化对象时， NewDataSet testset = new NewDataSet; 我得到错误


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.ArgumentException HResult=0x80070057 Message=Cannot set Column &apos;IDCode_text&apos; property MaxLength. The Column is SimpleContent. Source=&lt;Cannot evaluate the exception source&gt; StackTrace: &lt;Cannot evaluate the exception stack trace&gt;</span><br></pre></td></tr></table></figure>


谁能帮助我解决此错误？ 在XML处理方面，我是一个新手，但我通常可以解决问题。 这是XSD文件的子集，在编译时会给我错误。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;xs:schema xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; elementFormDefault=&quot;qualified&quot; attributeFormDefault=&quot;unqualified&quot;&gt; &lt;xs:element name=&quot;HOST&quot;&gt; &lt;xs:complexType&gt; &lt;xs:sequence&gt; &lt;xs:element name=&quot;Header&quot; type=&quot;Header&quot; minOccurs=&quot;0&quot;/&gt; &lt;xs:element name=&quot;Departments&quot; minOccurs=&quot;0&quot;&gt; &lt;xs:complexType&gt; &lt;xs:sequence&gt; &lt;xs:element name=&quot;Department&quot; type=&quot;Department&quot; maxOccurs=&quot;unbounded&quot;/&gt; &lt;/xs:sequence&gt; &lt;/xs:complexType&gt; &lt;/xs:element&gt; &lt;/xs:sequence&gt; &lt;xs:attribute name=&quot;Type&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:length value=&quot;1&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:attribute&gt; &lt;/xs:complexType&gt; &lt;/xs:element&gt; &lt;xs:simpleType name=&quot;IDType&quot;&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:minLength value=&quot;5&quot;/&gt; &lt;xs:maxLength value=&quot;8&quot;/&gt; &lt;xs:pattern value=&quot;\d&#123;5&#125;&quot;/&gt; &lt;xs:pattern value=&quot;\d&#123;8&#125;&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;xs:simpleType name=&quot;HostAction&quot;&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:length value=&quot;1&quot;/&gt; &lt;xs:enumeration value=&quot;D&quot;/&gt; &lt;xs:enumeration value=&quot;I&quot;/&gt; &lt;xs:enumeration value=&quot;U&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;xs:simpleType name=&quot;BusinessPillar&quot;&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:length value=&quot;3&quot;/&gt; &lt;xs:enumeration value=&quot;ALM&quot;/&gt; &lt;xs:enumeration value=&quot;CCC&quot;/&gt; &lt;xs:enumeration value=&quot;CSD&quot;/&gt; &lt;xs:enumeration value=&quot;CWD&quot;/&gt; &lt;xs:enumeration value=&quot;IGA&quot;/&gt; &lt;xs:enumeration value=&quot;TAS&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;xs:complexType name=&quot;Header&quot;&gt; &lt;xs:sequence&gt; &lt;xs:element name=&quot;IDCode&quot;&gt; &lt;xs:complexType&gt; &lt;xs:simpleContent&gt; &lt;xs:extension base=&quot;IDType&quot;&gt; &lt;xs:attribute name=&quot;Type&quot; use=&quot;required&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:length value=&quot;1&quot;/&gt; &lt;xs:enumeration value=&quot;C&quot;/&gt; &lt;xs:enumeration value=&quot;I&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:attribute&gt; &lt;/xs:extension&gt; &lt;/xs:simpleContent&gt; &lt;/xs:complexType&gt; &lt;/xs:element&gt; &lt;xs:element name=&quot;CreationDate&quot; type=&quot;xs:dateTime&quot;/&gt; &lt;xs:element name=&quot;Version&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:length value=&quot;5&quot;/&gt; &lt;xs:pattern value=&quot;\d\.\d\.\d&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:element&gt; &lt;xs:element name=&quot;PricingZone&quot; minOccurs=&quot;0&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:integer&quot;&gt; &lt;xs:totalDigits value=&quot;2&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:element&gt; &lt;xs:element name=&quot;Business&quot; type=&quot;BusinessPillar&quot; minOccurs=&quot;0&quot;/&gt; &lt;xs:element name=&quot;State&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:minLength value=&quot;2&quot;/&gt; &lt;xs:maxLength value=&quot;3&quot;/&gt; &lt;xs:enumeration value=&quot;ACT&quot;/&gt; &lt;xs:enumeration value=&quot;NSW&quot;/&gt; &lt;xs:enumeration value=&quot;NT&quot;/&gt; &lt;xs:enumeration value=&quot;NZ&quot;/&gt; &lt;xs:enumeration value=&quot;QLD&quot;/&gt; &lt;xs:enumeration value=&quot;SA&quot;/&gt; &lt;xs:enumeration value=&quot;TAS&quot;/&gt; &lt;xs:enumeration value=&quot;VIC&quot;/&gt; &lt;xs:enumeration value=&quot;WA&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:element&gt; &lt;/xs:sequence&gt; &lt;/xs:complexType&gt; &lt;xs:complexType name=&quot;Department&quot;&gt; &lt;xs:sequence&gt; &lt;xs:element name=&quot;Description&quot; minOccurs=&quot;0&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:minLength value=&quot;1&quot;/&gt; &lt;xs:maxLength value=&quot;40&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:element&gt; &lt;/xs:sequence&gt; &lt;xs:attribute name=&quot;DepartmentNumber&quot; use=&quot;required&quot;&gt; &lt;xs:simpleType&gt; &lt;xs:restriction base=&quot;xs:string&quot;&gt; &lt;xs:length value=&quot;2&quot;/&gt; &lt;xs:pattern value=&quot;\d&#123;2&#125;&quot;/&gt; &lt;/xs:restriction&gt; &lt;/xs:simpleType&gt; &lt;/xs:attribute&gt; &lt;xs:attribute name=&quot;Action&quot; type=&quot;HostAction&quot; use=&quot;required&quot;/&gt; &lt;/xs:complexType&gt; &lt;/xs:schema&gt;</span><br></pre></td></tr></table></figure>


我一直在在线研究不同的事物，并且XSD文件看起来是有效的，并且在构建c＃文件时xsd.exe不会给出任何错误。 我不知道这与XSD文件有关，但是在VS中生成错误的代码非常基本。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Data; using System.Xml; namespace ImportV7Host &#123; class Program &#123; static void Main(string[] args) &#123; // create a new dataset for the imported data NewDataSet testset = new NewDataSet(); testset.Dispose(); &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

令人讨厌的行似乎是IDType的maxLength定义： 我不知道为什么它不起作用，因为这似乎是有效的xs：simpleType定义。 也许可以不用maxLength来解决问题，因为您拥有xs：pattern方面。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;xs:simpleType name=&quot;IDType&quot;&gt;</span><br><span class="line">       &lt;xs:restriction base=&quot;xs:string&quot;&gt;</span><br><span class="line">           &lt;xs:minLength value=&quot;5&quot;/&gt;</span><br><span class="line">           &lt;xs:maxLength value=&quot;8&quot;/&gt; &lt;!-- Offending line --&gt;</span><br><span class="line">           &lt;xs:pattern value=&quot;\d&#123;5&#125;&quot;/&gt;</span><br><span class="line">           &lt;xs:pattern value=&quot;\d&#123;8&#125;&quot;/&gt;</span><br><span class="line">       &lt;/xs:restriction&gt;</span><br><span class="line">   &lt;/xs:simpleType&gt;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

这是您应该使用的代码：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br></pre></td><td class="code"><pre><span class="line"> using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Xml;</span><br><span class="line">using System.Xml.Serialization;</span><br><span class="line"></span><br><span class="line">namespace ConsoleApplication1</span><br><span class="line">&#123;</span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        const string FILENAME = @&quot;c:\temp\test.xml&quot;;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            XmlReader reader = XmlReader.Create(FILENAME);</span><br><span class="line"></span><br><span class="line">            XmlSerializer serializer = new XmlSerializer(typeof(HOST));</span><br><span class="line"></span><br><span class="line">            HOST host = (HOST)serializer.Deserialize(reader);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //------------------------------------------------------------------------------</span><br><span class="line">    // &lt;auto-generated&gt;</span><br><span class="line">    //     This code was generated by a tool.</span><br><span class="line">    //     Runtime Version:2.0.50727.6421</span><br><span class="line">    //</span><br><span class="line">    //     Changes to this file may cause incorrect behavior and will be lost if</span><br><span class="line">    //     the code is regenerated.</span><br><span class="line">    // &lt;/auto-generated&gt;</span><br><span class="line">    //------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    // </span><br><span class="line">    // This source code was auto-generated by xsd, Version=2.0.50727.3038.</span><br><span class="line">    // </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    [System.Diagnostics.DebuggerStepThroughAttribute()]</span><br><span class="line">    [System.ComponentModel.DesignerCategoryAttribute(&quot;code&quot;)]</span><br><span class="line">    [System.Xml.Serialization.XmlTypeAttribute(AnonymousType=true)]</span><br><span class="line">    [System.Xml.Serialization.XmlRootAttribute(Namespace=&quot;&quot;, IsNullable=false)]</span><br><span class="line">    public partial class HOST &#123;</span><br><span class="line"></span><br><span class="line">        private Header headerField;</span><br><span class="line"></span><br><span class="line">        private Department[] departmentsField;</span><br><span class="line"></span><br><span class="line">        private string typeField;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public Header Header &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.headerField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.headerField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlArrayItemAttribute(IsNullable=false)]</span><br><span class="line">        public Department[] Departments &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.departmentsField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.departmentsField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlAttributeAttribute()]</span><br><span class="line">        public string Type &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.typeField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.typeField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    [System.Diagnostics.DebuggerStepThroughAttribute()]</span><br><span class="line">    [System.ComponentModel.DesignerCategoryAttribute(&quot;code&quot;)]</span><br><span class="line">    public partial class Header &#123;</span><br><span class="line"></span><br><span class="line">        private HeaderIDCode iDCodeField;</span><br><span class="line"></span><br><span class="line">        private System.DateTime creationDateField;</span><br><span class="line"></span><br><span class="line">        private string versionField;</span><br><span class="line"></span><br><span class="line">        private string pricingZoneField;</span><br><span class="line"></span><br><span class="line">        private BusinessPillar businessField;</span><br><span class="line"></span><br><span class="line">        private bool businessFieldSpecified;</span><br><span class="line"></span><br><span class="line">        private HeaderState stateField;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public HeaderIDCode IDCode &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.iDCodeField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.iDCodeField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public System.DateTime CreationDate &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.creationDateField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.creationDateField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public string Version &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.versionField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.versionField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlElementAttribute(DataType=&quot;integer&quot;)]</span><br><span class="line">        public string PricingZone &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.pricingZoneField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.pricingZoneField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public BusinessPillar Business &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.businessField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.businessField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlIgnoreAttribute()]</span><br><span class="line">        public bool BusinessSpecified &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.businessFieldSpecified;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.businessFieldSpecified = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public HeaderState State &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.stateField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.stateField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    [System.Diagnostics.DebuggerStepThroughAttribute()]</span><br><span class="line">    [System.ComponentModel.DesignerCategoryAttribute(&quot;code&quot;)]</span><br><span class="line">    [System.Xml.Serialization.XmlTypeAttribute(AnonymousType=true)]</span><br><span class="line">    public partial class HeaderIDCode &#123;</span><br><span class="line"></span><br><span class="line">        private HeaderIDCodeType typeField;</span><br><span class="line"></span><br><span class="line">        private string valueField;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlAttributeAttribute()]</span><br><span class="line">        public HeaderIDCodeType Type &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.typeField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.typeField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlTextAttribute()]</span><br><span class="line">        public string Value &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.valueField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.valueField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    [System.Xml.Serialization.XmlTypeAttribute(AnonymousType=true)]</span><br><span class="line">    public enum HeaderIDCodeType &#123;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        C,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        I,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    [System.Diagnostics.DebuggerStepThroughAttribute()]</span><br><span class="line">    [System.ComponentModel.DesignerCategoryAttribute(&quot;code&quot;)]</span><br><span class="line">    public partial class Department &#123;</span><br><span class="line"></span><br><span class="line">        private string descriptionField;</span><br><span class="line"></span><br><span class="line">        private string departmentNumberField;</span><br><span class="line"></span><br><span class="line">        private HostAction actionField;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        public string Description &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.descriptionField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.descriptionField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlAttributeAttribute()]</span><br><span class="line">        public string DepartmentNumber &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.departmentNumberField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.departmentNumberField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        [System.Xml.Serialization.XmlAttributeAttribute()]</span><br><span class="line">        public HostAction Action &#123;</span><br><span class="line">            get &#123;</span><br><span class="line">                return this.actionField;</span><br><span class="line">            &#125;</span><br><span class="line">            set &#123;</span><br><span class="line">                this.actionField = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    public enum HostAction &#123;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        D,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        I,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        U,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    public enum BusinessPillar &#123;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        ALM,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        CCC,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        CSD,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        CWD,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        IGA,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        TAS,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// &lt;remarks/&gt;</span><br><span class="line">    [System.CodeDom.Compiler.GeneratedCodeAttribute(&quot;xsd&quot;, &quot;2.0.50727.3038&quot;)]</span><br><span class="line">    [System.SerializableAttribute()]</span><br><span class="line">    [System.Xml.Serialization.XmlTypeAttribute(AnonymousType=true)]</span><br><span class="line">    public enum HeaderState &#123;</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        ACT,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        NSW,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        NT,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        NZ,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        QLD,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        SA,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        TAS,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        VIC,</span><br><span class="line"></span><br><span class="line">        /// &lt;remarks/&gt;</span><br><span class="line">        WA,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cXML未正确序列化为对象堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cXML未正确序列化为对象堆栈内存溢出.html" itemprop="url">cXML未正确序列化为对象堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
XML not being serialised correctly into object



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在尝试序列化从第三方API返回的XML。 但是，这样做时，我仅在序列化时检索对象的一部分。 而且似乎只有一些价值存在。 我以为这可能是输入类型问题，但是所有类型似乎都是正确的。 我认为这可能与我的模型的构造有关。调试代码后，我将其范围缩小为将xml转换为对象的问题。


C＃代码：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//[Route(&quot;api/AvailabiliyCheck/GetAvailability/&#123;CSSDistrictCode&#125;/&#123;GoldAddressKey&#125;&quot;)] public EADAvailabilityDetails GetAvailabilityEAD([FromUri] string CSSDistrictCode, [FromUri] string GoldAddressKey) &#123; //Load the request xml template XmlDocument doc = new XmlDocument(); string path = HttpContext.Current.Server.MapPath(&quot;~/XML/Availability/GetAvailabilityEAD.xml&quot;); doc.Load(path); //Assign incoming paramaters to xml template XmlNamespaceManager manager = new XmlNamespaceManager(doc.NameTable); manager.AddNamespace(&quot;soap&quot;, &quot;http://schemas.xmlsoap.org/soap/envelope/&quot;); manager.AddNamespace(&quot;stupid_xmlns&quot;, &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;); XmlNode CSSDistrictCodeNode = doc.SelectSingleNode(&quot;soap:Envelope/soap:Body/stupid_xmlns:GetAvailability/stupid_xmlns:request/stupid_xmlns:RequestDetails/stupid_xmlns:CSSDistrictCode&quot;, manager); CSSDistrictCodeNode.InnerXml = CSSDistrictCode; XmlNode GoldAddressKeyNode = doc.SelectSingleNode(&quot;soap:Envelope/soap:Body/stupid_xmlns:GetAvailability/stupid_xmlns:request/stupid_xmlns:RequestDetails/stupid_xmlns:GoldAddressKey&quot;, manager); GoldAddressKeyNode.InnerXml = GoldAddressKey; //Send Request To API string _url = &quot;https://b2b.api.talktalkgroup.com/api/v2/partners/AvailabilityCheckers/NPAC/v45&quot;; string _action = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService/NetworkProductAvailabilityCheckerService/GetAvailability&quot;; string xml = doc.InnerXml; var soapResult = WebService.ApiRequest(_url, _action, xml); XmlDocument xmlToFormat = new XmlDocument(); xmlToFormat.LoadXml(soapResult); string Outerxml = xmlToFormat.FirstChild.FirstChild.FirstChild.FirstChild.ChildNodes[2].InnerXml; //Remove all namespaces var xmlToBeStripped = XElement.Parse(Outerxml); string finalXml = XmlFormatter.stripNS(xmlToBeStripped).ToString(); EADAvailabilityDetails result; // Deserialises xlm into an object XmlSerializer serializer = new XmlSerializer(typeof(EADAvailabilityDetails)); using (TextReader reader = new StringReader(finalXml)) &#123; result = (EADAvailabilityDetails)serializer.Deserialize(reader); &#125; return result; &#125;</span><br></pre></td></tr></table></figure>


返回的XML：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;s:Envelope xmlns:s=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt; &lt;s:Body&gt; &lt;GetAvailabilityResponse xmlns=&quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;&gt; &lt;GetAvailabilityResult xmlns:i=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt; &lt;Status xmlns=&quot;http://schemas.datacontract.org/2004/07/InHouse.SharedLibraries.ServiceBase.BaseTypes&quot;&gt; &lt;Errors/&gt; &lt;HasErrors&gt;false&lt;/HasErrors&gt; &lt;/Status&gt; &lt;CSSDistrictCode&gt;lv&lt;/CSSDistrictCode&gt; &lt;EADAvailability&gt; &lt;AvailabilityDetails i:type=&quot;EADAvailabilityDetails&quot;&gt; &lt;Status xmlns=&quot;http://schemas.datacontract.org/2004/07/InHouse.SharedLibraries.ServiceBase.BaseTypes&quot;&gt; &lt;Errors/&gt; &lt;HasErrors&gt;false&lt;/HasErrors&gt; &lt;/Status&gt; &lt;EADAvailability&gt; &lt;EADAvailabilityResult&gt; &lt;CollectorNodeExchangeCode&gt;NDMAI&lt;/CollectorNodeExchangeCode&gt; &lt;CollectorNodeExchangeName&gt;Maidstone&lt;/CollectorNodeExchangeName&gt; &lt;Distance&gt;0&lt;/Distance&gt; &lt;EADBandwidth xmlns:a=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt; &lt;a:string&gt;100M&lt;/a:string&gt; &lt;/EADBandwidth&gt; &lt;EADSubType&gt;EAD-LA&lt;/EADSubType&gt; &lt;FibreExchangeCode&gt;NDACO&lt;/FibreExchangeCode&gt; &lt;FibreExchangename&gt;Archers Court&lt;/FibreExchangename&gt; &lt;IndicativeECC&gt;Within tariff&lt;/IndicativeECC&gt; &lt;IndicativeOrderCategory&gt;Category 2.1&lt;/IndicativeOrderCategory&gt; &lt;LocalExchangeCode&gt;NDACO&lt;/LocalExchangeCode&gt; &lt;LocalExchangeName&gt;Archers Court&lt;/LocalExchangeName&gt; &lt;ORLeadTime&gt;40&lt;/ORLeadTime&gt; &lt;OrderCategoryExplanation&gt;There is a T node within 1km (or 650m in London) with spare capacity and ducting is in place, however some additional cabling is required between the premises and the T node.&lt;/OrderCategoryExplanation&gt; &lt;TTLeadTime&gt;56&lt;/TTLeadTime&gt; &lt;Zone&gt;0&lt;/Zone&gt; &lt;/EADAvailabilityResult&gt; &lt;EADAvailabilityResult&gt; &lt;CollectorNodeExchangeCode&gt;NDMAI&lt;/CollectorNodeExchangeCode&gt; &lt;CollectorNodeExchangeName&gt;Maidstone&lt;/CollectorNodeExchangeName&gt; &lt;Distance&gt;0&lt;/Distance&gt; &lt;EADBandwidth xmlns:a=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt; &lt;a:string&gt;LOW 1GB&lt;/a:string&gt; &lt;/EADBandwidth&gt; &lt;EADSubType&gt;EAD-LA&lt;/EADSubType&gt; &lt;FibreExchangeCode&gt;NDACO&lt;/FibreExchangeCode&gt; &lt;FibreExchangename&gt;Archers Court&lt;/FibreExchangename&gt; &lt;IndicativeECC&gt;Within tariff&lt;/IndicativeECC&gt; &lt;IndicativeOrderCategory&gt;Category 2.1&lt;/IndicativeOrderCategory&gt; &lt;LocalExchangeCode&gt;NDACO&lt;/LocalExchangeCode&gt; &lt;LocalExchangeName&gt;Archers Court&lt;/LocalExchangeName&gt; &lt;ORLeadTime&gt;40&lt;/ORLeadTime&gt; &lt;OrderCategoryExplanation&gt;There is a T node within 1km (or 650m in London) with spare capacity and ducting is in place, however some additional cabling is required between the premises and the T node.&lt;/OrderCategoryExplanation&gt; &lt;TTLeadTime&gt;56&lt;/TTLeadTime&gt; &lt;Zone&gt;0&lt;/Zone&gt; &lt;/EADAvailabilityResult&gt; &lt;EADAvailabilityResult&gt; &lt;CollectorNodeExchangeCode&gt;NDCAN&lt;/CollectorNodeExchangeCode&gt; &lt;CollectorNodeExchangeName&gt;Canterbury&lt;/CollectorNodeExchangeName&gt; &lt;Distance&gt;20656&lt;/Distance&gt; &lt;EADBandwidth xmlns:a=&quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;&gt; &lt;a:string&gt;HIGH 1GB&lt;/a:string&gt; &lt;/EADBandwidth&gt; &lt;EADSubType&gt;EAD-NonLA&lt;/EADSubType&gt; &lt;FibreExchangeCode&gt;NDCAN&lt;/FibreExchangeCode&gt; &lt;FibreExchangename&gt;Canterbury&lt;/FibreExchangename&gt; &lt;IndicativeECC&gt;Within tariff&lt;/IndicativeECC&gt; &lt;IndicativeOrderCategory&gt;Category 2.1&lt;/IndicativeOrderCategory&gt; &lt;LocalExchangeCode&gt;NDACO&lt;/LocalExchangeCode&gt; &lt;LocalExchangeName&gt;Archers Court&lt;/LocalExchangeName&gt; &lt;ORLeadTime&gt;40&lt;/ORLeadTime&gt; &lt;OrderCategoryExplanation&gt;There is a T node within 1km (or 650m in London) with spare capacity and ducting is in place, however some additional cabling is required between the premises and the T node.&lt;/OrderCategoryExplanation&gt; &lt;TTLeadTime&gt;56&lt;/TTLeadTime&gt; &lt;Zone&gt;B&lt;/Zone&gt; &lt;/EADAvailabilityResult&gt; &lt;/EADAvailability&gt; &lt;LeadTime&gt;10&lt;/LeadTime&gt; &lt;/AvailabilityDetails&gt; &lt;/EADAvailability&gt; &lt;GoldAddressKey&gt;A00009292752&lt;/GoldAddressKey&gt; &lt;Postcode/&gt; &lt;/GetAvailabilityResult&gt; &lt;/GetAvailabilityResponse&gt; &lt;/s:Body&gt; &lt;/s:Envelope&gt;</span><br></pre></td></tr></table></figure>


模型：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Serializable, XmlRoot(&quot;AvailabilityDetails&quot;)] public class EADAvailabilityDetails &#123; [XmlElement(&quot;EADAvailability&quot;)] public EADAvailability EADAvailability &#123; get; set; &#125; &#125; public class EADAvailability &#123; [XmlElement(&quot;EADAvailabilityResult&quot;)] public List&lt;EADAvailabilityResult&gt; EADAvailabilityResult &#123; get; set; &#125; &#125; public class EADAvailabilityResult &#123; [XmlElement(&quot;CollectorNodeExchangeCode&quot;)] public string CollectorNodeExchangeCode &#123; get; set; &#125; [XmlElement(&quot;CollectorNodeExchangeName&quot;)] public string CollectorNodeExchangeName &#123; get; set; &#125; [XmlElement(&quot;Distance&quot;)] public int Distance &#123; get; set; &#125; [XmlElement(&quot;EADBandwidth&quot;)] public string EADBandwidth &#123; get; set; &#125; [XmlElement(&quot;EADSubType&quot;)] public string EADSubType &#123; get; set; &#125; [XmlElement(&quot;FibreExchangeCode&quot;)] public string FibreExchangeCode &#123; get; set; &#125; [XmlElement(&quot;FibreExchangename&quot;)] public string FibreExchangename &#123; get; set; &#125; [XmlElement(&quot;IndicativeECC&quot;)] public string IndicativeECC &#123; get; set; &#125; [XmlElement(&quot;IndicativeOrderCategory&quot;)] public string IndicativeOrderCategory &#123; get; set; &#125; [XmlElement(&quot;LocalExchangeCode&quot;)] public string LocalExchangeCode &#123; get; set; &#125; [XmlElement(&quot;LocalExchangeName&quot;)] public string LocalExchangeName &#123; get; set; &#125; [XmlElement(&quot;ORLeadTime&quot;)] public int ORLeadTime &#123; get; set; &#125; [XmlElement(&quot;OrderCategoryExplanation&quot;)] public string OrderCategoryExplanation &#123; get; set; &#125; [XmlElement(&quot;TTLeadTime&quot;)] public int TTLeadTime &#123; get; set; &#125; [XmlElement(&quot;Zone&quot;)] public int Zone &#123; get; set; &#125; &#125;</span><br></pre></td></tr></table></figure>


序列化后的XML：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;&lt;EADAvailability&gt;k__BackingField&quot;: &#123; &quot;EADAvailabilityResult&quot;: [ &#123; &quot;CollectorNodeExchangeCode&quot;: &quot;NDMAI&quot;, &quot;CollectorNodeExchangeName&quot;: &quot;Maidstone&quot;, &quot;Distance&quot;: 0, &quot;EADBandwidth&quot;: &quot;100M&quot;, &quot;EADSubType&quot;: null, &quot;FibreExchangeCode&quot;: null, &quot;FibreExchangename&quot;: null, &quot;IndicativeECC&quot;: null, &quot;IndicativeOrderCategory&quot;: null, &quot;LocalExchangeCode&quot;: null, &quot;LocalExchangeName&quot;: null, &quot;ORLeadTime&quot;: 0, &quot;OrderCategoryExplanation&quot;: null, &quot;TTLeadTime&quot;: 0, &quot;Zone&quot;: 0 &#125; ] &#125;</span><br></pre></td></tr></table></figure>


}


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

下面的代码有效：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"> using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Xml;</span><br><span class="line">using System.Xml.Serialization;</span><br><span class="line"></span><br><span class="line">namespace ConsoleApplication139</span><br><span class="line">&#123;</span><br><span class="line">    class Program</span><br><span class="line">    &#123;</span><br><span class="line">        const string FILENAME = @&quot;c:\temp\test.xml&quot;;</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        &#123;</span><br><span class="line">            XmlReader reader = XmlReader.Create(FILENAME);</span><br><span class="line">            XmlSerializer serializer = new XmlSerializer(typeof(Envelope));</span><br><span class="line"></span><br><span class="line">            Envelope envelope = (Envelope)serializer.Deserialize(reader);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [XmlRoot(Namespace = &quot;http://schemas.xmlsoap.org/soap/envelope/&quot;)]</span><br><span class="line">    public class Envelope</span><br><span class="line">    &#123;</span><br><span class="line">        [XmlElement (Namespace = &quot;http://schemas.xmlsoap.org/soap/envelope/&quot;)]</span><br><span class="line">        public Body Body &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class Body</span><br><span class="line">    &#123;</span><br><span class="line">        [XmlElement(Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">        public GetAvailabilityResponse GetAvailabilityResponse &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class GetAvailabilityResponse</span><br><span class="line">    &#123;</span><br><span class="line">        [XmlElement(Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">        public GetAvailabilityResult GetAvailabilityResult &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class GetAvailabilityResult</span><br><span class="line">    &#123;</span><br><span class="line">        [XmlArray(&quot;EADAvailability&quot;, Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">        [XmlArrayItem(&quot;AvailabilityDetails&quot;, Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">        public AvailabilityDetails[] AvailabilityDetails &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [XmlInclude(typeof(EADAvailabilityDetails))]</span><br><span class="line">    [Serializable, XmlRoot(&quot;AvailabilityDetails&quot;, Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">    public class AvailabilityDetails</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    [Serializable, XmlRoot(&quot;EADAvailabilityDetails&quot;, Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">    public class EADAvailabilityDetails : AvailabilityDetails</span><br><span class="line">    &#123;</span><br><span class="line">        [XmlArray(&quot;EADAvailability&quot;, Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">        [XmlArrayItem(&quot;EADAvailabilityResult&quot;, Namespace = &quot;http://webservices.talktalkplc.com/NetworkProductAvailabilityCheckerService&quot;)]</span><br><span class="line">        public EADAvailabilityResult[] EADAvailabilityResult &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class EADAvailabilityResult</span><br><span class="line">    &#123;</span><br><span class="line">        public string CollectorNodeExchangeCode &#123; get; set; &#125;</span><br><span class="line">        public string CollectorNodeExchangeName &#123; get; set; &#125;</span><br><span class="line">        public int Distance &#123; get; set; &#125;</span><br><span class="line">        public EADBandwidth EADBandwidth &#123; get; set; &#125;</span><br><span class="line">        public string EADSubType &#123; get; set; &#125;</span><br><span class="line">        public string FibreExchangeCode &#123; get; set; &#125;</span><br><span class="line">        public string FibreExchangename &#123; get; set; &#125;</span><br><span class="line">        public string IndicativeECC &#123; get; set; &#125;</span><br><span class="line">        public string IndicativeOrderCategory &#123; get; set; &#125;</span><br><span class="line">        public string LocalExchangeCode &#123; get; set; &#125;</span><br><span class="line">        public string LocalExchangeName &#123; get; set; &#125;</span><br><span class="line">        public int ORLeadTime &#123; get; set; &#125;</span><br><span class="line">        public string OrderCategoryExplanation &#123; get; set; &#125;</span><br><span class="line">        public int TTLeadTime &#123; get; set; &#125;</span><br><span class="line">        public string Zone &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public class EADBandwidth</span><br><span class="line">    &#123;</span><br><span class="line">        [XmlElement(ElementName = &quot;string&quot;, Type = typeof(string), Namespace = &quot;http://schemas.microsoft.com/2003/10/Serialization/Arrays&quot;)]</span><br><span class="line">        public string String &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../amazonwebservicesboto3会话持续多长时间在我的服务中我希望从多个区域获取实例并考虑为每个区域创建一个会话堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../amazonwebservicesboto3会话持续多长时间在我的服务中我希望从多个区域获取实例并考虑为每个区域创建一个会话堆栈内存溢出.html" itemprop="url">amazonwebservicesboto3会话持续多长时间在我的服务中我希望从多个区域获取实例并考虑为每个区域创建一个会话堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
How long does a boto3 session persist? In my service, I'm looking to get instance from multiple regions and thinking of creating a session for each



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我是Boto库的新手，我不确定是否每次可以对我的服务进行api调用时都可以创建会话和资源，从而可以从ec2中获取实例或一次创建会话并持久化。 我没有传递任何令牌或任何东西。 在文档中找不到任何内容。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：2</strong></p>

你是对的。 这里的文档不是很有启发性。 会话封装了配置（例如凭据，区域和端点）。 通常，我会在API路由处理之外为每个配置元组创建一个会话，以便可以重复使用它。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows窗体冻结不回答堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows窗体冻结不回答堆栈内存溢出.html" itemprop="url">cWindows窗体冻结不回答堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Windows Forms freezes and don't answer



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我的实验室是关于日程安排的，我使用了改进的Kron算法。 当按下按钮时，表格应在4个RichBox上打印信息。 有时一切正常，但有时表格冻结并且不回答。 如果打开“任务管理器”窗口，我的应用程序将占用大约30％的CPU。 也许是因为按钮的循环？ 也许我应该做更多的按钮？ 要不然是啥？ 我不明白..那么，概率是多少？


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using System; using System.Collections; using System.ComponentModel; using System.Data; using System.Drawing; using System.Linq; using System.Text; using System.Collections.Generic; using System.Windows.Forms; namespace LW3_OTPR_Forms &#123; public partial class Form1 : Form &#123; public Form1() &#123; InitializeComponent(); textBoxZ.Text = &quot;3&quot;; textBoxTasks.Text = &quot;12&quot;; textBoxProcs.Text = &quot;4&quot;; textBoxFrom.Text = &quot;10&quot;; textBoxTo.Text = &quot;20&quot;; &#125; private void buttonGetResult_Click(object sender, EventArgs e) &#123; richTextBoxMatrix.Clear(); richTextBox1.Clear(); richTextBox2.Clear(); richTextBox3.Clear(); int z = Convert.ToInt32(textBoxZ.Text); for (int i = 0; i &lt; z; i++) &#123; richTextBox1.Text += &quot;========= Z = &quot; + (i+1) +&quot; ===========&quot;; richTextBox1.Text += Environment.NewLine; richTextBox2.Text += &quot;========= Z = &quot; + (i + 1) + &quot; ===========&quot;; richTextBox2.Text += Environment.NewLine; richTextBox3.Text += &quot;========= Z = &quot; + (i + 1) + &quot; ===========&quot;; richTextBox3.Text += Environment.NewLine; Work.start1(Convert.ToInt32(textBoxTasks.Text), Convert.ToInt32(textBoxProcs.Text), Convert.ToInt32(textBoxFrom.Text), Convert.ToInt32(textBoxTo.Text)); richTextBoxMatrix.Text += &quot;Матрица &quot; + (i+1); richTextBoxMatrix.Text += Environment.NewLine; richTextBoxMatrix.Text += Work.strWork; var processors = new Individ(Convert.ToInt32(textBoxTasks.Text), Convert.ToInt32(textBoxFrom.Text), Convert.ToInt32(textBoxTo.Text), Convert.ToInt32(textBoxProcs.Text)); var procMonolit = new IndividMonolit(Convert.ToInt32(textBoxTasks.Text), Convert.ToInt32(textBoxFrom.Text), Convert.ToInt32(textBoxTo.Text), Convert.ToInt32(textBoxProcs.Text)); var procKritWay = new IndividKritWay(Convert.ToInt32(textBoxTasks.Text), Convert.ToInt32(textBoxFrom.Text), Convert.ToInt32(textBoxTo.Text), Convert.ToInt32(textBoxProcs.Text)); richTextBox1.Text += processors.print(); richTextBox2.Text += procKritWay.printKritWay(); richTextBox3.Text += procMonolit.printMonolit(); processors.proc.balance(); procKritWay.procKritWay.balanceKritWay(); procMonolit.procMonolit.balanceMonolit(); richTextBox1.Text += processors.proc.inf; richTextBox2.Text += procKritWay.procKritWay.infKritWay; richTextBox3.Text += procMonolit.procMonolit.infMonolit; &#125; &#125; &#125; static class Work &#123; public static string strWork; static public List&lt;List&lt;int&gt;&gt; arrayTask2d &#123; set; get; &#125; static public List&lt;int&gt; arrayTask &#123; set; get; &#125; static public void start1(int countWork, int countProc, int t1, int t2) &#123; strWork = string.Empty; int temp = 0; arrayTask = new List&lt;int&gt;(); arrayTask2d = new List&lt;List&lt;int&gt;&gt;(); List&lt;int&gt; taskRow = new List&lt;int&gt;(); for (int i = 0; i &lt; countWork; i++) &#123; temp = Constant.rnd.Next(t2 - t1) + t1 + 1; arrayTask.Add(temp); taskRow = new List&lt;int&gt;(); for (int j = 0; j &lt; countProc; j++) &#123; taskRow.Add(temp); &#125; arrayTask2d.Add(taskRow); &#125; for (int i = 0; i &lt; countWork; i++) &#123; for (int j = 0; j &lt; countProc; j++) &#123; strWork += arrayTask2d[i][j].ToString() + &quot; &quot;; &#125; strWork += Environment.NewLine; &#125; &#125; &#125; class Proc &#123; public string inf; public string infMonolit; public string infKritWay; private List&lt;List&lt;int&gt;&gt; procs; public List&lt;int&gt; this[int i] &#123; get &#123; return procs[i]; &#125; set &#123; procs[i] = value; &#125; &#125; public int CountProc &#123; get &#123; return procs.Count; &#125; &#125; public int delta &#123; get &#123; return procs.Max((a) =&gt; &#123; return a.Sum(); &#125;) - procs.Min((a) =&gt; &#123; return a.Sum(); &#125;); &#125; &#125; public Proc(int countProc) &#123; inf = string.Empty; infMonolit = string.Empty; infKritWay = string.Empty; procs = new List&lt;List&lt;int&gt;&gt;(); for (int i = 0; i &lt; countProc; i++) procs.Add(new List&lt;int&gt;()); &#125; private int getIndexOfMax() &#123; int result = 0; for (int i = 0; i &lt; procs.Count; i++) &#123; if (procs[i].Sum() &gt; procs[result].Sum()) result = i; &#125; return result; &#125; public int getIndexOfMin() &#123; int result = 0; for (int i = 0; i &lt; procs.Count; i++) &#123; if (procs[i].Sum() &lt; procs[result].Sum()) result = i; &#125; return result; &#125; private void addInf() &#123; for (int i = 0; i &lt; procs.Count; i++) &#123; inf += &quot; Процессор &quot; + (i + 1).ToString()+ &quot;: &quot;; for (int j = 0; j &lt; procs[i].Count; j++) inf += procs[i][j] + &quot; &quot;; inf += &quot;|| sum = &quot; + procs[i].Sum(); inf += Environment.NewLine; &#125; inf += &quot;Δ = &quot; + delta + Environment.NewLine; &#125; private void addInfMonolit() &#123; for (int i = 0; i &lt; procs.Count; i++) &#123; infMonolit += &quot; Процессор &quot; + (i + 1).ToString() + &quot;: &quot;; for (int j = 0; j &lt; procs[i].Count; j++) infMonolit += procs[i][j] + &quot; &quot;; infMonolit += &quot;|| sum = &quot; + procs[i].Sum(); infMonolit += Environment.NewLine; &#125; infMonolit += &quot;Δ = &quot; + delta + Environment.NewLine; &#125; private void addInfKritWay() &#123; for (int i = 0; i &lt; procs.Count; i++) &#123; infKritWay += &quot; Процессор &quot; + (i + 1).ToString() + &quot;: &quot;; for (int j = 0; j &lt; procs[i].Count; j++) infKritWay += procs[i][j] + &quot; &quot;; infKritWay += &quot;|| sum = &quot; + procs[i].Sum(); infKritWay += Environment.NewLine; &#125; infKritWay += &quot;Δ = &quot; + delta + Environment.NewLine; &#125; public void balance() &#123; bool flag = true; int max = 0; int min = 0; int dlt = 0; while (flag != false) &#123; max = getIndexOfMax(); min = getIndexOfMin(); for (int i = 0; i &lt; procs[max].Count; i++) &#123; dlt = procs[max].Sum() - procs[min].Sum(); if (procs[max][i] &lt; dlt) &#123; procs[min].Add(procs[max][i]); procs[max].RemoveAt(i); addInf(); balance(); &#125; &#125; for (int i = 0; i &lt; procs[max].Count; i++) &#123; for (int j = 0; j &lt; procs[min].Count; j++) &#123; if (procs[max][i] &gt; procs[min][j] &amp;&amp; procs[max][i] - procs[min][j] &lt; delta) &#123; //меняем местами int temp = procs[max][i]; procs[max][i] = procs[min][j]; procs[min][j] = temp; addInf(); balance(); &#125; &#125; &#125; flag = false; &#125; &#125; public void balanceKritWay() &#123; bool flag = true; int max = 0; int min = 0; int dlt = 0; while (flag != false) &#123; max = getIndexOfMax(); min = getIndexOfMin(); for (int i = 0; i &lt; procs[max].Count; i++) &#123; dlt = procs[max].Sum() - procs[min].Sum(); if (procs[max][i] &lt; dlt) &#123; procs[min].Add(procs[max][i]); procs[max].RemoveAt(i); addInfKritWay(); balanceKritWay(); &#125; &#125; for (int i = 0; i &lt; procs[max].Count; i++) &#123; for (int j = 0; j &lt; procs[min].Count; j++) &#123; if (procs[max][i] &gt; procs[min][j] &amp;&amp; procs[max][i] - procs[min][j] &lt; delta) &#123; //меняем местами int temp = procs[max][i]; procs[max][i] = procs[min][j]; procs[min][j] = temp; addInfKritWay(); balanceKritWay(); &#125; &#125; &#125; flag = false; &#125; &#125; public void balanceMonolit() &#123; bool flag = true; int max = 0; int min = 0; int dlt = 0; while (flag != false) &#123; max = getIndexOfMax(); min = getIndexOfMin(); for (int i = 0; i &lt; procs[max].Count; i++) &#123; dlt = procs[max].Sum() - procs[min].Sum(); if (procs[max][i] &lt; dlt) &#123; procs[min].Add(procs[max][i]); procs[max].RemoveAt(i); addInfMonolit(); balanceMonolit(); &#125; &#125; for (int i = 0; i &lt; procs[max].Count; i++) &#123; for (int j = 0; j &lt; procs[min].Count; j++) &#123; if (procs[max][i] &gt; procs[min][j] &amp;&amp; procs[max][i] - procs[min][j] &lt; delta) &#123; //меняем местами int temp = procs[max][i]; procs[max][i] = procs[min][j]; procs[min][j] = temp; addInfMonolit(); balanceMonolit(); &#125; &#125; &#125; flag = false; &#125; &#125; &#125; class Individ &#123; int numbJobs; int numbProc; private static uint CountIndivids &#123; get; set; &#125; //массив для создания расписания //(массив рандомных чисел каждое из которых соответствует заданию) public List&lt;int&gt; arrayRandom &#123; set; get; &#125; public List&lt;int&gt; arrayTasks &#123; set; get; &#125; public List&lt;int&gt; arrayProc; public Proc proc; //public Proc procKritWay; //максимальный порог рандома int randLimit; int x, y; string inf; public int Max &#123; get &#123; return arrayProc.Max(); &#125; &#125; public int NumberOfJobs &#123; get &#123; return arrayTasks.Count; &#125; &#125; public int NumberOfProc &#123; get &#123; return proc.CountProc; &#125; &#125; public int RandomLimit &#123; get &#123; return randLimit; &#125; &#125; public Individ() &#123; &#125; public Individ(Individ copy) &#123; arrayRandom = new List&lt;int&gt;(copy.arrayRandom); arrayTasks = new List&lt;int&gt;(copy.arrayTasks); //arrayProc = new List&lt;int&gt;(copy.arrayProc); numbJobs = copy.numbJobs; numbProc = copy.numbProc; randLimit = copy.randLimit; x = copy.x; y = copy.y; inf = copy.inf; &#125; public Individ(int numberOfJobs, int X, int Y, int numberOfProc, int randomLimit = 255) &#123; numbJobs = numberOfJobs; numbProc = numberOfProc; randLimit = randomLimit; x = X; y = Y; arrayTasks = new List&lt;int&gt;(Work.arrayTask); arrayRandom = new List&lt;int&gt;(); //заполнили массив рандомных чисел и работы for (int i = 0; i &lt; numbJobs; i++) arrayRandom.Add(Constant.rnd.Next(0, randLimit)); proc = new Proc(numbProc); schedule(); &#125; private void addInf() &#123; inf = &quot;Случайный разброс на процессоры: &quot;; inf += Environment.NewLine; for (int i = 0; i &lt; numbProc; i++) &#123; inf += &quot; Процессор &quot; + (i + 1).ToString() + &quot;:&quot;; for (int j = 0; j &lt; proc[i].Count; j++) inf += proc[i][j] + &quot; &quot;; inf += &quot;|| sum = &quot; + proc[i].Sum(); inf += Environment.NewLine; &#125; inf += &quot;Δ = &quot; + proc.delta + Environment.NewLine; &#125; //построить расписание void schedule() &#123; inf = string.Empty; int k = 0; for (int i = 0; i &lt; proc.CountProc; i++) proc[i].Clear(); for (int i = 0; i &lt; NumberOfJobs; i++) &#123; k = Range.rangeToIndexProc(arrayRandom[i], proc.CountProc, randLimit); proc[k].Add(arrayTasks[i]); &#125; addInf(); &#125; public string getRandomInString() &#123; string result = string.Empty; foreach (var iter in arrayRandom) result += iter.ToString() + &apos; &apos;; return result; &#125; public string print() &#123; addInf(); return inf; &#125; private int getIndexMin(List&lt;int&gt; list) &#123; int result = 0; for (int i = 0; i &lt; list.Count; i++) if (list[i] &lt; list[result]) result = i; return result; &#125; public delegate bool sort(int x, int y); private void sortProc() &#123; arrayProc.Sort((a, b) =&gt; &#123; return a - b; &#125;); &#125; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWPFNavigationService在第一次导航或第二页访问后返回Null堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWPFNavigationService在第一次导航或第二页访问后返回Null堆栈内存溢出.html" itemprop="url">cWPFNavigationService在第一次导航或第二页访问后返回Null堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
WPF NavigationService Returns Null after First Navigate or 2nd Page Visit



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
设计一个简单的WPF应用程序，该应用程序具有一个主页和其他几个页面。


单击按钮后，如果从我的主页进行导航，则：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void Button_Click(object sender, RoutedEventArgs e) &#123; this.NavigationService.Navigate(new Page1()) &#125;</span><br></pre></td></tr></table></figure>


我们导航到Page1就好了。 我在Page1上没有按钮，只希望它运行一个方法，然后转到Page2，如下所示：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Page1() &#123; InitializeComponent() ///go do some work BusyWorkMethod() &#125; public void BusyWorkMethod() &#123; *does some work, then finishes* this.NavigationService.Navigate(new Page2()) &#125;</span><br></pre></td></tr></table></figure>


问题是，在第二个Navigate上，想要转到Page2的那一个，NavigationService为null。


但是，如果我在Page1上添加了一个类似于HomePage的按钮，则可以这样做：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Page1() &#123; InitializeComponent() ///go do some work BusyWorkMethod() &#125; public void BusyWorkMethod() &#123; *does some work, then finishes* &#125; private void Test_Click(object sender, RoutedEventArgs e) &#123; //go to validating page this.NavigationService.Navigate(new Page2()); &#125;</span><br></pre></td></tr></table></figure>


这样可行。 我不确定那里发生了什么。


编辑：添加XAML。 这是MainWindow


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;NavigationWindow x:Class=&quot;DataGenerationApplication.MainWindow&quot; xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot; xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot; xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot; xmlns:local=&quot;clr-namespace:DataGenerationApplication&quot; mc:Ignorable=&quot;d&quot; Title=&quot;MainWindow&quot; Height=&quot;400&quot; Width=&quot;500&quot; Source=&quot;HomePage.xaml&quot; ShowsNavigationUI=&quot;False&quot;&gt; &lt;/NavigationWindow&gt;</span><br></pre></td></tr></table></figure>


在我的示例中，这是“ Page1”，在此处名为HomePage


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Page x:Class=&quot;DataGenerationApplication.HomePage&quot; xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot; xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot; xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot; xmlns:local=&quot;clr-namespace:DataGenerationApplication&quot; mc:Ignorable=&quot;d&quot; d:DesignHeight=&quot;400&quot; d:DesignWidth=&quot;500&quot; Title=&quot;HomePage&quot; KeepAlive=&quot;True&quot;&gt; &lt;Grid Margin=&quot;10,0,10,10&quot;&gt; &lt;Grid.ColumnDefinitions&gt; &lt;ColumnDefinition Width=&quot;*&quot;/&gt; &lt;ColumnDefinition Width=&quot;1.5*&quot;/&gt; &lt;/Grid.ColumnDefinitions&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;RowDefinition Height=&quot;auto&quot;/&gt; &lt;/Grid.RowDefinitions&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;ConnectionString&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;0&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Movie Database Name&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;1&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Movie Collection Name&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;2&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Amount of Movies&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;3&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Users Database Name&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;4&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Users Collection Name&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;5&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Amount of Users&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;6&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Reviews Database Name&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;7&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Reviews Collection Name&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;8&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Amount of Reviews&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;9&quot;/&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,40,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Clear Previous Data?&quot; VerticalAlignment=&quot;Top&quot; Grid.Column=&quot;0&quot; Grid.Row=&quot;10&quot;/&gt; &lt;CheckBox Content=&quot;&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;133,41,0,0&quot; Grid.Row=&quot;10&quot; VerticalAlignment=&quot;Top&quot; Name=&quot;ClearDB&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;0&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;mongodb://localhost:27017&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;ConnectionString&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;1&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Movies&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;MovieDb&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;2&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;MovieDocs&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;MovieCollection&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;3&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;1000&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;MovieAmount&quot; PreviewTextInput=&quot;NumberValidationTextBox&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;4&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Users&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;UserDb&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;5&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;UserDocs&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;UserCollection&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;6&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;100&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;UserAmount&quot; PreviewTextInput=&quot;NumberValidationTextBox&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;7&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,20,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;Reviews&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;ReviewDb&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;8&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;ReviewDocs&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;ReviewCollection&quot;/&gt; &lt;TextBox Grid.Column=&quot;1&quot; Grid.Row=&quot;9&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;20,5,0,0&quot; TextWrapping=&quot;NoWrap&quot; Text=&quot;300&quot; VerticalAlignment=&quot;Top&quot; Background=&quot;LightGray&quot; Width=&quot;200&quot; Name=&quot;ReviewAmount&quot; PreviewTextInput=&quot;NumberValidationTextBox&quot;/&gt; &lt;Button Content=&quot;Generate Data&quot; Grid.Column=&quot;1&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;120,38,0,0&quot; Grid.Row=&quot;10&quot; VerticalAlignment=&quot;Top&quot; Width=&quot;100&quot; Background=&quot;LightGreen&quot; Click=&quot;Button_Click&quot;/&gt; &lt;/Grid&gt; &lt;/Page&gt;</span><br></pre></td></tr></table></figure>


和我的名为“ GeneratingPage”的“ Page2”


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Page x:Class=&quot;DataGenerationApplication.GeneratingPage&quot; xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot; xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot; xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot; xmlns:local=&quot;clr-namespace:DataGenerationApplication&quot; mc:Ignorable=&quot;d&quot; d:DesignHeight=&quot;400&quot; d:DesignWidth=&quot;500&quot; Title=&quot;GeneratingPage&quot; KeepAlive=&quot;True&quot;&gt; &lt;Grid&gt; &lt;TextBlock HorizontalAlignment=&quot;Left&quot; Margin=&quot;25,0,0,0&quot; Text=&quot;Generating...&quot; FontSize=&quot;80&quot; TextWrapping=&quot;Wrap&quot; VerticalAlignment=&quot;Center&quot; Height=&quot;122&quot; Width=&quot;497&quot;/&gt; &lt;Button Content=&quot;TestButton&quot; HorizontalAlignment=&quot;Left&quot; Margin=&quot;205,295,0,0&quot; VerticalAlignment=&quot;Top&quot; Width=&quot;75&quot; Click=&quot;Test_Click&quot;/&gt; &lt;/Grid&gt; &lt;/Page&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../24/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../24/">24</a><span class="page-number current">25</span><a class="page-number" href="../26/">26</a><span class="space">&hellip;</span><a class="page-number" href="../173/">173</a><a class="extend next" rel="next" href="../26/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="http://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">1724</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
