<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客">
<meta property="og:url" content="https://luna.newban.cn/page/161/index.html">
<meta property="og:site_name" content="开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://luna.newban.cn/page/161/">





  <title>开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者的博客 – 全栈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="http://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在找到的文本中添加堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在找到的文本中添加堆栈内存溢出.html" itemprop="url">android在找到的文本中添加堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Add \ in text where ' is found


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在制作应用程序，需要将帖子详细信息保存在SQLite中，并且该帖子会接收用户输入，例如用户文本。

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E/AndroidRuntime: FATAL EXCEPTION: main Process: pet.adoption.world.solutions, PID: 1500 android.database.sqlite.SQLiteException: near &quot;s&quot;: syntax error (Sqlite code 1): , while compiling: INSERT INTO Trading_info_post(NAME , PHONE , EMAIL , TITLE , PUBLISH_DATE,DESCRIPTION , TO_LOCATION , MODE_OF_TRAVEL , AVAILABILITY , DATE_OF_TRAVELING , PLANNED_TIME_COMING_AT_LOCATION , MAP , FROM_LOCATION , PASSING ) VALUES (&apos;19.12.2019 22:00&apos;,&apos;01.01.2020 15:00&apos;,&apos;AD&apos;,&apos;HR,DE&apos;,&apos;ME&apos;,&apos;Adoption is a process whereby a person assumes the parenting of another, usually a child, from that person&apos;s biological or legal parent or parents. Legal adoptions permanently transfers all rights and responsibilities, along with filiation, from the biological parent or parents. /n In many jurisdictions the adopted person&apos;s full original birth certificate is cancelled and replaced with a fabricated post-adoption birth certificate which states that the child was born to the adoptive parents. This deception, when carried out, may continue with the adopted person for life and can be the cause for many well documented traumas experienced by the adopted person, including loss of identity, family history, culture, biological family (including not only biological parents but also siblings and extended family), family medical history and records, and increased risk of suicide, homelessness, incarceration, PTSD, depression, and anxiety. /n Unlike guardianship or other systems designed for the care of the young, adoption is intended to effect a permanent change in status and as such requires societal recognition, either through legal or religious sanction. Historically, some societies have enacted specific laws governing adoption; where others have tried to achieve adoption through less formal means, notably via contracts that specified inheritance rights and parental responsibilities without an accompanying transfer of filiation. Modern systems of adoption, arising in the 20th century, tend to be governed by comprehensive statutes and regulations.&apos;,&apos;master.dev.man@gmail.com&apos;,&apos;available&apos;,&apos;MNE - USA&apos;,&apos;11.11.2019&apos;,&apos;https://drive.google.com/open?id=1Tbutp40nzFMZE12Nzhqm1VMrceM13cBj&amp;usp=sharing&apos;,&apos;with car&apos;,&apos;Igor Lerinc&apos;,&apos;+38267395564&apos;);, (OS error - 2:No such file or directory) at android.database.sqlite.SQLiteConnection.nativePrepareStatement(Native Method) at android.database.sqlite.SQLiteConnection.acquirePreparedStatement(SQLiteConnection.java:906) at android.database.sqlite.SQLiteConnection.prepare(SQLiteConnection.java:517) at android.database.sqlite.SQLiteSession.prepare(SQLiteSession.java:588) at android.database.sqlite.SQLiteProgram.&lt;init&gt;(SQLiteProgram.java:63) at android.database.sqlite.SQLiteStatement.&lt;init&gt;(SQLiteStatement.java:31) at android.database.sqlite.SQLiteDatabase.executeSql(SQLiteDatabase.java:1763) at android.database.sqlite.SQLiteDatabase.execSQL(SQLiteDatabase.java:1689) at pet.adoption.world.solutions.Database.Database.savePost_trading_info(Database.java:101) at pet.adoption.world.solutions.Trading_info_posts_details$1$4.onClick(Trading_info_posts_details.java:207) at android.view.View.performClick(View.java:5338) at android.view.View$PerformClick.run(View.java:21539) at android.os.Handler.handleCallback(Handler.java:819) at android.os.Handler.dispatchMessage(Handler.java:104) at android.os.Looper.loop(Looper.java:210) at android.app.ActivityThread.main(ActivityThread.java:5982) at java.lang.reflect.Method.invoke(Native Method) at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:852) at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:742)</span><br></pre></td></tr></table></figure>


使用SQLite时，我在查询尝试将文本放入数据库时 遇到异常，因为正如我在此答案中发现的那样，由于存在'，所以它抛出了异常，因此SQL认为它是语句的末尾，因此需要在\\前面添加\\ '符号以防止错误。

当代码检测到'符号时，如何在\\前面添加\\。

因此，当用户单击“提交”按钮以提交它的帖子时，它可以查找是否有“符号，以便放置\\”。 我也尝试了不带'的文本，并且SQL正常工作。

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

在输入查询之前，应该在代码中使用PreparedStatement清理输入类型，而不要使用纯字符串连接。 否则，您可以尝试URLEncoder.encode(data) 但是，单引号不是唯一的问题，因为用户可以添加类似'); DROP TABLE Trading_info_post; 并清除应用程序
**===============>>#2 票数：1 已采纳**

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yourString = yourString.replace(/\&apos;/g,&quot;&apos;&apos;&quot;)</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#3 票数：0</strong></p>

通过使用insert()解决了它。 感谢njzk2评论。

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c存储库模式EF核心更新方法堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c存储库模式EF核心更新方法堆栈内存溢出.html" itemprop="url">c存储库模式EF核心更新方法堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Repository Pattern EF Core Update method


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我有一个关于在带有Entity Framework Core的MVC Web应用程序中使用存储库模式和工作单元模式的问题。

我目前正在控制器中实现更新功能。 现在，我不知道最好的方法是更新实体。 我看了一些视频，他们说更新方法不应出现在这样的存储库中：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public T Update(T entity) &#123; DbSet.Attach(entity); var entry = Context.Entry(entity); entry.State = System.Data.EntityState.Modified; &#125;</span><br></pre></td></tr></table></figure>


因此，这意味着我将必须在控制器中这样做：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public IActionResult Edit(int id, [Bind(&quot;NeighbourhoodGroup,Neighbourhood,NeighbourhoodId&quot;)] Neighbourhoods neighbourhoods) &#123; var neighbourhoodsFound = unitOfWork.Neighbourhoods.Get(id); neighbourhoodsFound.Neighbourhood = neighbourhoods.Neighbourhood; neighbourhoodsFound.NeighbourhoodGroup = neighbourhoods.NeighbourhoodGroup; &#125;</span><br></pre></td></tr></table></figure>


但是，这意味着即使对象具有很多属性，我也必须在所有控制器中执行此操作？

我希望有人能给我一些关于最佳方法的建议。

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

在您的存储库中，您可以具有以下简单的更新功能： 在控制器中或您希望从任何地方进行更新时，最好通过id获得实体，修改要在实体上修改的所有属性，从存储库中调用Update方法，它将状态设置为修改并最终在EF上下文上调用Save或SaveAsync方法。 您的EF上下文应在UnitOfWork中公开。 有关更详细的说明，您可以查看这篇文章，这将非常有帮助。 EF储存库模式

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public void Update(T entity)</span><br><span class="line">   &#123;</span><br><span class="line">       DbSet.Attach(entity);</span><br><span class="line">       ApplicationContext.Entry(entity).State = EntityState.Modified;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：-1</strong></p>

阅读干净的架构也很有用。

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在具有Android10Q和targetSdkVersion29的ExoPlayer上播放歌曲的正确方法是什么堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在具有Android10Q和targetSdkVersion29的ExoPlayer上播放歌曲的正确方法是什么堆栈内存溢出.html" itemprop="url">android在具有Android10Q和targetSdkVersion29的ExoPlayer上播放歌曲的正确方法是什么堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
What is the correct way to play songs on ExoPlayer with Android 10 (Q) and targetSdkVersion = 29?


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
随着Android 10（Q）的最新更改，尝试使用ExoPlayer在用户的设备上播放歌曲（目标版本为sdk版本29 ，运行Android 10 ），并在控制台上打印以下日志，但失败（歌曲为未播放）：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E/libprocessgroup: Error encountered killing process cgroup uid 99420 pid 20294: Permission denied com.google.android.exoplayer2.upstream.FileDataSource$FileDataSourceException: java.io.FileNotFoundException: /storage/emulated/0/Music/Nirvana/[1989] - Bleach/01 - Blew.mp3: open failed: EACCES (Permission denied) at com.google.android.exoplayer2.upstream.FileDataSource.open(FileDataSource.java:73) at com.google.android.exoplayer2.upstream.DefaultDataSource.open(DefaultDataSource.java:257) at com.google.android.exoplayer2.upstream.StatsDataSource.open(StatsDataSource.java:83) at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$ExtractingLoadable.load(ProgressiveMediaPeriod.java:939) at com.google.android.exoplayer2.upstream.Loader$LoadTask.run(Loader.java:394) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641) at java.lang.Thread.run(Thread.java:919) Caused by: java.io.FileNotFoundException: /storage/emulated/0/Music/Nirvana/[1989] - Bleach/01 - Blew.mp3: open failed: EACCES (Permission denied) at libcore.io.IoBridge.open(IoBridge.java:496) at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.java:289) at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.java:152) at com.google.android.exoplayer2.upstream.FileDataSource.open(FileDataSource.java:65) at com.google.android.exoplayer2.upstream.DefaultDataSource.open(DefaultDataSource.java:257)  at com.google.android.exoplayer2.upstream.StatsDataSource.open(StatsDataSource.java:83)  at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$ExtractingLoadable.load(ProgressiveMediaPeriod.java:939)  at com.google.android.exoplayer2.upstream.Loader$LoadTask.run(Loader.java:394)  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)  at java.lang.Thread.run(Thread.java:919)  Caused by: android.system.ErrnoException: open failed: EACCES (Permission denied) at libcore.io.Linux.open(Native Method) at libcore.io.ForwardingOs.open(ForwardingOs.java:167) at libcore.io.BlockGuardOs.open(BlockGuardOs.java:252) at libcore.io.ForwardingOs.open(ForwardingOs.java:167) at android.app.ActivityThread$AndroidOs.open(ActivityThread.java:7255) at libcore.io.IoBridge.open(IoBridge.java:482) at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.java:289)  at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.java:152)  at com.google.android.exoplayer2.upstream.FileDataSource.open(FileDataSource.java:65)  at com.google.android.exoplayer2.upstream.DefaultDataSource.open(DefaultDataSource.java:257)  at com.google.android.exoplayer2.upstream.StatsDataSource.open(StatsDataSource.java:83)  at com.google.android.exoplayer2.source.ProgressiveMediaPeriod$ExtractingLoadable.load(ProgressiveMediaPeriod.java:939)  at com.google.android.exoplayer2.upstream.Loader$LoadTask.run(Loader.java:394)  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1167)  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:641)  at java.lang.Thread.run(Thread.java:919)</span><br></pre></td></tr></table></figure>


我在Internet上找到的解决该问题的方法之一是在清单的<application>标记上添加以下属性：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:requestLegacyExternalStorage=&quot;true&quot;</span><br></pre></td></tr></table></figure>


该解决方案的问题在于它似乎是临时的，可能很快就会弃用。

在这些规范下应对这些更改的正确方法是什么？

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

参见https://stackoverflow.com/a/59037794/2373819 但是看一下Exoplayer源代码。 https://github.com/google/ExoPlayer/blob/release-v2/library/core/src/main/java/com/google/android/exoplayer2/upstream/FileDataSource.java 说 在API 29及更高版本中，公共文件中不能访问文件路径。 您应该在ExoPlayer中引发一个错误，以使用Java从contentresolver使用fileDescriptor
**===============>>#2 票数：0**

经过进一步的试验，我能够使用Media的Uri使用ExoPlayer播放歌曲。 ... 它成功播放了这首歌，没有任何异常。

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> // id col = `MediaStore.Audio.Media._ID`</span><br><span class="line">val id = cursor.getLong(idColIndex)</span><br><span class="line">val uri = ContentUris.withAppendedId(</span><br><span class="line">    MediaStore.Audio.Media.EXTERNAL_CONTENT_URI,</span><br><span class="line">    id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

</application>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在不可见的行中未选中列表视图复选框堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在不可见的行中未选中列表视图复选框堆栈内存溢出.html" itemprop="url">android在不可见的行中未选中列表视图复选框堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
List View check box not checked in non visible rows


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在创建一个列表视图，每一行都有自定义布局。 每个自定义布局都有一个复选框。 我有一个复选框，单击时必须单击列表视图中的所有复选框。 我能够单击可见行中的复选框，但是我面临着不可见行的问题。 我尝试检查所有列表适配器，但无法正常工作。

MainActivity.java

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends Activity implements OnItemClickListener&#123; ListView listView; ArrayAdapter&lt;Model&gt; adapter; static List&lt;Model&gt; list = new ArrayList&lt;Model&gt;(); public static int count = 0; public void onCreate(Bundle icicle) &#123; super.onCreate(icicle); setContentView(R.layout.main); listView = (ListView) findViewById(R.id.my_list); adapter = new MyAdapter(this,getModel()); listView.setAdapter(adapter); listView.setOnItemClickListener(this); count = listView.getCount(); &#125; @Override public void onItemClick(AdapterView&lt;?&gt; arg0, View v, int position, long arg3) &#123; TextView label = (TextView) v.getTag(R.id.label); CheckBox checkbox = (CheckBox) v.getTag(R.id.check); Toast.makeText(v.getContext(), label.getText().toString()+&quot; &quot;+isCheckedOrNot(checkbox), Toast.LENGTH_LONG).show(); &#125; private String isCheckedOrNot(CheckBox checkbox) &#123; if(checkbox.isChecked()) return &quot;is checked&quot;; else return &quot;is not checked&quot;; &#125; private List&lt;Model&gt; getModel() &#123; list.add(new Model(&quot;Linux&quot;)); list.add(new Model(&quot;Windows7&quot;)); list.add(new Model(&quot;Suse&quot;)); list.add(new Model(&quot;Eclipse&quot;)); list.add(new Model(&quot;Ubuntu&quot;)); list.add(new Model(&quot;Solaris&quot;)); list.add(new Model(&quot;Android&quot;)); list.add(new Model(&quot;iPhone&quot;)); list.add(new Model(&quot;Java&quot;)); list.add(new Model(&quot;.Net&quot;)); list.add(new Model(&quot;PHP&quot;)); list.add(new Model(&quot;U1&quot;)); list.add(new Model(&quot;S1&quot;)); list.add(new Model(&quot;A1&quot;)); list.add(new Model(&quot;i1&quot;)); list.add(new Model(&quot;J1&quot;)); list.add(new Model(&quot;.N1&quot;)); list.add(new Model(&quot;PP1&quot;)); return list; &#125; &#125;</span><br></pre></td></tr></table></figure>


MyAdapter .java

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class MyAdapter extends ArrayAdapter&lt;Model&gt; &#123; private final List&lt;Model&gt; list; private final Activity context; TextView text; CheckBox checkbox; boolean flag; public MyAdapter(Activity context, List&lt;Model&gt; list) &#123; super(context, R.layout.row, list); this.context = context; this.list = list; &#125; static class ViewHolder &#123; protected TextView text; protected CheckBox checkbox; &#125; @Override public View getView(final int position, View convertView, final ViewGroup parent) &#123; final CheckBox c = (CheckBox) ((ViewGroup) parent.getParent()).getChildAt(0); if (convertView == null) &#123; LayoutInflater inflator = context.getLayoutInflater(); convertView = inflator.inflate(R.layout.row, null); &#125; text = (TextView) convertView.findViewById(R.id.label); checkbox = (CheckBox) convertView.findViewById(R.id.check); checkbox.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() &#123; @Override public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) &#123; int getPosition = (Integer) buttonView.getTag(); list.get(getPosition).setSelected(buttonView.isChecked()); &#125; &#125;); checkbox.setTag(position); text.setText(list.get(position).getName()); c.setOnCheckedChangeListener(new OnCheckedChangeListener() &#123; @Override public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) &#123; for (int i = 0; i &lt; parent.getChildCount(); i++) &#123; RelativeLayout r = (RelativeLayout) parent.getChildAt(i); CheckBox check1 = (CheckBox) r.getChildAt(1); if(check1 instanceof CheckBox)&#123; check1.setChecked(true); &#125; &#125; &#125; &#125;); if(flag)&#123; list.get(position).setSelected(flag); &#125; checkbox.setChecked(list.get(position).isSelected()); return convertView; &#125; &#125;</span><br></pre></td></tr></table></figure>


main.xml

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:layout_width=&quot;fill_parent&quot; android:layout_height=&quot;fill_parent&quot; android:orientation=&quot;vertical&quot; &gt; &lt;CheckBox android:id=&quot;@+id/check&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_alignParentRight=&quot;true&quot; android:layout_marginLeft=&quot;4dip&quot; android:layout_marginRight=&quot;10dip&quot; android:focusable=&quot;false&quot; android:focusableInTouchMode=&quot;false&quot; &gt; &lt;/CheckBox&gt; &lt;ListView android:id=&quot;@+id/my_list&quot; android:layout_width=&quot;fill_parent&quot; android:layout_height=&quot;fill_parent&quot; /&gt; &lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>


row.xml

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; &gt; &lt;TextView android:id=&quot;@+id/label&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;@+id/label&quot; android:textSize=&quot;30sp&quot; &gt; &lt;/TextView&gt; &lt;CheckBox android:id=&quot;@+id/check&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_alignParentRight=&quot;true&quot; android:layout_marginLeft=&quot;4dip&quot; android:layout_marginRight=&quot;10dip&quot; android:focusable=&quot;false&quot; android:focusableInTouchMode=&quot;false&quot; &gt; &lt;/CheckBox&gt; &lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1 已采纳</strong></p>

列表视图仅具有尽可能多的子视图，因此getChildCount()将仅返回可见的视图。 您将需要在Model类中有一个字段来存储其checked状态。 因此，在适配器的getView方法中，您将执行以下操作 Select all将遍历列表，并将所有Model对象标记为已选中，并更新列表视图中的可见视图。 下次滚动该复选框时，将从getView()内部的相关模型对象读取其选中状态

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Model myModel = getItem(position);</span><br><span class="line">checkBox.setChecked(myModel.isChecked());</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在SD卡上安装自签名APK时出现未安装应用程序堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在SD卡上安装自签名APK时出现未安装应用程序堆栈内存溢出.html" itemprop="url">android在SD卡上安装自签名APK时出现未安装应用程序堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
“Application not installed” when installing an self-signed apk on SD-card


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
*编辑1 *当然，刚发布后，我尝试卸载该应用程序，然后从APK重新安装它。 然后它起作用了。 也许这是我通常从Eclipse安装它的事实，这很不好？ 测试中

/编辑

因此，我的问题是我的精美APK文件无法在我的设备上安装。

我发现另一个遇到相同问题的人，并通过自签名解决了该问题： 无法安装未签名的APK

但是，我总是尝试使用签名的APK。 在Eclipse中，我选择“导出”，然后必须首先选择并“登录”我的密钥库，然后选择一个密钥并再次提供我的密码，然后选择文件的位置，然后按“完成”。

这是向导中的最后一个“页面”：

将那个APK文件复制到我的设备上，然后从文件资源管理器中“运行它”之后，“安装”屏幕显示upp并看上去确定。 首先，我看到“替换应用程序”屏幕，询问我是否要替换现有版本。 我按“确定”。 然后它问我是否要允许该应用程序... yada yada。 我按“安装”。 在显示“正在安装”的简短消息后，我收到消息：

应用未安装

并在其左侧带有绿色的“对勾”。

没有其他错误消息。

我已选中“未知来源”框。 我可能会补充说，当我从Eclipse启动同一应用程序时没有任何问题！

任何提示和想法将不胜感激。

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：7 已采纳</strong></p>

如果两个.apk具有不同的签名（Eclipse使用调试证书），则在不删除前一个.apk的情况下将无法使用新的.apk进行安装/更新。 您可以在此处找到有关此信息的更多信息。
**===============>>#2 票数：3**

问题似乎是我首先通过Eclipse安装了该应用程序（从Eclipse启动/调试）。 以这种方式安装应用程序后，我尝试从APK重新安装，但没有成功。 但是，如果我先完全卸载了该应用程序，然后从APK文件重新安装，则安装成功。 之后，也可以重新安装（带有更新的APK）！
**===============>>#3 票数：1**

我也遇到了这个问题。 请尝试此解决方案。 确保您的项目的程序包名称与您的手机中已安装的先前项目不同。 我认为他们的名字有冲突。 它解决了我的问题。
**===============>>#4 票数：0**

尝试不通过Eclipse安装应用程序。 如果要避免在更新后出现这种情况，则会显示消息“未安装应用程序”。 安装应用程序。 仅使用export as apk选项安装。
**===============>>#5 票数：0**

通过命令行创建密钥库文件 keytool -genkey -alias key_file_name.keystore -keyalg RSA -validity 1000000000000000 -keystore key_file_name.keystore 通过Eclipse导出apk，右键单击Android项目Android工具>导出签名的应用程序包 ，然后提供密钥库位置和密码。 这将创建带签名的apk，同时将apk对齐。 并可以安装。 如果您全部通过命令行，有时您可能会遇到“未安装应用程序”错误。 （应用程序未安装错误不仅会在使用命令行时发生。也可能是其他一些原因）
**===============>>#6 票数：0**

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在Release版本中清空json数据使用proguard堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在Release版本中清空json数据使用proguard堆栈内存溢出.html" itemprop="url">android在Release版本中清空json数据使用proguard堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Empty json data in Release build (using proguard)


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
运行发行版（已签名，Proguard已打包）时，我的应用程序不会将数据发布到服务器。 但是，如果我直接从ADT运行它，则会在服务器上看到数据。

这很奇怪，因为它只是相同的代码，一个是签名的，另一个是直接执行的。 这是代码（使用org.springframework.web.client.RestTemplate ）：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static String URL = &quot;https://myappserver.com/abcservice/&quot;; public ResponseEntity&lt;String&gt; sendMessage(UserMessage us) &#123; private RestTemplate template = getTemplate(); HttpEntity&lt;UserMessage&gt; reqEntity = new HttpEntity&lt;UserMessage&gt;(us, headers); ResponseEntity&lt;String&gt; result = template.postForEntity(URL, reqEntity, String.class); return result; &#125;</span><br></pre></td></tr></table></figure>


以下是两种情况：

情况1：效果很好

情况2：问题

我已尝试同时在我的设备和Web服务器上登录，我可以确认是否收到案例2的空数据，而且我无法弄清楚为什么打包时它不发送数据？

与调试打包相比，打包/发布（Signed + Proguard）应用程序的行为是否有所不同？

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：3 已采纳</strong></p>

我猜这是由proguard引起的。 Proguard可能会混淆代码的某些部分，但是Spring会动态调用此代码（还有jackson吗？您没有提到它）。 （因此一旦混淆：动态调用失败） 因此，尝试： 如果已确认：请尝试对其进行配置，以免混淆在json中序列化的类（即UserMessage）： -保留类com.company.UserMessage ** {*; }
**===============>>#2 票数：0**

上面的答案对我没有用，可能是在2014年是正确的对于2019年，当我降级gradle版本时它有效

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">      classpath &apos;com.android.tools.build:gradle:3.4.2&apos;</span><br><span class="line"></span><br><span class="line">      // NOTE: Do not place your application dependencies here; they belong</span><br><span class="line">      // in the individual module build.gradle files</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在RecyclerView外部单击以在RecyclerView行中隐藏ChildView堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在RecyclerView外部单击以在RecyclerView行中隐藏ChildView堆栈内存溢出.html" itemprop="url">android在RecyclerView外部单击以在RecyclerView行中隐藏ChildView堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Click Outside the RecyclerView to Hide ChildView in RecyclerView Row


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我有一个简单RecyclerView ，当你LongClick在连续RecyclerView我做一个隐藏LinearLayout可见该行。 这样做在我的public override RecyclerView.ViewHolder OnCreateViewHolder(ViewGroup parent, int viewType)我正在使用以下内容

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LinearLayout REACTION_LAYOUT = RecyclerItem.FindViewById&lt;LinearLayout&gt;(Resource.Id.reaction_layout); RecyclerItem.LongClick += (sender, e) =&gt; &#123; OnLongClick(REACTION_LAYOUT); &#125;;</span><br></pre></td></tr></table></figure>


REACTION_LAYOUT是我使用以下内容显示的布局

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void OnLongClick(LinearLayout _ReactionLayout) &#123; try &#123; _ReactionLayout.Visibility = ViewStates.Visible; &#125; catch (Exception X) &#123; Log.Info(&quot;1022585&quot;, &quot;CLICK (ERROR) : &quot; + X.Message); &#125; &#125;</span><br></pre></td></tr></table></figure>


这按预期工作，现在我想要的是当用户触摸行外的任何地方时都隐藏REACTION_LAYOUT ，这意味着RecyclerView中的其他行或其他任何地方

我怎么做？

我尝试使用的方法是在适配器的OnCreateViewHolder检测对parent的触摸，如下所示

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parent.Click += (sender, e) =&gt; &#123; OnParentClick(REACTION_LAYOUT); &#125;;</span><br></pre></td></tr></table></figure>


这可以工作，但是会禁用“回收者”视图上的滚动。

实现此目标的最佳方法是什么？

编辑 ：活动RecyclerView是以下

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;LinearLayout android:id=&quot;@+id/main_message_layout&quot; xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; xmlns:tools=&quot;http://schemas.android.com/tools&quot; xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:background=&quot;?attr/colorPrimary&quot; app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot; android:orientation=&quot;vertical&quot;&gt; &lt;include layout=&quot;@layout/toolbar_messages&quot;/&gt; &lt;LinearLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;4.5dp&quot; android:layout_marginTop=&quot;3dp&quot; android:background=&quot;@drawable/shadow&quot;/&gt; &lt;RelativeLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;fill_parent&quot;&gt; &lt;androidx.recyclerview.widget.RecyclerView android:id=&quot;@+id/rvMessages&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; android:background=&quot;?attr/colorPrimary&quot; android:layout_alignParentTop=&quot;true&quot; android:paddingBottom=&quot;70dp&quot;/&gt; .......</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

当您单击recylerview项时，将调用此方法

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">itemView.setOnClickListener(v -&gt; &#123;</span><br><span class="line">              // Add your functionalities here</span><br><span class="line"></span><br><span class="line">           &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recyclerView.setNestedScrollingEnabled(false);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../android在ConstraintLayout中将单选按钮向左对齐堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../android在ConstraintLayout中将单选按钮向左对齐堆栈内存溢出.html" itemprop="url">android在ConstraintLayout中将单选按钮向左对齐堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Aligning Radio Buttons to left in ConstraintLayout?


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我可以使用layout_constraintStart_toStartOf和layout_constraintEnd_toStartOf从左到左对齐Button元素。 但是我无法对单选按钮执行此操作 。

如何将单选按钮向左对齐以实现以下效果：

这是布局：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;RadioGroup android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; app:layout_constraintTop_toTopOf=&quot;parent&quot; &gt; &lt;RadioButton android:id=&quot;@+id/btn1&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Button 1&quot; /&gt; &lt;RadioButton android:id=&quot;@+id/btn2&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Button 2&quot; /&gt; &lt;/RadioGroup&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1 已采纳</strong></p>

尝试在RadioGroup使用horizontal方向，如下所示： 输出：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> &lt;RadioGroup</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:orientation=&quot;horizontal&quot;</span><br><span class="line">    android:background=&quot;#C8E585&quot;</span><br><span class="line">    app:layout_constraintTop_toTopOf=&quot;parent&quot; &gt;</span><br><span class="line"></span><br><span class="line">    &lt;RadioButton</span><br><span class="line">        android:id=&quot;@+id/btn1&quot;</span><br><span class="line">        android:textSize=&quot;18sp&quot;</span><br><span class="line">        android:layout_margin=&quot;10dp&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;ColdFusion&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RadioButton</span><br><span class="line">        android:id=&quot;@+id/btn2&quot;</span><br><span class="line">        android:textSize=&quot;18sp&quot;</span><br><span class="line">        android:layout_margin=&quot;10dp&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Flex&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;RadioButton</span><br><span class="line">        android:id=&quot;@+id/btn3&quot;</span><br><span class="line">        android:textSize=&quot;18sp&quot;</span><br><span class="line">        android:layout_margin=&quot;10dp&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:text=&quot;Flash&quot; /&gt;</span><br><span class="line">&lt;/RadioGroup&gt;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c对原子变量的非原子操作堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c对原子变量的非原子操作堆栈内存溢出.html" itemprop="url">c对原子变量的非原子操作堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Non atomic operation on atomic variables


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
假设我有以下代码：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::atomic&lt;int&gt; a1; std::atomic&lt;int&gt; a2; std::atomic&lt;int&gt; a3; std::atomic_store(&amp;a1, 1); std::atomic_store(&amp;a2, 1); std::atomic_store(&amp;a3, 2); int a2Value = std::atomic_load_explicit(&amp;a2, std::memory_order_relaxed); int a3Value = std::atomic_load_explicit(&amp;a3, std::memory_order_relaxed); std::atomic_compare_exchange_strong_explicit( &amp;a1, &amp;a2Value, a3Value, std::memory_order_relaxed, std::memory_order_relaxed);</span><br></pre></td></tr></table></figure>


我可以用以下内容替换它，以避免两次原子读取（安全吗？）：

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a2Value = static_cast&lt;int&gt;(a2); a3Value = static_cast&lt;int&gt;(a3); std::atomic_compare_exchange_strong_explicit( &amp;a1, &amp;a2Value, a3Value, std::memory_order_relaxed, std::memory_order_relaxed);</span><br></pre></td></tr></table></figure>


我还可以使用像这样的代码来编写原子变量而不将其作为原子写入吗？

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*reinterpret_cast&lt;int*&gt;(&amp;a2) = 5;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

不，你不能。 如果您有一个平台，其中对齐的整数读取始终是原子的，那么您就不会避免任何原子操作。 如果您有一个平台，在该平台上读取对齐的整数并不总是原子的，那么该代码显然是不安全的。
**===============>>#2 票数：0**

当需要或不需要原子性时，能够互换使用原子类型和非原子类型将是很棒的。 但是，C ++模型中没有任何东西允许这样做，并且有很多事情与之相反。 但是内存模型首先是不完善的（例如：它没有定义任何行为，这是毫无意义的），因此应该从头开始重建它，然后考虑您提出的建议。

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c对在PowerShell中添加程序集以使用NET类感到困惑堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c对在PowerShell中添加程序集以使用NET类感到困惑堆栈内存溢出.html" itemprop="url">c对在PowerShell中添加程序集以使用NET类感到困惑堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-28T00:00:00+00:00">
                2020-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Confused about adding assemblies in PowerShell for using .NET Classes


<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我希望澄清一下。 在PowerShell中使用.NET Framework类时，有时必须将程序集加载到内存中，而在PowerShell中则必须使用Add-Type Cmdlet。 因此，例如，如果我想使用System.ServiceProccess.ServiceController类，我会做类似的事情

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-Type -AssemblyName System.ServiceProcess</span><br></pre></td></tr></table></figure>


但是，这是我感到困惑的地方。 该文档说System.ServiceProcess.ServiceController类有2个程序集

https://docs.microsoft.com/zh-cn/dotnet/api/system.serviceprocess.servicecontroller?view=netframework-4.8即： System.ServiceProcess.ServiceController.dll和System.ServiceProcess.dll

无论我添加哪一个，它似乎都可以工作，但是我想知道在引擎盖下发生了什么。

Process类更加令人困惑： https : //docs.microsoft.com/en-us/dotnet/api/system.diagnostics.process?view=netframework-4.8

这里我们有3个程序集： System.Diagnostics.Process.dll，System.dll和netstandard.dll

我只能加载System.Dll。 其他2只表示找不到该程序集。

所以问题是，如果我想使用.NET Framework类，我应该拥有所有组件，那么如何在PowerShell中将它们全部加载？

希望这很清楚，并感谢您的答复。

亲切的问候，

约翰

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

System.ServiceProcess.dll在GAC中，并且是.NET Framework的一部分。 System.ServiceProcess.ServiceController.dll是Core CLR的一部分。 但是请稍等-PowerShell基于.NET Framework CLR。 如果您根据正确的netstandard配置文件构建程序集，并且其依赖项是可解决的，则它应能够在.NET Framework上运行。 您可以看到System.ServiceProcess.dll引用kernel32 ，而System.ServiceProcess.ServiceController.dll引用api-ms-win-service-core 。 差不多 ，但是Core CLR版本的功能可能更少 。 至于其他的，大多数System名称空间都位于mscorlib和System.dll 。 近年来，人们一直在努力通过将部分核心库移出以进行带外交付来使其更精简 。 例如， System.Diagnostics.Process.dll现在作为nuget软件包提供 ，从而可以更快地向用户推出，而不是交付需要安装目标的主要.NET Framework更新。 如果您使用的是常规Powershell而不是Powershell Core ，则可以仅引用.NET Framework程序集，而不会混淆
**===============>>#2 票数：0**

MSDN无法正确指示.NET Framework，.NET Core或.NET Standard中哪种类型属于哪个程序集。 您可以改用.NET API目录 ：

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../160/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../160/">160</a><span class="page-number current">161</span><a class="page-number" href="../162/">162</a><span class="space">&hellip;</span><a class="page-number" href="../173/">173</a><a class="extend next" rel="next" href="../162/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="http://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">1724</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
