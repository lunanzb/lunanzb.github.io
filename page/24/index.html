<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客">
<meta property="og:url" content="https://luna.newban.cn/page/24/index.html">
<meta property="og:site_name" content="开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://luna.newban.cn/page/24/">





  <title>开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者的博客 – 全栈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="http://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../ajax部署的Laravel应用无法处理通过Ajax传递给控制器的变量堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../ajax部署的Laravel应用无法处理通过Ajax传递给控制器的变量堆栈内存溢出.html" itemprop="url">ajax部署的Laravel应用无法处理通过Ajax传递给控制器的变量堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Deployed Laravel app can't handle variables passed to controller via Ajax



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我在本地环境中创建了一个Laravel应用程序，并且运行良好。 当我出于某种原因将其部署到VPS服务器以进行在线访问时，我的AJAX停止工作 。 这是一个非常简单的AJAX函数的示例，该函数在本地可用，但在我的服务器中不起作用。


视图 ：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;title&gt;Ajax Example&lt;/title&gt; &lt;meta name=&quot;csrf-token&quot; content=&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;&gt; &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js&quot;&gt; &lt;/script&gt; &lt;script&gt; function getMessage() &#123; $.ajax(&#123; headers: &#123; &apos;X-CSRF-TOKEN&apos;: $(&apos;meta[name=&quot;csrf-token&quot;]&apos;).attr(&apos;content&apos;) &#125;, type: &apos;GET&apos;, url: &apos;/getmsg&apos;, data: &#123; greeting: &apos;Hello&apos; &#125;, success: function (data) &#123; $(&quot;#msg&quot;).html(data.msg); &#125; &#125;); &#125; &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=&apos;msg&apos;&gt;This message will be replaced using Ajax. Click the button to replace the message. &lt;/div&gt; &lt;?php echo Form::button(&apos;Replace Message&apos;, [&apos;onClick&apos; =&gt; &apos;getMessage()&apos;]); ?&gt; &lt;/body&gt; &lt;/html&gt;</span><br></pre></td></tr></table></figure>


控制器 ：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class TestAjaxController extends Controller &#123; public function index(Request $request) &#123; return response()-&gt;json(array(&apos;msg&apos;=&gt; $request-&gt;greeting), 200); &#125; &#125;</span><br></pre></td></tr></table></figure>


路线 ：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//Test routes Route::get(&apos;ajax-test&apos;,function() &#123; return view(&apos;ajax-test&apos;); &#125;); Route::get(&apos;/getmsg&apos;,&apos;TestAjaxController@index&apos;);</span><br></pre></td></tr></table></figure>


该功能的全部作用是，单击按钮将定义的变量发送到控制器，控制器将向该视图返回带有相同消息的响应，然后Jquery将文本更改为该消息。


问题是当按下按钮时，没有数据传递到控制器，因此控制器返回空数组 。


注意：我的本地环境使用Apache（XAMPP），但是我的VPS使用NGINX。 虽然我怀疑这是这里的问题。


我完全迷失了可能出错的地方。 也许我的VPS安装中缺少某些PHP模块或类似的模块？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

您实际上是在访问表单字段。 直接来自文档 您还可以使用Illuminate \\ Http \\ Request实例上的动态属性访问用户输入。 例如，如果您的应用程序表单之一包含一个名称字段，则可以按如下方式访问该字段的值： 使用动态属性时，Laravel将首先在请求有效负载中查找参数的值。 如果不存在，Laravel将在路径参数中搜索该字段。 因此，尝试使用$request->query('name')例如TestAjaxController应该是 我没有测试，但是应该可以。 希望这个能对您有所帮助 ：）


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$name = $request-&gt;name;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

因此出于某种原因，我只需要使用POST方法。 我不知道为什么一切都在GET本地工作，但是在生产服务器上我必须使用POST 。 这是工作代码：视图： 路线：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> &lt;script&gt;</span><br><span class="line">    function getMessage() &#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            headers: &#123;</span><br><span class="line">                &apos;X-CSRF-TOKEN&apos;: $(&apos;meta[name=&quot;csrf-token&quot;]&apos;).attr(&apos;content&apos;)</span><br><span class="line">            &#125;,</span><br><span class="line">            type: &apos;POST&apos;,</span><br><span class="line">            url: &apos;/getmsg&apos;,</span><br><span class="line">            data: &#123;</span><br><span class="line">                greeting: &apos;Hello&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            success: function (data) &#123;</span><br><span class="line">                $(&quot;#msg&quot;).html(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../ajax重新加载页面后Ajax查询无法正常工作堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../ajax重新加载页面后Ajax查询无法正常工作堆栈内存溢出.html" itemprop="url">ajax重新加载页面后Ajax查询无法正常工作堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Ajax query not working after page is reloaded



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我有2个Ajax查询，如下所示，并且两个ajax查询都在初始页面加载中工作，在使用第一个AJAX查询加载数据后，第二个ajax查询在页面内容加载后不起作用，因此请寻求关于home来解决此问题，以便每个页面加载后两个ajax查询都可以工作。


Ajax查询：1


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt; $(document).ready(function()&#123; $(&quot;input[type=&apos;radio&apos;]&quot;).on(&apos;click&apos;, function()&#123; var radioValue = $(&quot;input[name=&apos;Gender&apos;]:checked&quot;).val(); var surl = &apos;/fdata/&apos; + radioValue; var dsurl = encodeURI(surl, &quot;UTF-8&quot;); var hurl = &apos;/Summary&apos;; var dhurl = encodeURI(hurl, &quot;UTF-8&quot;); if (radioValue == &quot;Male&quot; ) &#123; $(&apos;#DGender&apos;).load(&apos;dsurl #DGender&apos;); &#125;; if (radioValue == &quot;Female&quot; ) &#123; $(&apos;#DGender&apos;).load(&apos;dsurl #DGender&apos;); &#125;; if (radioValue == &quot;Summary&quot; ) &#123; $(&apos;#DGender&apos;).load(&apos;dhurl #summary&apos;); &#125;; &#125;); &#125;); &lt;/script&gt;</span><br></pre></td></tr></table></figure>


Ajax查询：2


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot;&gt; $(document).ready(function() &#123; // Setup - add a text input to each footer cell $(&apos;input[type=search]&apos;).val(&apos;&apos;); $(&apos;#DGender thead tr&apos;).clone(true).appendTo( &apos;#DGender thead&apos; ); $(&apos;#DGender thead tr:eq(1) th&apos;).each( function (i) &#123; var title = $(this).text(); $(this).html( &apos;&lt;input type=&quot;text&quot; placeholder=&quot;&apos;+title+&apos;&quot; /&gt;&apos; ); $( &apos;input&apos;, this ).on( &apos;keyup change&apos;, function () &#123; if ( table.column(i).search() !== this.value ) &#123; table .column(i) .search( this.value ) .draw(); &#125; &#125; ); &#125; ); var table = $(&apos;#DGender&apos;).DataTable( &#123; ordering: false, orderCellsTop: true, fixedHeader: true, filter: false, searching: true, info: false, paging: false, scrollX: &quot;80vh&quot;, scrollCollapse: false &#125;); &#125; ); &lt;/script&gt;</span><br></pre></td></tr></table></figure>


来自，维诺


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../ajax需要从javascript调用perl脚本堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../ajax需要从javascript调用perl脚本堆栈内存溢出.html" itemprop="url">ajax需要从javascript调用perl脚本堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Need to call perl script from javascript



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我已经写了一个可以从URL访问的perl脚本： https：//hostname/myweb/myScript.pl？id = 1234＆stg = 13我使用URL得到了正确的结果


在javascript / jscript中，我尝试加载脚本（ $('#element').load() ）-在功能中尝试了完整的Ajax调用：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123; url: &apos;/myweb/myScript.pl&apos;, type: &apos;post&apos;, data: &#123; &apos;id&apos; : &apos;1234&apos;, &apos;stg&apos; : &apos;13&apos; &#125; &#125;);</span><br></pre></td></tr></table></figure>


我没有任何成功。 如果有人能指出我正确的方向，将不胜感激！


中号


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

看起来您的perl脚本期望get请求而不是post请求try： 如果您想使用数据，可以按照以下方式进行： 这也应该工作


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url: &apos;/myweb/myScript.pl?id=1234&amp;stg=13&apos;,</span><br><span class="line">  type: &apos;get&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../ajax验证失败应防止关闭模式对话框堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../ajax验证失败应防止关闭模式对话框堆栈内存溢出.html" itemprop="url">ajax验证失败应防止关闭模式对话框堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Failed validation should prevent closing of modal dialog



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在使用Bootsfaces显示模式对话框。 模态对话框中有一个字段（实际上是b:inputTextarea ）和一个使用Ajax提交数据的命令按钮。 我想确保用户在提交之前已经在文本字段中输入了一些内容。 如果该字段为空，则不应关闭模式并且不应进行提交；如果该字段为非空，则应关闭对话框，并且提交应采用Ajax样式。


由于Bootsfaces 1.4.2的问题 ，我无法使用b:command来执行Ajax部分。 我必须对h:commandButton和f:ajax使用标准方式。


我正在尝试解决这样的问题：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;b:form&gt; &lt;!-- section that gets updated by ajax-request --&gt; &lt;b:panel id=&quot;updateSection&quot;&gt; &lt;h:outputText value=&quot;#&#123;testBean.value1&#125;&quot; /&gt; &lt;b:button value=&quot;open dialog&quot; onclick=&quot;$(&apos;.pseudoClass&apos;).modal()&quot; /&gt; &lt;/b:panel&gt; &lt;!-- modal dialog --&gt; &lt;b:modal title=&quot;model&quot; styleClass=&quot;pseudoClass&quot; closable=&quot;false&quot; closeOnEscape=&quot;true&quot;&gt; &lt;b:panel id=&quot;modalOutput&quot;&gt;&lt;h:inputText value=&quot;#&#123;testBean.value1&#125;&quot; /&gt;&lt;/b:panel&gt; &lt;f:facet name=&quot;footer&quot;&gt; &lt;!-- cancel button --&gt; &lt;b:button largeScreen=&quot;half&quot; value=&quot;cancel&quot; dismiss=&quot;modal&quot; onclick=&quot;return false;&quot; /&gt; &lt;!-- submit button ajax-style --&gt; &lt;h:commandButton value=&quot;submit&quot; action=&quot;#&#123;testBean.save()&#125;&quot; onclick=&quot;validateModalDialog();&quot;&gt; &lt;f:ajax render=&quot;updateSection&quot; execute=&quot;@this modalOutput&quot; onevent=&quot;closeModalDialog&quot; /&gt; &lt;/h:commandButton&gt; &lt;!-- scripts to close &amp; validate modal dialog --&gt; &lt;h:outputScript&gt; function closeModalDialog(data) &#123; var status = data.status; if (status === &apos;complete&apos;) &#123; $(&apos;.pseudoClass&apos;).modal(&apos;hide&apos;); &#125; &#125; function validateModalDialog() &#123; alert(&apos;i get called before closing dialog&apos;); return false; &#125; &lt;/h:outputScript&gt; &lt;/f:facet&gt; &lt;/b:modal&gt; &lt;/b:form&gt;</span><br></pre></td></tr></table></figure>


脚本函数validateModalDialog在模式对话框关闭之前被调用，但是无论函数的返回值是（真还是假），对话框都将关闭。


我对JavaScript的了解非常有限。 这就是我选择使用JSF和Bootsfaces的原因之一。 但是我很确定有一种方法可以进行验证并防止对话框关闭。


使用标准组件h:commandButton和f:ajax时，我如何仿真Bootsfaces功能（模式对话框中文本字段的客户端验证）？


解：


为了实现客户端验证，与我的初始代码相比，需要进行以下操作以防止Ajax请求触发和模式对话框关闭以下更改：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h:commandButton value=&quot;submit&quot; action=&quot;#&#123;testBean.save()&#125;&quot; onclick=&quot;return validateModalDialog();&quot;&gt; &lt;f:ajax render=&quot;updateSection&quot; execute=&quot;@this modalOutput&quot; onevent=&quot;closeModalDialog&quot; /&gt; &lt;/h:commandButton&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0 已采纳</strong></p>

确实看起来像 不等于 为了仅通过h:commandButton通过javascript关闭模式对话框，如果表单没有验证错误，您必须： 这是为服务器端验证而更改的代码，仅当输入不为空时才关闭对话框（ required="true" ）。 请注意， testBean.save()也仅针对有效输入被调用。 一点示范： 如果要完全阻止无效表单上的Ajax表单提交并进行客户端验证，则必须根据以下内容修改onclick ： 与JS客户端验证结合使用时，不会触发JSF ajax请求 ： 当心客户端验证不会阻止用户通过例如使用其浏览器开发工具进行游戏来提交无效数据 。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> &lt;h:commandButton&gt;</span><br><span class="line">    &lt;f:ajax onevent=&quot;function(e)&#123;if(e.status == &apos;complete&apos;) doSomething();&#125;&quot;/&gt;</span><br><span class="line">&lt;/h:commandButton&gt;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c将XML序列化为C对象堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c将XML序列化为C对象堆栈内存溢出.html" itemprop="url">c将XML序列化为C对象堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Serialize xml to c# object



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我在尝试将XML序列化为C＃对象时遇到了一些问题。 我收到多个“ System.InvalidOperationException”。


错误：


InvalidOperationException：发生错误，反映了属性“ MPFAvailability”。 InvalidOperationException：发生错误，反映了类型'TalkTalkAPI.Models.AvailabilityDetails'。 InvalidOperationException：发生错误，反映了属性“ AvailabilityContent”。 InvalidOperationException：发生错误，反映了类型'TalkTalkAPI.Models.AvailabilityContent'。


我查看了内部异常，但没有更多详细信息。 我确信这与设置对象的方式有关。


XML：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;GetAvailabilityResult xmlns:i=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt; &lt;Status xmlns=&quot;http://schemas.datacontract.org/2004/07/InHouse.SharedLibraries.ServiceBase.BaseTypes&quot;&gt; &lt;Errors/&gt; &lt;HasErrors&gt;false&lt;/HasErrors&gt; &lt;/Status&gt; &lt;CSSDistrictCode&gt;LV&lt;/CSSDistrictCode&gt; &lt;GoldAddressKey&gt;A00009292705&lt;/GoldAddressKey&gt; &lt;MPFAvailability&gt; &lt;AvailabilityDetails i:type=&quot;MPFAvailabilityDetails&quot;&gt; &lt;Status xmlns=&quot;http://schemas.datacontract.org/2004/07/InHouse.SharedLibraries.ServiceBase.BaseTypes&quot;&gt; &lt;Errors/&gt; &lt;HasErrors&gt;false&lt;/HasErrors&gt; &lt;/Status&gt; &lt;AccessLineID&gt;PRH4144561P4&lt;/AccessLineID&gt; &lt;AccessLineStatus&gt;BTLive&lt;/AccessLineStatus&gt; &lt;AccessLineStatusVDSL&gt;Working&lt;/AccessLineStatusVDSL&gt; &lt;DPType&gt;External&lt;/DPType&gt; &lt;EstimatedSyncSpeed&gt; &lt;AnnexADownstream&gt;8818&lt;/AnnexADownstream&gt; &lt;AnnexAMaxRangeDownstream&gt;11055&lt;/AnnexAMaxRangeDownstream&gt; &lt;AnnexAMinRangeDownstream&gt;6464&lt;/AnnexAMinRangeDownstream&gt; &lt;AnnexMDownstream&gt;7318&lt;/AnnexMDownstream&gt; &lt;AnnexMMaxRangeDownstream&gt;14655&lt;/AnnexMMaxRangeDownstream&gt; &lt;AnnexMMaxRangeUpstream&gt;1015&lt;/AnnexMMaxRangeUpstream&gt; &lt;AnnexMMinRangeDownstream&gt;7945&lt;/AnnexMMinRangeDownstream&gt; &lt;AnnexMMinRangeUpstream&gt;876&lt;/AnnexMMinRangeUpstream&gt; &lt;AnnexMUpstream&gt;1500&lt;/AnnexMUpstream&gt; &lt;MinThresholdAnnexADownstream&gt;5129&lt;/MinThresholdAnnexADownstream&gt; &lt;MinThresholdAnnexMDownStream&gt;6423&lt;/MinThresholdAnnexMDownStream&gt; &lt;/EstimatedSyncSpeed&gt; &lt;EstimatedThroughputSpeedAnnexA&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.43&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.31&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.29&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.74&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.5&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.85&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.53&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.39&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.46&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.53&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.39&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.46&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.57&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.42&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.53&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.76&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.88&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;/EstimatedThroughputSpeedAnnexA&gt; &lt;EstimatedThroughputSpeedAnnexM&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.67&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.4&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.31&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.74&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.5&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.85&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.8&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.5&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.55&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.8&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.5&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.55&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.85&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.54&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.63&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.76&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.88&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;/EstimatedThroughputSpeedAnnexM&gt; &lt;ExchangeDetails&gt; &lt;CSSExchangeDistrictCode&gt;ND&lt;/CSSExchangeDistrictCode&gt; &lt;CircuitLineLength&gt; &lt;Length&gt;1903&lt;/Length&gt; &lt;MeasureType&gt;CircuitEstimated&lt;/MeasureType&gt; &lt;/CircuitLineLength&gt; &lt;ExchangeCapacity&gt;G&lt;/ExchangeCapacity&gt; &lt;ExchangeCode&gt;NDACO&lt;/ExchangeCode&gt; &lt;ExchangeName&gt;Archers Court&lt;/ExchangeName&gt; &lt;ExchangeState&gt;Live&lt;/ExchangeState&gt; &lt;ForecastDate&gt;2010-05-12T00:00:00&lt;/ForecastDate&gt; &lt;ProductMessages i:nil=&quot;true&quot;/&gt; &lt;/ExchangeDetails&gt; &lt;GoldAddressKey&gt;A00009292705&lt;/GoldAddressKey&gt; &lt;LineTypeDetails&gt; &lt;WorkingLineDetails&gt; &lt;InstallationType&gt;Standard&lt;/InstallationType&gt; &lt;ProductType&gt;MPF&lt;/ProductType&gt; &lt;/WorkingLineDetails&gt; &lt;/LineTypeDetails&gt; &lt;TechnologyMessages&gt; &lt;TechnologyMessage&gt; &lt;Code&gt;LLUMPF&lt;/Code&gt; &lt;Message&gt;MPF LLU Installation&lt;/Message&gt; &lt;/TechnologyMessage&gt; &lt;TechnologyMessage&gt; &lt;Code&gt;GEA&lt;/Code&gt; &lt;Message&gt;Generic Ethernet Access&lt;/Message&gt; &lt;/TechnologyMessage&gt; &lt;/TechnologyMessages&gt; &lt;/AvailabilityDetails&gt; &lt;/MPFAvailability&gt; &lt;Postcode/&gt; &lt;SMPFAvailability&gt; &lt;AvailabilityDetails i:type=&quot;SMPFAvailabilityDetails&quot;&gt; &lt;Status xmlns=&quot;http://schemas.datacontract.org/2004/07/InHouse.SharedLibraries.ServiceBase.BaseTypes&quot;&gt; &lt;Errors/&gt; &lt;HasErrors&gt;false&lt;/HasErrors&gt; &lt;/Status&gt; &lt;AccessLineID&gt;PRH4144561P4&lt;/AccessLineID&gt; &lt;AccessLineStatus&gt;BTLive&lt;/AccessLineStatus&gt; &lt;AccessLineStatusVDSL&gt;Working&lt;/AccessLineStatusVDSL&gt; &lt;EstimatedSyncSpeed&gt; &lt;AnnexADownstream&gt;8818&lt;/AnnexADownstream&gt; &lt;AnnexAMaxRangeDownstream&gt;11055&lt;/AnnexAMaxRangeDownstream&gt; &lt;AnnexAMinRangeDownstream&gt;6464&lt;/AnnexAMinRangeDownstream&gt; &lt;AnnexMDownstream&gt;7318&lt;/AnnexMDownstream&gt; &lt;AnnexMMaxRangeDownstream&gt;14655&lt;/AnnexMMaxRangeDownstream&gt; &lt;AnnexMMaxRangeUpstream&gt;1015&lt;/AnnexMMaxRangeUpstream&gt; &lt;AnnexMMinRangeDownstream&gt;7945&lt;/AnnexMMinRangeDownstream&gt; &lt;AnnexMMinRangeUpstream&gt;876&lt;/AnnexMMinRangeUpstream&gt; &lt;AnnexMUpstream&gt;1500&lt;/AnnexMUpstream&gt; &lt;MinThresholdAnnexADownstream&gt;5129&lt;/MinThresholdAnnexADownstream&gt; &lt;MinThresholdAnnexMDownStream&gt;6423&lt;/MinThresholdAnnexMDownStream&gt; &lt;/EstimatedSyncSpeed&gt; &lt;EstimatedThroughputSpeedAnnexA&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.43&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.31&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.29&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.74&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.5&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.85&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.53&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.39&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.46&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.53&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.39&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.46&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;5.57&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;4.42&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;9.53&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.76&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.88&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;/EstimatedThroughputSpeedAnnexA&gt; &lt;EstimatedThroughputSpeedAnnexM&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.67&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.4&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.31&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.74&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.5&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.85&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.8&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.5&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.55&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Consumer&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.8&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.5&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.55&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;Peak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.75&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.87&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;ThroughputSpeedType&gt; &lt;DownstreamThroughputBottom&gt;6.85&lt;/DownstreamThroughputBottom&gt; &lt;DownstreamThroughputMin&gt;5.54&lt;/DownstreamThroughputMin&gt; &lt;DownstreamThroughputTop&gt;12.63&lt;/DownstreamThroughputTop&gt; &lt;SpeedCategory&gt;Business&lt;/SpeedCategory&gt; &lt;TimeOfDay&gt;OffPeak&lt;/TimeOfDay&gt; &lt;UpstreamThroughputBottom&gt;0.76&lt;/UpstreamThroughputBottom&gt; &lt;UpstreamThroughputMin&gt;0.51&lt;/UpstreamThroughputMin&gt; &lt;UpstreamThroughputTop&gt;0.88&lt;/UpstreamThroughputTop&gt; &lt;/ThroughputSpeedType&gt; &lt;/EstimatedThroughputSpeedAnnexM&gt; &lt;ExchangeDetails&gt; &lt;CSSExchangeDistrictCode&gt;ND&lt;/CSSExchangeDistrictCode&gt; &lt;CircuitLineLength&gt; &lt;Length&gt;1903&lt;/Length&gt; &lt;MeasureType&gt;CircuitEstimated&lt;/MeasureType&gt; &lt;/CircuitLineLength&gt; &lt;ExchangeCapacity&gt;G&lt;/ExchangeCapacity&gt; &lt;ExchangeCode&gt;NDACO&lt;/ExchangeCode&gt; &lt;ExchangeName&gt;Archers Court&lt;/ExchangeName&gt; &lt;ExchangeState&gt;Live&lt;/ExchangeState&gt; &lt;ForecastDate&gt;0001-01-01T00:00:00&lt;/ForecastDate&gt; &lt;ProductMessages i:nil=&quot;true&quot;/&gt; &lt;/ExchangeDetails&gt; &lt;GoldAddressKey&gt;A00009292705&lt;/GoldAddressKey&gt; &lt;LineTypeDetails&gt; &lt;WorkingLineDetails&gt; &lt;InstallationType&gt;Standard&lt;/InstallationType&gt; &lt;ProductType&gt;MPF&lt;/ProductType&gt; &lt;/WorkingLineDetails&gt; &lt;/LineTypeDetails&gt; &lt;TechnologyMessages&gt; &lt;TechnologyMessage&gt; &lt;Code&gt;LLUMPF&lt;/Code&gt; &lt;Message&gt;MPF LLU Installation&lt;/Message&gt; &lt;/TechnologyMessage&gt; &lt;TechnologyMessage&gt; &lt;Code&gt;GEA&lt;/Code&gt; &lt;Message&gt;Generic Ethernet Access&lt;/Message&gt; &lt;/TechnologyMessage&gt; &lt;/TechnologyMessages&gt; &lt;/AvailabilityDetails&gt; &lt;/SMPFAvailability&gt; &lt;/GetAvailabilityResult&gt;</span><br></pre></td></tr></table></figure>


模型：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Serializable, XmlRoot(&quot;GetAvailabilityResult&quot;)] public class Availability &#123; [XmlElement(&quot;MPFAvailability&quot;)] public AvailabilityDetails MPFAvailability &#123; get; set; &#125; [XmlElement(&quot;SMPFAvailability&quot;)] public AvailabilityDetails SMPFAvailability &#123; get; set; &#125; &#125; public class AvailabilityDetails &#123; [XmlElement(&quot;AvailabilityDetails&quot;)] public AvailabilityContent AvailabilityContent &#123; get; set; &#125; &#125; public class AvailabilityContent &#123; [XmlElement(&quot;AccessLineID&quot;)] public string AccessLineID &#123; get; set; &#125; [XmlElement(&quot;AccessLineStatus&quot;)] public string AccessLineStatus &#123; get; set; &#125; [XmlElement(&quot;AccessLineStatusVDSL&quot;)] public string AccessLineStatusVDSL &#123; get; set; &#125; [XmlElement(&quot;DPType&quot;)] public string DPType &#123; get; set; &#125; [XmlElement(&quot;EstimatedSyncSpeed&quot;)] public EstimatedSyncSpeed EstimatedSyncSpeed &#123; get; set; &#125; [XmlElement(&quot;EstimatedThroughputSpeedAnnexA&quot;)] public List&lt;EstimatedThroughputSpeedAnnexA&gt; EstimatedThroughputSpeedAnnexA &#123; get; set; &#125; [XmlElement(&quot;EstimatedThroughputSpeedAnnexA&quot;)] public List&lt;EstimatedThroughputSpeedAnnexM&gt; EstimatedThroughputSpeedAnnexM &#123; get; set; &#125; [XmlElement(&quot;ExchangeDetails&quot;)] public ExchangeDetails ExchangeDetails &#123; get; set; &#125; &#125; public class EstimatedSyncSpeed &#123; [XmlElement(&quot;AnnexADownstream&quot;)] public int AnnexADownstream &#123; get; set; &#125; [XmlElement(&quot;AnnexAMaxRangeDownstream&quot;)] public int AnnexAMaxRangeDownstream &#123; get; set; &#125; [XmlElement(&quot;AnnexAMinRangeDownstream&quot;)] public int AnnexAMinRangeDownstream &#123; get; set; &#125; [XmlElement(&quot;AnnexMDownstream&quot;)] public int AnnexMDownstream &#123; get; set; &#125; [XmlElement(&quot;AnnexMMaxRangeDownstream&quot;)] public int AnnexMMaxRangeDownstream &#123; get; set; &#125; [XmlElement(&quot;AnnexMMinRangeDownstream&quot;)] public int AnnexMMinRangeDownstream &#123; get; set; &#125; [XmlElement(&quot;AnnexMMinRangeUpstream&quot;)] public int AnnexMMinRangeUpstream &#123; get; set; &#125; [XmlElement(&quot;AnnexMUpstream&quot;)] public int AnnexMUpstream &#123; get; set; &#125; [XmlElement(&quot;MinThresholdAnnexADownstream&quot;)] public int MinThresholdAnnexADownstream &#123; get; set; &#125; [XmlElement(&quot;MinThresholdAnnexMDownStream&quot;)] public int MinThresholdAnnexMDownStream &#123; get; set; &#125; &#125; public class EstimatedThroughputSpeedAnnexA &#123; [XmlElement(&quot;ThroughputSpeedType&quot;)] public ThroughputSpeedType ThroughputSpeedType &#123; get; set; &#125; &#125; public class EstimatedThroughputSpeedAnnexM &#123; [XmlElement(&quot;ThroughputSpeedType&quot;)] public ThroughputSpeedType ThroughputSpeedType &#123; get; set; &#125; &#125; public class ThroughputSpeedType &#123; [XmlElement(&quot;DownstreamThroughputBottom&quot;)] public double DownstreamThroughputBottom &#123; get; set; &#125; [XmlElement(&quot;DownstreamThroughputMin&quot;)] public double DownstreamThroughputMin &#123; get; set; &#125; [XmlElement(&quot;DownstreamThroughputTop&quot;)] public double DownstreamThroughputTop &#123; get; set; &#125; [XmlElement(&quot;SpeedCategory&quot;)] public string SpeedCategory &#123; get; set; &#125; [XmlElement(&quot;TimeOfDay&quot;)] public string TimeOfDay &#123; get; set; &#125; [XmlElement(&quot;UpstreamThroughputBottom&quot;)] public double UpstreamThroughputBottom &#123; get; set; &#125; [XmlElement(&quot;UpstreamThroughputMin&quot;)] public double UpstreamThroughputMin &#123; get; set; &#125; [XmlElement(&quot;UpstreamThroughputTop&quot;)] public double UpstreamThroughputTop &#123; get; set; &#125; &#125; public class ExchangeDetails &#123; [XmlElement(&quot;CSSExchangeDistrictCode&quot;)] public string CSSExchangeDistrictCode &#123; get; set; &#125; [XmlElement(&quot;CircuitLineLength&quot;)] public CircuitLineLength CircuitLineLength &#123; get; set; &#125; [XmlElement(&quot;ExchangeCapacity&quot;)] public string ExchangeCapacity &#123; get; set; &#125; [XmlElement(&quot;ExchangeCode&quot;)] public string ExchangeCode &#123; get; set; &#125; [XmlElement(&quot;ExchangeName&quot;)] public string ExchangeName &#123; get; set; &#125; [XmlElement(&quot;ExchangeState&quot;)] public string ExchangeState &#123; get; set; &#125; [XmlElement(&quot;ForecastDate&quot;)] public DateTime ForecastDate &#123; get; set; &#125; &#125; public class CircuitLineLength &#123; [XmlElement(&quot;Length&quot;)] public int Length &#123; get; set; &#125; [XmlElement(&quot;MeasureType&quot;)] public string MeasureType &#123; get; set; &#125; &#125;</span><br></pre></td></tr></table></figure>


序列化器代码：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string Outerxml = xmlToFormat.FirstChild.FirstChild.FirstChild.FirstChild.OuterXml; string formatedXml = XmlFormatter.RemoveXmlns(Outerxml); Availability result; // Deserialises xlm into an object XmlSerializer serializer = new XmlSerializer(typeof(Availability)); using (TextReader reader = new StringReader(formatedXml)) &#123; result = (Availability)serializer.Deserialize(reader); &#125; return result;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

您有两次出现此XML名称： 我发现这个内部异常： （如果您不需要的话，最好不要使用XmlElement属性！）


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[XmlElement(&quot;EstimatedThroughputSpeedAnnexA&quot;)]</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c使用两个串行端口本机RS485USBRS232的应用程序收到延迟的响应堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c使用两个串行端口本机RS485USBRS232的应用程序收到延迟的响应堆栈内存溢出.html" itemprop="url">c使用两个串行端口本机RS485USBRS232的应用程序收到延迟的响应堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Application utilizing two serial ports (native RS485 + USB RS232) receives delayed responses



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在使用旧应用程序（MSVC19，Windows 10上具有.NET 4.5.2的C＃），该应用程序充当无趣设备的前端。 为了促进与设备的通信，建立了两个串行连接。 连接到MCU板的串行RS485（115200波特8N1）和一个USB FTDI RS232到TTL（9600波特8N1）适配器，用于连接第三方传感器平台。


我要诊断的特定问题是，在另一个串行端口上发生任何通信之后不久，应用程序正在经历通过USB串行端口连接的传感器平台的延迟响应时间。 通常，传感器平台的响应时间在10到100毫秒之间是一致的。 在性能不佳的设置中 ，响应延迟可能长达20秒。


为了找出问题，我将所有通信都提取到一个最小的应用程序中。 我还用基于arduino系统的诱饵替换了MCU和Sensor平台，以确保MCU和Sensor平台都不是原因。


在采取了这些预防措施之后，我可以通过本地RS485端口连接设备的MCU诱饵来触发测试代码问题。 我可以通过USB RS485收发器连接MCU诱饵来防止此问题。 以下是显示该问题的日志摘录。


设置良好（USB RS485，USB RS232）


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[27.11.2019 11:21:19] SENSOR: TX: Q [27.11.2019 11:21:19] SENSOR: RX: [Z 00086 z 00083] [27.11.2019 11:21:19] BaseMessage: Message completed: ( 15,6 ms) [Q] [27.11.2019 11:21:20] MCU: TX: $;version;* [27.11.2019 11:21:20] MCU: RX: [$;version;pass;MCU;Proto4;Hw2;*] [27.11.2019 11:21:20] BaseMessage: Message completed: ( 15,6 ms) [$;version;*] [27.11.2019 11:21:21] SENSOR: TX: Q [27.11.2019 11:21:21] SENSOR: RX: [Z 00086 z 00089] [27.11.2019 11:21:21] BaseMessage: Message completed: ( 15,6 ms) [Q] [27.11.2019 11:21:22] SENSOR: TX: Q [27.11.2019 11:21:22] SENSOR: RX: [Z 00085 z 00076] [27.11.2019 11:21:22] BaseMessage: Message completed: ( 31,2 ms) [Q] [27.11.2019 11:21:23] SENSOR: TX: Q [27.11.2019 11:21:23] SENSOR: RX: [Z 00085 z 00089] [27.11.2019 11:21:23] BaseMessage: Message completed: ( 31,2 ms) [Q] [27.11.2019 11:21:24] SENSOR: TX: Q [27.11.2019 11:21:24] SENSOR: RX: [Z 00085 z 00079] [27.11.2019 11:21:24] BaseMessage: Message completed: ( 15,6 ms) [Q] [27.11.2019 11:21:25] MCU: TX: $;temp;* [27.11.2019 11:21:25] MCU: RX: [$;temp;pass;55;0;0;0;0;0;*] [27.11.2019 11:21:25] BaseMessage: Message completed: ( 15,6 ms) [$;temp;*] [27.11.2019 11:21:26] SENSOR: TX: Q [27.11.2019 11:21:26] SENSOR: RX: [Z 00086 z 00094] [27.11.2019 11:21:26] BaseMessage: Message completed: ( 31,2 ms) [Q]</span><br></pre></td></tr></table></figure>


性能不佳的设置（本机板载RS485，USB RS232）


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[27.11.2019 11:19:56] SENSOR: TX: Q [27.11.2019 11:19:56] SENSOR: RX: [Z 00088 z 00084] [27.11.2019 11:19:56] BaseMessage: Message completed: ( 15,6 ms) [Q] [27.11.2019 11:19:57] MCU: TX: $;version;* [27.11.2019 11:19:57] MCU: RX: [$;version;pass;MCU;Proto4;Hw2;*] [27.11.2019 11:19:57] BaseMessage: Message completed: ( 0,0 ms) [$;version;*] [27.11.2019 11:19:58] SENSOR: TX: Q [27.11.2019 11:20:06] SENSOR: RX: [Z 00088 z 00095] [27.11.2019 11:20:06] BaseMessage: Message completed: ( 7997,9 ms) [Q] [27.11.2019 11:20:07] SENSOR: TX: Q [27.11.2019 11:20:07] SENSOR: RX: [Z 00088 z 00090] [27.11.2019 11:20:07] BaseMessage: Message completed: ( 31,2 ms) [Q] [27.11.2019 11:20:08] SENSOR: TX: Q [27.11.2019 11:20:08] SENSOR: RX: [Z 00089 z 00097] [27.11.2019 11:20:08] BaseMessage: Message completed: ( 15,6 ms) [Q] [27.11.2019 11:20:09] SENSOR: TX: Q [27.11.2019 11:20:09] SENSOR: RX: [Z 00089 z 00089] [27.11.2019 11:20:09] BaseMessage: Message completed: ( 31,2 ms) [Q] [27.11.2019 11:20:10] MCU: TX: $;temp;* [27.11.2019 11:20:10] MCU: RX: [$;temp;pass;55;0;0;0;0;0;*] [27.11.2019 11:20:10] BaseMessage: Message completed: ( 0,0 ms) [$;temp;*] [27.11.2019 11:20:11] SENSOR: TX: Q [27.11.2019 11:20:16] SENSOR: RX: [Z 00089 z 00091] [27.11.2019 11:20:16] BaseMessage: Message completed: ( 4967,8 ms) [Q] [27.11.2019 11:20:17] SENSOR: TX: Q [27.11.2019 11:20:17] SENSOR: RX: [Z 00089 z 00092] [27.11.2019 11:20:17] BaseMessage: Message completed: ( 15,6 ms) [Q]</span><br></pre></td></tr></table></figure>


很明显，在性能不佳的设置中 ，每当有消息发送到MCU平台时，传感器平台的下一个响应都会延迟几秒钟。 通过检查我的arduino诱饵的输出，我已经确认发送到传感器平台（“ Q”）的请求消息没有延迟，并且立即发送了响应。 因此，延迟必须发生在PC的接收路径或我的应用程序中。


我还尝试过仅从应用程序连接传感器平台，然后使用终端执行与MCU平台的手动通信。 在这种情况下，不会发生延迟。


由于这是我第一次连接基于RS485的串行端口，我需要注意什么吗？ 我检查了计算机BIOS中是否有其他设置，但协议（RS232 / RS485）和通常的地址和中断号除外，没有任何设置。


Window对串行端口的处理是否存在任何已知的错误？ 由于USB转换器的普及，很难解决这个问题。 我不认为问题出在我的代码中，因为它可以在性能良好的开发人员设置中完美运行。


测试应用程序的来源如下； 如果有人感兴趣，我也可以提供诱饵的来源。 不幸的是，为了不超过帖子的长度，我不得不删除了很多评论和日志输出。 如果需要，我可以找到其他位置来上传摘要。


更新1


我将最小样本修剪为更小的样本，同时仍然表现出这种行为。 我更改了PC BIOS设置，其方式为PC现在在所有COM端口上使用RS232，并使用外部RS232 <-> RS485桥接器将MCU连接到COM1。 然后，我将RS232 <-> TTL转换器连接到COM2，并将传感器连接到COM2。 最终结果是，不再涉及USB转换器，而只是普通的板载COM端口。


我希望在BIOS中接近“默认”配置可以很好地工作。 但事实并非如此。 即使这样，延迟的响应仍然存在。


我还将所有连接的比特率更改为一致的9600，以确保这不是比特率转换问题。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using System; using System.Collections.Generic; using System.IO; using System.IO.Ports; using System.Linq; using System.Text; using System.Threading; using System.Threading.Tasks; using System.Timers; namespace MultiSerial &#123; public class MultiSerialTest &#123; public string TAG &#123; get &#123; return &quot;Test&quot;; &#125; &#125; const int ciQueryInterval = 1000; LogCollector logger; SerialComm mcucomm; COMSettings mcuComSettings; SerialStreamDecoder mcuDecoder; SerialComm Sensorcomm; COMSettings SensorComSettings; SerialStreamDecoder SensorDecoder; ManualResetEvent evtSensorConnected; ManualResetEvent evtMCUConnected; public void run(string mcu_port, string sensor_port) &#123; evtSensorConnected = new ManualResetEvent(false); evtMCUConnected = new ManualResetEvent(false); logger = new LogCollector(); logger.InitLog(&quot;CommTest.log&quot;); mcuComSettings = new COMSettings(9600, Parity.None, 8, StopBits.One); mcuDecoder = new SerialStreamDecoder( MCUCommMessage.preamble, MCUCommMessage.delimiter, MCUCommMessage.terminator ); mcucomm = new SerialComm( mcuComSettings, mcuDecoder, VerifyMCU, false, logger, mcu_port, &quot;MCU&quot; ); SensorComSettings = new COMSettings(9600, Parity.None, 8, StopBits.One); SensorDecoder = new SerialStreamDecoder( SensorCommMessage.preamble, SensorCommMessage.delimiter, SensorCommMessage.terminator ); Sensorcomm = new SerialComm( SensorComSettings, SensorDecoder, VerifySensor, false, logger, sensor_port, &quot;SENSOR&quot; ); Sensorcomm.ConnectDevice(); mcucomm.ConnectDevice(); int counter = 0; while (true) &#123; if (counter == 5) &#123; VersionRequest verReq = new VersionRequest(mcucomm); verReq.Send(); verReq.AwaitCompletion(); counter = 0; &#125; else &#123; FetchRequest fetchReq = new FetchRequest(Sensorcomm); fetchReq.Send(); fetchReq.AwaitCompletion(); &#125; counter++; System.Threading.Thread.Sleep(ciQueryInterval); &#125; &#125; void VerifySensor(SerialComm comm, out bool bSuccess) &#123; comm.Log(TAG, &quot;Servicing verification request for SensorComm&quot;); FetchRequest fetchMessage = new FetchRequest(comm); fetchMessage.Send(); fetchMessage.AwaitCompletion(); if (fetchMessage.result == 0) &#123; comm.Log(TAG, &quot;Verification for SensorComm successful&quot;); bSuccess = true; &#125; else &#123; comm.Log(TAG, &quot;Verification for SensorComm failed&quot;); bSuccess = false; &#125; return; &#125; void VerifyMCU(SerialComm comm, out bool bSuccess) &#123; comm.Log(TAG, &quot;Servicing verification request for mcuComm&quot;); VersionRequest versionMessage = new VersionRequest(comm); versionMessage.Send(); versionMessage.AwaitCompletion(); if (versionMessage.result == 0) &#123; comm.Log(TAG, &quot;Verification for mcuComm successful&quot;); bSuccess = true; &#125; else &#123; comm.Log(TAG, &quot;Verification for mcuComm failed&quot;); bSuccess = false; &#125; return; &#125; &#125; class Program &#123; static void Main(string[] args) &#123; MultiSerialTest test = new MultiSerialTest(); test.run(args[0], args[1]); &#125; &#125; public class FetchRequest : SensorCommMessage &#123; new string TAG &#123; get &#123; return &quot;SensorComm:FetchRequest&quot;; &#125; &#125; // Request = &quot;Q\r\n&quot; // Response = [&lt;identifier&gt;&lt;whitespace&gt;&lt;value&gt;]^n public FetchRequest(SerialComm comm) : base(comm,fetch_instruction) &#123; &#125; protected override bool ParseReplyContents(List&lt;string&gt; tokens) &#123; // Dummy validation if (tokens.Count &lt; 2 || tokens.Count % 2 != 0) &#123; return false; &#125; return true; &#125; &#125; public abstract class SensorCommMessage : BaseMessage &#123; new string TAG &#123; get &#123; return &quot;SensorCommMessage &quot;; &#125; &#125; public const char preamble_ch = &apos;Z&apos;; public const char delimiter_ch = &apos; &apos;; public static readonly string preamble = preamble_ch.ToString(); public static readonly char delimiter = delimiter_ch; public static readonly string terminator = &quot;\r\n&quot;; public const string fetch_instruction = &quot;Q&quot;; private string instructionToken; private List&lt;string&gt; userTokens; public SensorCommMessage(SerialComm _comm, string _instructionToken) : base(_comm) &#123; instructionToken = _instructionToken; &#125; public override string ToWireString() &#123; string message = instructionToken; if (userTokens != null) &#123; foreach (string token in userTokens) &#123; message += token; message += delimiter; &#125; &#125; return message; &#125; public override bool ParseReplyFrame(List&lt;string&gt; replyTokens) &#123; bool bHandled = false; bHandled = ParseReplyContents(replyTokens); if (bHandled) &#123; MessageCompleted(); &#125; return bHandled; &#125; protected abstract bool ParseReplyContents(List&lt;string&gt; replyContentTokens); &#125; public class VersionRequest : MCUCommMessage &#123; public string DeviceId &#123; get &#123; return strDeviceId; &#125; &#125; string strDeviceId; public string ProtocolVersion &#123; get &#123; return strProtocollVersion; &#125; &#125; string strProtocollVersion; public string HardwareVersion &#123; get &#123; return strHardwareVersion; &#125; &#125; string strHardwareVersion; // Request = $;version;* // Response = $;version;pass;DeviceId;ProtocolVersion;HardwareVersion;* public VersionRequest(SerialComm comm) : base(comm,version_instruction) &#123; &#125; protected override bool ParseReplyContents(List&lt;string&gt; tokens) &#123; // Expect precisely 3 remaining tokens if (tokens.Count != 3) &#123; return false; &#125; strDeviceId = tokens[0]; strProtocollVersion = tokens[1]; strHardwareVersion = tokens[2]; return true; &#125; &#125; public class ParseHelper &#123; public static bool ParseFloatToken(string strToken, float fMin, float fMax, out float fValue) &#123; fValue = float.NaN; if (float.TryParse(strToken, out fValue) &amp;&amp; fValue &gt;= fMin &amp;&amp; fValue &lt;= fMax) &#123; return true; &#125; return false; &#125; public static bool ParseIntToken(string strToken, int iMin, int iMax, out int iValue) &#123; iValue = 0; if (int.TryParse(strToken, out iValue) &amp;&amp; iValue &gt;= iMin &amp;&amp; iValue &lt;= iMax) &#123; return true; &#125; return false; &#125; &#125; public class SerialStreamDecoder &#123; public string TAG &#123; get &#123; return &quot;SerialStreamDecoder&quot;; &#125; &#125; public string preamble; public char delimiter; public string terminator; public SerialStreamDecoder(string _preamble, char _delimiter, string _terminator) &#123; preamble = _preamble; delimiter = _delimiter; terminator = _terminator; &#125; public bool DecodeMessageFromStream(SerialComm comm, out string message, out List&lt;string&gt; tokens) &#123; string strRx = &quot;&quot;; message = &quot;&quot;; tokens = null; // Read until terminator strRx = comm.usart.ReadTo(terminator); // Re-append terminator because it does not get included in the read strRx += terminator; // If a preamble is set, scan input sequence for preamble int preampleIndex = 0; if ( preamble != &quot;&quot; &amp;&amp; ( preampleIndex = strRx.IndexOf(preamble)) &gt; 0) &#123; strRx = strRx.Substring(preampleIndex, strRx.Length - preampleIndex); &#125; message = strRx; tokens = strRx.Split(delimiter).ToList&lt;string&gt;(); return true; &#125; &#125; public abstract class MCUCommMessage : BaseMessage &#123; public string TAG &#123; get &#123; return &quot;MCUCommMessage &quot;; &#125; &#125; public const char preamble_ch = &apos;$&apos;; public const char delimiter_ch = &apos;;&apos;; public const char terminator_ch = &apos;*&apos;; public static readonly string preamble = preamble_ch.ToString(); public static readonly char delimiter = delimiter_ch; public static readonly string terminator = terminator_ch.ToString(); public const string version_instruction = &quot;version&quot;; public const string okay_result = &quot;pass&quot;; public const string fail_result = &quot;fail&quot;; private string instructionToken; private List&lt;string&gt; userTokens; public MCUCommMessage(SerialComm _comm, string _instructionToken ) : base(_comm) &#123; instructionToken = _instructionToken; &#125; public override string ToWireString() &#123; string message = preamble + delimiter + instructionToken + delimiter; if (userTokens != null) &#123; foreach (string token in userTokens) &#123; message += token; message += delimiter; &#125; &#125; message += terminator; return message; &#125; public override bool ParseReplyFrame(List&lt;string&gt; replyTokens) &#123; bool bHandled = false; string lastToken = replyTokens.ElementAt(replyTokens.Count - 1); if (replyTokens.Count &lt; 4 || replyTokens[0] != preamble || replyTokens[1] != instructionToken || lastToken != terminator) &#123; return false; &#125; if (!bHandled &amp;&amp; replyTokens[2] == fail_result &amp;&amp; replyTokens.Count == 6 ) &#123; ParseHelper.ParseIntToken(replyTokens[4], int.MinValue, int.MaxValue, out result); bHandled = true; &#125; if (!bHandled &amp;&amp; replyTokens[2] == okay_result) &#123; List&lt;string&gt; payloadTokens = replyTokens.GetRange(3, replyTokens.Count - 4); bHandled = ParseReplyContents(payloadTokens); &#125; if (bHandled) &#123; MessageCompleted(); &#125; return bHandled; &#125; protected abstract bool ParseReplyContents(List&lt;string&gt; replyContentTokens); public void AddTokens(IEnumerable&lt;string&gt; tokens) &#123; if (userTokens == null) userTokens = new List&lt;string&gt;(); foreach (string token in tokens) &#123; userTokens.Add(token); &#125; &#125; &#125; public abstract class BaseMessage &#123; public string TAG &#123; get &#123; return &quot;BaseMessage&quot;; &#125; &#125; public ManualResetEvent evtMessageRelease; public delegate void MessageCompletedEventHandler(); public event MessageCompletedEventHandler EvtMessageCompleted; protected SerialComm comm; DateTime timestampRequest; DateTime timestampReply; public int result; public BaseMessage( SerialComm _comm ) &#123; comm = _comm; evtMessageRelease = new ManualResetEvent(false); &#125; public int Send() &#123; timestampRequest = DateTime.Now; comm.TransmitSync(this); return result; &#125; public void AwaitCompletion() &#123; evtMessageRelease.WaitOne(); &#125; public abstract string ToWireString(); protected void MessageCompleted() &#123; timestampReply = DateTime.Now; TimeSpan duration = timestampReply - timestampRequest; comm.Log(TAG, &quot;Message completed: (&quot; + string.Format(&quot;&#123;0,8:F1&#125; ms&quot;, duration.TotalMilliseconds) + &quot;) [&quot; + this.ToWireString() + &quot;]&quot;); if (EvtMessageCompleted != null) EvtMessageCompleted(); CleanupMessage(); &#125; private void CleanupMessage() &#123; evtMessageRelease.Set(); &#125; public abstract bool ParseReplyFrame(List&lt;string&gt; tokens); &#125; public class LogCollector &#123; StreamWriter streamwriter; public void InitLog(string file) &#123; Directory.CreateDirectory(&quot;.\\logs&quot;); FileStream filestream = new FileStream(&quot;.\\logs\\&quot; + file, FileMode.Create); streamwriter = new StreamWriter(filestream); streamwriter.AutoFlush = false; &#125; public void Log(string tag, string message) &#123; string logMessage = &quot;[&quot; + DateTime.Now.ToString() + &quot;] &quot; + tag + &quot;: &quot; + message; streamwriter.WriteLine(logMessage); streamwriter.Flush(); Console.WriteLine(logMessage); &#125; &#125; public class COMSettings &#123; public int baudrate; public Parity parity; public int databits; public StopBits stopbits; public COMSettings(int _baudrate, Parity _parity, int _databits, StopBits _stopbits) &#123; baudrate = _baudrate; parity = _parity; databits = _databits; stopbits = _stopbits; &#125; &#125; public class SerialComm &#123; public string TAG &#123; get &#123; return strTag; &#125; &#125; string strTag; LogCollector logger; public void Log(string tag, string message) &#123; if (logger != null) logger.Log(tag, message); &#125; COMSettings comSettings; public SerialPort usart; private string preferredPort; private BaseMessage currentMessage = null; private SerialStreamDecoder decoder; public delegate void VerifyDeviceResponseDelegate(SerialComm comm, out bool bSuccess); private event VerifyDeviceResponseDelegate DeviceResponseVerification; public delegate void MessageReceivedDelegate(); public event MessageReceivedDelegate EvtMessageReceived; Thread connectThread; public SerialComm( COMSettings _comSettings, SerialStreamDecoder _decoder, VerifyDeviceResponseDelegate d, bool _bReconnectEnabled, LogCollector _logger, string _preferredPort, string tag = &quot;SerialComm&quot; ) &#123; comSettings = _comSettings; decoder = _decoder; DeviceResponseVerification = d; logger = _logger; preferredPort = _preferredPort; strTag = tag; &#125; public bool ConnectDevice() &#123; bool bDeviceVerified = false; try &#123; usart = new SerialPort( preferredPort, comSettings.baudrate, comSettings.parity, comSettings.databits, comSettings.stopbits ); usart.Open(); usart.DataReceived += new SerialDataReceivedEventHandler(OnDataReceived); DeviceResponseVerification(this, out bDeviceVerified); &#125; catch (Exception e) &#123; bDeviceVerified = false; &#125; if (!bDeviceVerified) &#123; if (usart != null) &#123; usart.Close(); usart.DataReceived -= OnDataReceived; usart = null; &#125; &#125; return usart != null; &#125; /* OnDataReceived * Handles received serial communication */ private void OnDataReceived(object sender, SerialDataReceivedEventArgs e) &#123; try &#123; // Read until terminator if (usart == null) return; List&lt;string&gt; tokens = null; string message = &quot;&quot;; if (!decoder.DecodeMessageFromStream(this, out message, out tokens)) &#123; return; &#125; Log(TAG, &quot;RX: [&quot; + message.Trim() + &quot;]&quot;); bool bHandled = false; // Check if we received a response to the current message if (!bHandled &amp;&amp; this.currentMessage != null) &#123; bHandled = currentMessage.ParseReplyFrame(tokens); &#125; if (bHandled) &#123; if (EvtMessageReceived != null) EvtMessageReceived(); &#125; &#125; catch (Exception ex) &#123; &#125; &#125; public void TransmitSync(BaseMessage message) &#123; currentMessage = message; WriteCurrentMessage(); &#125; public void WriteCurrentMessage() &#123; usart.Write(currentMessage.ToWireString() + &quot;\r\n&quot;); Log(TAG, &quot;TX: &quot; + currentMessage.ToWireString()); &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2></-></->
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows网络驱动器上的文件操作错误堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows网络驱动器上的文件操作错误堆栈内存溢出.html" itemprop="url">cWindows网络驱动器上的文件操作错误堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
File operation error on windows network drives



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
最近，我在低级别的文件操作上遇到了问题（在旧的旧代码中）


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fd = open(file, O_RDWR); ... lseek(fd, 0L, SEEK_END); write(fd, buffer, len); ... lseek(fd, pos, SEEK_SET); read(fd, buffer, len);</span><br></pre></td></tr></table></figure>


在Windows 10（客户端）上，如果文件位于Windows Server 2012或2016提供的共享网络驱动器上。对于Windows Server 2012，连接的SMB版本为3.02；对于Windows Server 2016，该链接的版本为3.1.1。


该错误不会每次或在同一位置发生，有时lseek（）的返回值表示一个错误，但是在大多数情况下，lseek（）似乎没有返回正确的EOF位置，或者write（）在下一个lseek（）之前，尚未完成EOF上的操作，这是一种同步/缓存问题。 还尝试了fsync（fd）（或_commit（fd）），O_SYNC和延迟，但这似乎并不可靠。


使用Windows 7作为客户端，它就像在本地驱动器上工作了很多年一样。 同样，当我在Linux中安装该驱动器时，它可与SMB版本2.1、3.02、3.1.1一起使用。


所以我的问题是，SMB协议，网络共享和Windows 10是否存在已知问题，从而使这些低级文件操作（如lseek（））受到影响？


更新：


这是一个例子


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;fcntl.h&gt; #include &lt;string.h&gt; #include &lt;sys/stat.h&gt; #ifdef _WIN32 #include &lt;io.h&gt; #else #include &lt;unistd.h&gt; #define _O_CREAT O_CREAT #define _O_RDWR O_RDWR #define _S_IREAD S_IREAD #define _S_IWRITE S_IWRITE #define _open open #define _write write #define _lseek lseek #define _close close #endif char file[] = &quot;file.txt&quot;; int main() &#123; int fd = 0; int ret = 0; int len = 0; off_t pos = 0; off_t last_eof = 0; char buffer[] = &quot;12345&quot;; int buflen = 0; int n = 0; buflen = strlen(buffer); //unlink(file); fd = _open(file, _O_CREAT|_O_RDWR, _S_IREAD|_S_IWRITE); if (fd == -1) &#123; fprintf(stderr, &quot;ERROR open\n&quot;); exit(1); &#125; ret = _close(fd); if (ret == -1) &#123; fprintf(stderr, &quot;ERROR close\n&quot;); exit(1); &#125; for (n = 0; n &lt; 10000; n++) &#123; fd = _open(file, _O_RDWR, _S_IREAD|_S_IWRITE); if (fd == -1) &#123; fprintf(stderr, &quot;ERROR open [%d]\n&quot;, n); exit(1); &#125; pos = _lseek(fd, 0, SEEK_END); if (pos == -1) &#123; fprintf(stderr, &quot;ERROR lseek1 [%d] pos: %ld\n&quot;, n, pos); exit(1); &#125; if (last_eof &gt; 0 &amp;&amp; pos != last_eof) &#123; fprintf(stderr, &quot;ERROR [%d] eof: %ld last_eof: %ld\n&quot;, n, pos, last_eof); exit(1); &#125; len = _write(fd, buffer, buflen); if (len != buflen) &#123; fprintf(stderr, &quot;ERROR write [%d]\n&quot;, n); exit(1); &#125; pos = _lseek(fd, 0, SEEK_END); if (pos == -1) &#123; fprintf(stderr, &quot;ERROR lseek2 [%d] pos: %ld\n&quot;, n, pos); exit(1); &#125; last_eof = pos; ret = _close(fd); if (ret == -1) &#123; fprintf(stderr, &quot;ERROR close [%d]\n&quot;, n); exit(1); &#125; if (last_eof != (n+1)*buflen) &#123; fprintf(stderr, &quot;ERROR [%d] eof: %ld\n&quot;, n, last_eof); exit(1); &#125; &#125; fprintf(stdout, &quot;[%d] EOF: %ld\n&quot;, n, last_eof); return 0; &#125;</span><br></pre></td></tr></table></figure>


（在运行前删除file.txt ！）


与Visual Studio一起编译，在Windows 10和网络驱动器上执行，它偶然退出并出现“ eof-error”，例如


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; seek5win.exe ERROR [112] eof: 555 last_eof: 560</span><br></pre></td></tr></table></figure>


例如，使用eof / size 560关闭文件，然后使用eof / size 555重新打开文件。如果没有其他进程访问该文件，则它完成而没有错误。 但是，如果资源管理器或其他进程扫描目录，则有时lseek / eof-estimate处于关闭状态。 对不同的sh_flags使用_sopen_s()并没有帮助。


在ProcessMonitor中，它看起来像这样（当Explorer和sublime-text起作用时）：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">08:41:10,3133 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 540, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,3191 seek5win.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,3192 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 4.096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O, Priority: Normal 08:41:10,3347 seek5win.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Generic Read/Write, Disposition: Open, Options: Synchronous IO Non-Alert, Non-Directory File, Attributes: N, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened 08:41:10,3460 seek5win.exe QueryDeviceInformationVolume \\;LanmanRedirector\...\file.txt SUCCESS DeviceType: Disk, Characteristics: Remote 08:41:10,3594 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 540, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,3643 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 539, Length: 1, Priority: Normal 08:41:10,3644 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 540, I/O Flags: Non-cached, Paging I/O, Priority: Normal 08:41:10,3754 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 540, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,3838 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 540, Length: 5 08:41:10,4013 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 545, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,4101 seek5win.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,4102 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 4.096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O, Priority: Normal 08:41:10,4363 seek5win.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Generic Read/Write, Disposition: Open, Options: Synchronous IO Non-Alert, Non-Directory File, Attributes: N, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened 08:41:10,4537 seek5win.exe QueryDeviceInformationVolume \\;LanmanRedirector\...\file.txt SUCCESS DeviceType: Disk, Characteristics: Remote 08:41:10,4751 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 545, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,4870 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 544, Length: 1, Priority: Normal 08:41:10,4870 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 545, I/O Flags: Non-cached, Paging I/O, Priority: Normal 08:41:10,5171 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 545, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,5239 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 545, Length: 5 08:41:10,5375 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 550, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,5475 seek5win.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,5476 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 4.096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O, Priority: Normal 08:41:10,5646 seek5win.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Generic Read/Write, Disposition: Open, Options: Synchronous IO Non-Alert, Non-Directory File, Attributes: N, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened 08:41:10,5957 seek5win.exe QueryDeviceInformationVolume \\;LanmanRedirector\...\file.txt SUCCESS DeviceType: Disk, Characteristics: Remote 08:41:10,6111 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 550, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,6210 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 549, Length: 1, Priority: Normal 08:41:10,6211 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 550, I/O Flags: Non-cached, Paging I/O, Priority: Normal 08:41:10,6418 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 550, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,6501 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 550, Length: 5 08:41:10,6547 Explorer.exe QueryDirectory \\;LanmanRedirector\...\file.txt SUCCESS Filter: file.txt, 1: file.txt 08:41:10,6715 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 555, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,6934 seek5win.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,6935 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 4.096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O, Priority: Normal 08:41:10,6962 Explorer.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a, OpenResult: Opened 08:41:10,7229 seek5win.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Generic Read/Write, Disposition: Open, Options: Synchronous IO Non-Alert, Non-Directory File, Attributes: N, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened 08:41:10,7408 Explorer.exe QueryBasicInformationFile \\;LanmanRedirector\...\file.txt SUCCESS CreationTime: 31.10.2019 08:41:00, LastAccessTime: 31.10.2019 08:41:00, LastWriteTime: 31.10.2019 08:41:12, ChangeTime: 31.10.2019 08:41:12, FileAttributes: A 08:41:10,7456 seek5win.exe QueryDeviceInformationVolume \\;LanmanRedirector\...\file.txt SUCCESS DeviceType: Disk, Characteristics: Remote 08:41:10,7483 Explorer.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,7585 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 555, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,7645 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 554, Length: 1, Priority: Normal 08:41:10,7646 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 555, I/O Flags: Non-cached, Paging I/O, Priority: Normal 08:41:10,7886 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 555, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,8013 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 555, Length: 5 08:41:10,8221 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 560, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,8246 sublime_.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a, OpenResult: Opened 08:41:10,8319 seek5win.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,8319 seek5win.exe WriteFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 0, Length: 4.096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O, Priority: Normal 08:41:10,8453 seek5win.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Generic Read/Write, Disposition: Open, Options: Synchronous IO Non-Alert, Non-Directory File, Attributes: N, ShareMode: Read, Write, AllocationSize: n/a, OpenResult: Opened 08:41:10,8477 sublime_.exe QueryBasicInformationFile \\;LanmanRedirector\...\file.txt SUCCESS CreationTime: 31.10.2019 08:41:00, LastAccessTime: 31.10.2019 08:41:00, LastWriteTime: 31.10.2019 08:41:12, ChangeTime: 31.10.2019 08:41:12, FileAttributes: A 08:41:10,8679 seek5win.exe QueryDeviceInformationVolume \\;LanmanRedirector\...\file.txt SUCCESS DeviceType: Disk, Characteristics: Remote 08:41:10,8690 sublime_.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,8843 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 555, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,8918 sublime_.exe CreateFile \\;LanmanRedirector\...\file.txt SUCCESS Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a, OpenResult: Opened 08:41:10,8925 seek5win.exe ReadFile \\;LanmanRedirector\...\file.txt SUCCESS Offset: 554, Length: 1, Priority: Normal 08:41:10,9146 sublime_.exe QueryBasicInformationFile \\;LanmanRedirector\...\file.txt SUCCESS CreationTime: 31.10.2019 08:41:00, LastAccessTime: 31.10.2019 08:41:00, LastWriteTime: 31.10.2019 08:41:12, ChangeTime: 31.10.2019 08:41:12, FileAttributes: A 08:41:10,9167 seek5win.exe QueryStandardInformationFile \\;LanmanRedirector\...\file.txt SUCCESS AllocationSize: 4.096, EndOfFile: 555, NumberOfLinks: 1, DeletePending: False, Directory: False 08:41:10,9324 sublime_.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS 08:41:10,9485 seek5win.exe CloseFile \\;LanmanRedirector\...\file.txt SUCCESS</span><br></pre></td></tr></table></figure>


发生在smb 3.02和2.1版本中。


在本地驱动器上，我从未观察到这一点。 在Windows 7上，它循环运行，网络驱动器上没有错误（其他扫描文件的过程可能会使它变得很慢）。 在Linux上，它也可以在网络驱动器上使用（mount -t cifs ..）。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1 已采纳</strong></p>

（部分答案和更多详细信息；解决方法） write（）操作更新文件中的当前偏移量。 如果write（）从eof开始，则新的偏移量将成为新的eof。 尽管所有文件的大小和eof都应该相同（“全局”信息），但另一个文件句柄可能具有不同的偏移量。 因此，如果在为当前在eof上写入的句柄更新了当前偏移量之后更新了eof，并且例如，如果os（或某些驱动程序）没有采取进一步的预防措施，则可能会发生lseek(fd, 0, SEEK_CUR)和lseek(fd, 0, SEEK_END)返回不同的位置。 这是上面示例的更新，显示了在Windows 10和网络驱动器上的类似内容。 由于我从未从文件操作中得到error <0，所以没有错误处理。 如果没有其他进程接触（读取）文件，则该文件将运行而不会出错。 如果还有其他打开文件的过程，我通常会得到如下输出： 如果我用windows createfile，writefile，setfilepointer，...（版本（b））替换io函数，它的运行速度要快得多，但仍然得到例如 类似posix的调用（调用createfile，writefile等）需要更多时间，并且看起来文件在eof更新之前已关闭。 重新打开后，最后5个字节消失了。 在windows版本（b）中，当在第二次调用setfilepointer时，windows调用显示当前位置和eof之间的差异，eof不是最新的。 但关闭后文件大小还可以。 编辑：也张贴在这里 https: social.msdn.microsoft.com forums zh-cn 56f3cdf6-c14b-4053-aaeb-e121706f2866 ioh-file-operations?forum="vcgeneral" 更新： 如上面的链接中所述，设置以下win10注册表项可以避免该问题（据我测试...）： 看起来像smb协议的缓存参数，必须阅读更多有关它的信息。 我相信默认值是不同的； 如果不设置这些值（为零）就可以了。 此处还介绍了解决方法https: answers.microsoft.com msoffice forum msoffice_access-mso_winother-msoversion_other access-database-is-getting-corrupt-again-and-again d3fcc0a2-7d35- 4a09-9269-c5d93ad0031d？messageid="c9ddd419-da56-42dd-a7ca-f93d29cf2c7f＆page" = 13＆auth="1" （windows 10中租赁模式下的错误会影响access数据库） 信息： docs.microsoft.com previous-versions windows it-pro windows-7 ff686200(v="ws.10）" <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> #include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/stat.h&gt;</span><br><span class="line">#include &lt;io.h&gt;</span><br><span class="line"></span><br><span class="line">char file[] = &quot;file.txt&quot;;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line"></span><br><span class="line">    int fd = 0;</span><br><span class="line">    int ret = 0;</span><br><span class="line">    int len = 0;</span><br><span class="line">    off_t pos = 0,</span><br><span class="line">          pos_eof = 0,</span><br><span class="line">          last_pos = 0,</span><br><span class="line">          last_eof = 0;</span><br><span class="line">    char buffer[] = &quot;12345&quot;;</span><br><span class="line">    int buflen = 0;</span><br><span class="line">    int n = 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    buflen = strlen(buffer);</span><br><span class="line"></span><br><span class="line">    //unlink(file);</span><br><span class="line"></span><br><span class="line">    fd = _open(file, _O_CREAT|_O_RDWR, _S_IREAD|_S_IWRITE);</span><br><span class="line"></span><br><span class="line">    ret = _close(fd);</span><br><span class="line"></span><br><span class="line">    for (n = 0; n &lt; 10000; n++)</span><br><span class="line">    &#123;</span><br><span class="line">        fd = _open(file, _O_RDWR, _S_IREAD|_S_IWRITE);</span><br><span class="line"></span><br><span class="line">        pos_eof = _lseek(fd, 0, SEEK_END);</span><br><span class="line">        if (last_eof &gt; 0 &amp;&amp; pos_eof != last_eof) &#123;</span><br><span class="line">            fprintf(stderr, &quot;ERROR [%d] eof: %ld last_eof: %ld\n&quot;, n, pos_eof, last_eof);</span><br><span class="line">            pos = _lseek(fd, 0, SEEK_CUR);</span><br><span class="line">            fprintf(stderr, &quot;CUR pos: %ld\n&quot;, pos);</span><br><span class="line">            exit(1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        len = _write(fd, buffer, buflen);</span><br><span class="line"></span><br><span class="line">        pos     = _lseek(fd, 0, SEEK_CUR);</span><br><span class="line">        pos_eof = _lseek(fd, 0, SEEK_END);</span><br><span class="line"></span><br><span class="line">        last_pos = pos;</span><br><span class="line">        last_eof = pos_eof;</span><br><span class="line"></span><br><span class="line">        ret = _close(fd);</span><br><span class="line"></span><br><span class="line">        if (last_pos != (n+1)*buflen) &#123;</span><br><span class="line">            fprintf(stderr, &quot;ERROR [%d] pos: %ld\n&quot;, n, last_pos);</span><br><span class="line">            //exit(1);</span><br><span class="line">        &#125;</span><br><span class="line">        if (last_eof != (n+1)*buflen) &#123;</span><br><span class="line">            fprintf(stderr, &quot;ERROR [%d] eof: %ld (pos: %ld)\n&quot;, n, last_eof, last_pos);</span><br><span class="line">            //exit(1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fprintf(stdout, &quot;[%d] EOF: %ld\n&quot;, n, last_eof);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table>

</0，所以没有错误处理。>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../androidScrollView背景不均匀堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../androidScrollView背景不均匀堆栈内存溢出.html" itemprop="url">androidScrollView背景不均匀堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
ScrollView Background not homogeneous



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
目标：包含多个LinearLayout的ScrollView中具有相同不透明度“＃A4FFFFFF”的背景


当我在“正常尺寸的屏幕”（电话尺寸）中运行应用程序时，实际上可以滚动活动，因此背景是不透明的。 当我在不滚动活动的“大尺寸屏幕”（平板电脑尺寸）中运行应用程序时，屏幕底部1/4的背景不透明，而顶部3/4不透明。


如何使其均匀不透明？


这是问题的视觉：


平板电脑尺寸


这是我的XML文件


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;ScrollView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:layout_width=&quot;fill_parent&quot; android:layout_height=&quot;fill_parent&quot; android:background=&quot;@drawable/randomnumber&quot;&gt; &lt;LinearLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:layout_weight=&quot;0.5&quot; android:orientation=&quot;vertical&quot; android:background=&quot;#A4FFFFFF&quot; android:gravity=&quot;center&quot;&gt; &lt;TextView android:id=&quot;@+id/OptionsHeader2&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_marginTop=&quot;16dp&quot; android:ems=&quot;10&quot; android:gravity=&quot;center&quot; android:lineSpacingExtra=&quot;8sp&quot; android:text=&quot;MATH&#123;PROOF&#125;&quot; android:background=&quot;#546BF7CD&quot; android:textAllCaps=&quot;true&quot; android:textAppearance=&quot;@style/TextAppearance.AppCompat.Display1&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:typeface=&quot;serif&quot; android:paddingBottom=&quot;30dp&quot;/&gt; &lt;TextView android:id=&quot;@+id/Instructions1&quot; android:layout_width=&quot;207dp&quot; android:layout_height=&quot;wrap_content&quot; android:layout_marginStart=&quot;16dp&quot; android:layout_marginLeft=&quot;16dp&quot; android:layout_marginEnd=&quot;16dp&quot; android:layout_marginRight=&quot;16dp&quot; android:layout_marginBottom=&quot;16dp&quot; android:ems=&quot;10&quot; android:text=&quot;Please choose one or more operators. Then press on one difficulty and the game will start!&quot; android:textSize=&quot;20dp&quot; android:layout_gravity=&quot;center&quot; android:textStyle=&quot;bold&quot; android:textColor=&quot;#000000&quot;/&gt; &lt;TextView android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Difficulty&quot; android:layout_gravity=&quot;center&quot; android:paddingBottom=&quot;10dp&quot; android:textColor=&quot;#E9D34A06&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;18dp&quot; android:textAllCaps=&quot;true&quot;/&gt; &lt;Button android:id=&quot;@+id/Difficulty1&quot; android:layout_width=&quot;180dp&quot; android:layout_height=&quot;58dp&quot; android:layout_marginStart=&quot;16dp&quot; android:layout_marginLeft=&quot;16dp&quot; android:layout_marginEnd=&quot;16dp&quot; android:layout_marginRight=&quot;16dp&quot; android:layout_marginBottom=&quot;16dp&quot; android:background=&quot;#546BF7CD&quot; android:textSize=&quot;18dp&quot; android:onClick=&quot;setDifficulty&quot; android:requiresFadingEdge=&quot;horizontal|vertical&quot; android:scaleType=&quot;fitCenter&quot; android:text=&quot;@string/Difficulty1&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;Button android:id=&quot;@+id/Difficulty2&quot; android:layout_width=&quot;180dp&quot; android:layout_height=&quot;58dp&quot; android:layout_marginStart=&quot;16dp&quot; android:layout_marginLeft=&quot;16dp&quot; android:layout_marginEnd=&quot;16dp&quot; android:layout_marginRight=&quot;16dp&quot; android:layout_marginBottom=&quot;16dp&quot; android:background=&quot;#546BF7CD&quot; android:textSize=&quot;18dp&quot; android:onClick=&quot;setDifficulty&quot; android:scaleType=&quot;fitCenter&quot; android:text=&quot;@string/Difficulty2&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;Button android:id=&quot;@+id/Difficulty3&quot; android:layout_width=&quot;180dp&quot; android:layout_height=&quot;58dp&quot; android:layout_marginStart=&quot;16dp&quot; android:layout_marginLeft=&quot;16dp&quot; android:layout_marginEnd=&quot;16dp&quot; android:layout_marginRight=&quot;16dp&quot; android:layout_marginBottom=&quot;16dp&quot; android:background=&quot;#546BF7CD&quot; android:textSize=&quot;18dp&quot; android:onClick=&quot;setDifficulty&quot; android:scaleType=&quot;fitCenter&quot; android:text=&quot;@string/Difficulty3&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;LinearLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:layout_weight=&quot;0.5&quot; android:orientation=&quot;horizontal&quot; android:gravity=&quot;center&quot;&gt; &lt;LinearLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:layout_weight=&quot;0.5&quot; android:orientation=&quot;vertical&quot; android:gravity=&quot;left&quot;&gt; &lt;TextView android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Operators&quot; android:layout_gravity=&quot;left&quot; android:paddingBottom=&quot;10dp&quot; android:paddingTop=&quot;10dp&quot; android:textColor=&quot;#E9D34A06&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;16dp&quot; android:textAllCaps=&quot;true&quot;/&gt; &lt;Switch android:id=&quot;@+id/Add&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Add&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;left&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;18dp&quot; android:layoutDirection=&quot;rtl&quot;/&gt; &lt;Switch android:id=&quot;@+id/Subtract&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Subtract&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;left&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;18dp&quot; android:layoutDirection=&quot;rtl&quot;/&gt; &lt;Switch android:id=&quot;@+id/Multiply&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Multiply&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;left&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;18dp&quot; android:layoutDirection=&quot;rtl&quot;/&gt; &lt;Switch android:id=&quot;@+id/Divide&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Divide&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;left&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;18dp&quot; android:layoutDirection=&quot;rtl&quot;/&gt; &lt;Switch android:id=&quot;@+id/Exponent&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Exponent&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;left&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:textSize=&quot;18dp&quot; android:layoutDirection=&quot;rtl&quot;/&gt; &lt;Switch android:id=&quot;@+id/Square_Root&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Square_Root&quot; android:paddingTop=&quot;20dp&quot; android:paddingBottom=&quot;20dp&quot; android:textSize=&quot;18dp&quot; android:layout_gravity=&quot;left&quot; android:textColor=&quot;#000000&quot; android:textStyle=&quot;bold&quot; android:layoutDirection=&quot;rtl&quot;/&gt; &lt;/LinearLayout&gt; &lt;LinearLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:layout_weight=&quot;0.5&quot; android:orientation=&quot;vertical&quot; android:gravity=&quot;right&quot;&gt; &lt;TextView android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:layout_gravity=&quot;right&quot; android:paddingTop=&quot;10dp&quot; android:paddingBottom=&quot;10dp&quot; android:text=&quot;Additional Features&quot; android:textAllCaps=&quot;true&quot; android:textColor=&quot;#E9D34A06&quot; android:textSize=&quot;16dp&quot; android:textStyle=&quot;bold&quot; /&gt; &lt;Switch android:id=&quot;@+id/Negative_Numbers&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Negative Numbers&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;right&quot; android:textColor=&quot;#000000&quot; android:textSize=&quot;18dp&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;Switch android:id=&quot;@+id/Teach&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Teach_Mode&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;right&quot; android:textColor=&quot;#000000&quot; android:textSize=&quot;18dp&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;Switch android:id=&quot;@+id/DoSim&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Simulate&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;right&quot; android:textColor=&quot;#000000&quot; android:textSize=&quot;18dp&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;Switch android:id=&quot;@+id/Sound&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;wrap_content&quot; android:text=&quot;Sound&quot; android:paddingTop=&quot;20dp&quot; android:layout_gravity=&quot;right&quot; android:paddingBottom=&quot;20dp&quot; android:textColor=&quot;#000000&quot; android:textSize=&quot;18dp&quot; android:textStyle=&quot;bold&quot;/&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt; &lt;/LinearLayout&gt; &lt;/ScrollView&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

您的LinearLayout仅占用所需的空间，因为这是导致背景不透明的视图，因此只会影响其占用的屏幕部分。 您可以尝试将新的View添加到屏幕的背面。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;ScrollView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;fill_parent&quot;</span><br><span class="line">    android:layout_height=&quot;fill_parent&quot;</span><br><span class="line">    android:background=&quot;@drawable/randomnumber&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;View</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:background=&quot;#A4FFFFFF&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_weight=&quot;0.5&quot;</span><br><span class="line">        android:orientation=&quot;vertical&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/OptionsHeader2&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginTop=&quot;16dp&quot;</span><br><span class="line">            android:ems=&quot;10&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:lineSpacingExtra=&quot;8sp&quot;</span><br><span class="line">            android:text=&quot;MATH&#123;PROOF&#125;&quot;</span><br><span class="line">            android:background=&quot;#546BF7CD&quot;</span><br><span class="line">            android:textAllCaps=&quot;true&quot;</span><br><span class="line">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Display1&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:typeface=&quot;serif&quot;</span><br><span class="line">            android:paddingBottom=&quot;30dp&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/Instructions1&quot;</span><br><span class="line">            android:layout_width=&quot;207dp&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_marginStart=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginEnd=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;16dp&quot;</span><br><span class="line">            android:ems=&quot;10&quot;</span><br><span class="line">            android:text=&quot;Please choose one or more operators. Then press on one difficulty and the game will start!&quot;</span><br><span class="line">            android:textSize=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;center&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Difficulty&quot;</span><br><span class="line">            android:layout_gravity=&quot;center&quot;</span><br><span class="line">            android:paddingBottom=&quot;10dp&quot;</span><br><span class="line">            android:textColor=&quot;#E9D34A06&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:textAllCaps=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/Difficulty1&quot;</span><br><span class="line">            android:layout_width=&quot;180dp&quot;</span><br><span class="line">            android:layout_height=&quot;58dp&quot;</span><br><span class="line">            android:layout_marginStart=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginEnd=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;16dp&quot;</span><br><span class="line">            android:background=&quot;#546BF7CD&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:onClick=&quot;setDifficulty&quot;</span><br><span class="line">            android:requiresFadingEdge=&quot;horizontal|vertical&quot;</span><br><span class="line">            android:scaleType=&quot;fitCenter&quot;</span><br><span class="line">            android:text=&quot;@string/Difficulty1&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/Difficulty2&quot;</span><br><span class="line">            android:layout_width=&quot;180dp&quot;</span><br><span class="line">            android:layout_height=&quot;58dp&quot;</span><br><span class="line">            android:layout_marginStart=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginEnd=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;16dp&quot;</span><br><span class="line">            android:background=&quot;#546BF7CD&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:onClick=&quot;setDifficulty&quot;</span><br><span class="line">            android:scaleType=&quot;fitCenter&quot;</span><br><span class="line">            android:text=&quot;@string/Difficulty2&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/Difficulty3&quot;</span><br><span class="line">            android:layout_width=&quot;180dp&quot;</span><br><span class="line">            android:layout_height=&quot;58dp&quot;</span><br><span class="line">            android:layout_marginStart=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginLeft=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginEnd=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginRight=&quot;16dp&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;16dp&quot;</span><br><span class="line">            android:background=&quot;#546BF7CD&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:onClick=&quot;setDifficulty&quot;</span><br><span class="line">            android:scaleType=&quot;fitCenter&quot;</span><br><span class="line">            android:text=&quot;@string/Difficulty3&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_weight=&quot;0.5&quot;</span><br><span class="line">            android:orientation=&quot;horizontal&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_weight=&quot;0.5&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;</span><br><span class="line">            android:gravity=&quot;left&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Operators&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:paddingBottom=&quot;10dp&quot;</span><br><span class="line">            android:paddingTop=&quot;10dp&quot;</span><br><span class="line">            android:textColor=&quot;#E9D34A06&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;16dp&quot;</span><br><span class="line">            android:textAllCaps=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Add&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Add&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:layoutDirection=&quot;rtl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Subtract&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Subtract&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:layoutDirection=&quot;rtl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Multiply&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Multiply&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:layoutDirection=&quot;rtl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Divide&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Divide&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:layoutDirection=&quot;rtl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Exponent&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Exponent&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:layoutDirection=&quot;rtl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Square_Root&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Square_Root&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:paddingBottom=&quot;20dp&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;</span><br><span class="line">            android:layoutDirection=&quot;rtl&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_weight=&quot;0.5&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;</span><br><span class="line">            android:gravity=&quot;right&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">                android:layout_gravity=&quot;right&quot;</span><br><span class="line">                android:paddingTop=&quot;10dp&quot;</span><br><span class="line">                android:paddingBottom=&quot;10dp&quot;</span><br><span class="line">                android:text=&quot;Additional Features&quot;</span><br><span class="line">                android:textAllCaps=&quot;true&quot;</span><br><span class="line">                android:textColor=&quot;#E9D34A06&quot;</span><br><span class="line">                android:textSize=&quot;16dp&quot;</span><br><span class="line">                android:textStyle=&quot;bold&quot; /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Negative_Numbers&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Negative Numbers&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;right&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">                android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Teach&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Teach_Mode&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;right&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/DoSim&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Simulate&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;right&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch</span><br><span class="line">            android:id=&quot;@+id/Sound&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:text=&quot;Sound&quot;</span><br><span class="line">            android:paddingTop=&quot;20dp&quot;</span><br><span class="line">            android:layout_gravity=&quot;right&quot;</span><br><span class="line">            android:paddingBottom=&quot;20dp&quot;</span><br><span class="line">            android:textColor=&quot;#000000&quot;</span><br><span class="line">            android:textSize=&quot;18dp&quot;</span><br><span class="line">            android:textStyle=&quot;bold&quot;/&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/ScrollView&gt;</span><br></pre></td></tr></table></figure>

<p><strong>===============&gt;&gt;#2 票数：0</strong></p>

我得到了答案，我需要做的是将RelativeLayout放置为ScrollView,父级ScrollView,如下所示。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> &lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ScrollView</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:fillViewport=&quot;true&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:background=&quot;@drawable/signup_background&quot;</span><br><span class="line">            android:orientation=&quot;vertical&quot;</span><br><span class="line">            android:padding=&quot;40dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line">    &lt;/ScrollView&gt;</span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c如何解析列式存储格式的XML文件堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c如何解析列式存储格式的XML文件堆栈内存溢出.html" itemprop="url">c如何解析列式存储格式的XML文件堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
How do I parse XML file in columnar storage format?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我想分块地解析XML文件，这样它就不会耗尽内存，并以列存储方式解析它， 即每一行的key1：value1，key2：value2，key3：value3等。


目前，我正在读取如下文件：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string parseFieldFromLine(const string &amp;line, const string &amp;key) &#123; // We&apos;re looking for a thing that looks like: // [key]=&quot;[value]&quot; // as part of a larger string. // We are given [key], and want to return [value]. // Find the start of the pattern string keyPattern = key + &quot;=\&quot;&quot;; ssize_t idx = line.find(keyPattern); // No match if (idx == -1) return &quot;&quot;; // Find the closing quote at the end of the pattern size_t start = idx + keyPattern.size(); size_t end = start; while (line[end] != &apos;&quot;&apos;) &#123; end++; &#125; // Extract [value] from the overall string and return it // We have (start, end); substr() requires, // so we must compute, (start, length). return line.substr(start, end - start); &#125; map&lt;string, User&gt; users; void readUsers(const string &amp;filename) &#123; ifstream fin; fin.open(filename.c_str()); string line; while (getline(fin, line)) &#123; User u; u.Id = parseFieldFromLine(line, &quot;Id&quot;); u.DisplayName = parseFieldFromLine(line, &quot;DisplayName&quot;); users[u.Id] = u; &#125; &#125;</span><br></pre></td></tr></table></figure>


如您所见，我正在调用一个在一行中找到子字符串的函数。 从某种意义上来说，这是有问题的，如果我有一个格式错误的文件（行），我会得到意想不到的值，从而导致无提示故障。


我读到有关使用XML解析器的信息，但对于C ++来说是新手，由于对测试工作/效率的了解也很少，因此我无法确定哪种解析器最适合键值格式。 我当前的I / P数据如下所示：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;posts&gt; &lt;row Id=&quot;1&quot; PostTypeId=&quot;1&quot; AcceptedAnswerId=&quot;509&quot; CreationDate=&quot;2009-04-30T06:49:01.807&quot; Score=&quot;13&quot; ViewCount=&quot;903&quot; Body=&quot;&amp;lt;p&amp;gt;Our nightly full (and periodic differential) backups are becoming quite large, due mostly to the amount of indexes on our tables; roughly half the backup size is comprised of indexes.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;We&apos;re using the &amp;lt;strong&amp;gt;Simple&amp;lt;/strong&amp;gt; recovery model for our backups.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;Is there any way, through using &amp;lt;code&amp;gt;FileGroups&amp;lt;/code&amp;gt; or some other file-partitioning method, to &amp;lt;strong&amp;gt;exclude&amp;lt;/strong&amp;gt; indexes from the backups?&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;It would be nice if this could be extended to full-text catalogs, as well.&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;3&quot; LastEditorUserId=&quot;919&quot; LastEditorDisplayName=&quot;&quot; LastEditDate=&quot;2009-05-04T02:11:16.667&quot; LastActivityDate=&quot;2009-05-10T15:22:39.707&quot; Title=&quot;How to exclude indexes from backups in SQL Server 2008&quot; Tags=&quot;&amp;lt;sql-server&amp;gt;&amp;lt;backup&amp;gt;&amp;lt;sql-server-2008&amp;gt;&amp;lt;indexes&amp;gt;&quot; AnswerCount=&quot;3&quot; CommentCount=&quot;0&quot; FavoriteCount=&quot;3&quot; /&gt; &lt;row Id=&quot;2&quot; PostTypeId=&quot;1&quot; AcceptedAnswerId=&quot;1238&quot; CreationDate=&quot;2009-04-30T07:04:18.883&quot; Score=&quot;18&quot; ViewCount=&quot;1951&quot; Body=&quot;&amp;lt;p&amp;gt;We&apos;ve struggled with the RAID controller in our database server, a &amp;lt;a href=&amp;quot;http://www.pc.ibm.com/europe/server/index.html?nl&amp;amp;amp;cc=nl&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Lenovo ThinkServer&amp;lt;/a&amp;gt; RD120. It is a rebranded Adaptec that Lenovo / IBM dubs the &amp;lt;a href=&amp;quot;http://www.redbooks.ibm.com/abstracts/tips0054.html#ServeRAID-8k&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;ServeRAID 8k&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;We have patched this &amp;lt;a href=&amp;quot;http://www.redbooks.ibm.com/abstracts/tips0054.html#ServeRAID-8k&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;ServeRAID 8k&amp;lt;/a&amp;gt; up to the very latest and greatest:&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;ul&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;RAID bios version&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;RAID backplane bios version&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;Windows Server 2008 driver&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;/ul&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;This RAID controller has had multiple critical BIOS updates even in the short 4 month time we&apos;ve owned it, and the &amp;lt;a href=&amp;quot;ftp://ftp.software.ibm.com/systems/support/system%5Fx/ibm%5Ffw%5Faacraid%5F5.2.0-15427%5Fanyos%5F32-64.chg&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;change history&amp;lt;/a&amp;gt; is just.. well, scary. &amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;We&apos;ve tried both write-back and write-through strategies on the logical RAID drives. &amp;lt;strong&amp;gt;We still get intermittent I/O errors under heavy disk activity.&amp;lt;/strong&amp;gt; They are not common, but serious when they happen, as they cause SQL Server 2008 I/O timeouts and sometimes failure of SQL connection pools.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;We were at the end of our rope troubleshooting this problem. Short of hardcore stuff like replacing the entire server, or replacing the RAID hardware, we were getting desperate.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;When I first got the server, I had a problem where drive bay #6 wasn&apos;t recognized. Switching out hard drives to a different brand, strangely, fixed this -- and updating the RAID BIOS (for the first of many times) fixed it permanently, so I was able to use the original &amp;quot;incompatible&amp;quot; drive in bay 6. On a hunch, I began to assume that &amp;lt;a href=&amp;quot;http://www.newegg.com/Product/Product.aspx?Item=N82E16822136143&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;the Western Digital SATA hard drives&amp;lt;/a&amp;gt; I chose were somehow incompatible with the ServeRAID 8k controller.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;Buying 6 new hard drives was one of the cheaper options on the table, so I went for &amp;lt;a href=&amp;quot;http://www.newegg.com/Product/Product.aspx?Item=N82E16822145215&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;6 Hitachi (aka IBM, aka Lenovo) hard drives&amp;lt;/a&amp;gt; under the theory that an IBM/Lenovo RAID controller is more likely to work with the drives it&apos;s typically sold with.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;Looks like that hunch paid off -- we&apos;ve been through three of our heaviest load days (mon,tue,wed) without a single I/O error of any kind. Prior to this we regularly had at least one I/O &amp;quot;event&amp;quot; in this time frame. &amp;lt;strong&amp;gt;It sure looks like switching brands of hard drive has fixed our intermittent RAID I/O problems!&amp;lt;/strong&amp;gt;&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;While I understand that IBM/Lenovo probably tests their RAID controller exclusively with their own brand of hard drives, I&apos;m disturbed that a RAID controller would have such subtle I/O problems with particular brands of hard drives.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;So my question is, &amp;lt;strong&amp;gt;is this sort of SATA drive incompatibility common with RAID controllers?&amp;lt;/strong&amp;gt; Are there some brands of drives that work better than others, or are &amp;quot;validated&amp;quot; against particular RAID controller? I had sort of assumed that all commodity SATA hard drives were alike and would work reasonably well in any given RAID controller (of sufficient quality).&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;1&quot; LastActivityDate=&quot;2011-03-08T08:18:15.380&quot; Title=&quot;Do RAID controllers commonly have SATA drive brand compatibility issues?&quot; Tags=&quot;&amp;lt;raid&amp;gt;&amp;lt;ibm&amp;gt;&amp;lt;lenovo&amp;gt;&amp;lt;serveraid8k&amp;gt;&quot; AnswerCount=&quot;8&quot; FavoriteCount=&quot;2&quot; /&gt; &lt;row Id=&quot;3&quot; PostTypeId=&quot;1&quot; AcceptedAnswerId=&quot;104&quot; CreationDate=&quot;2009-04-30T07:48:06.750&quot; Score=&quot;26&quot; ViewCount=&quot;692&quot; Body=&quot;&amp;lt;ul&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;How do you keep your servers up to date?&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;When using a package manager like &amp;lt;a href=&amp;quot;http://wiki.debian.org/Aptitude&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Aptitude&amp;lt;/a&amp;gt;, do you keep an upgrade / install history, and if so, how do you do it?&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;When installing or upgrading packages on multiple servers, are there any ways to speed the process up as much as possible?&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;/ul&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;22&quot; LastEditorUserId=&quot;22&quot; LastEditorDisplayName=&quot;&quot; LastEditDate=&quot;2009-04-30T08:05:02.217&quot; LastActivityDate=&quot;2009-06-05T04:01:09.423&quot; Title=&quot;Best practices for keeping UNIX packages up to date?&quot; Tags=&quot;&amp;lt;unix&amp;gt;&amp;lt;package-management&amp;gt;&amp;lt;server-management&amp;gt;&quot; AnswerCount=&quot;11&quot; FavoriteCount=&quot;14&quot; /&gt; &lt;row Id=&quot;4&quot; PostTypeId=&quot;2&quot; ParentId=&quot;3&quot; CreationDate=&quot;2009-04-30T07:49:58.027&quot; Score=&quot;10&quot; ViewCount=&quot;&quot; Body=&quot;&amp;lt;p&amp;gt;Regarding your third question: I always run a local repository. Even if it&apos;s only for one machine, it saves time in case I need to reinstall (I generally use something like aptitude autoclean), and for two machines, it almost always pays off.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;For the clusters I admin, I don&apos;t generally keep explicit logs: I let the package manager do it for me. However, for those machines (as opposed to desktops), I don&apos;t use automatic installations, so I do have my notes about what I intended to install to all machines.&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;28&quot; LastActivityDate=&quot;2009-04-30T07:49:58.027&quot; CommentCount=&quot;1&quot; /&gt; &lt;row Id=&quot;5&quot; PostTypeId=&quot;2&quot; ParentId=&quot;2&quot; CreationDate=&quot;2009-04-30T07:56:20.070&quot; Score=&quot;4&quot; ViewCount=&quot;&quot; Body=&quot;&amp;lt;p&amp;gt;I don&apos;t think it&apos;s common per se. However, as soon as you start using enterprise storage controllers, whether that be SAN&apos;s or standalone RAID controllers, you&apos;ll generally want to adhere to their compatibility list rather closely.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;You may be able to save some bucks on the sticker price by buying a cheap range of disks, but that&apos;s probably one of the last areas I&apos;d want to save money on - given the importance of data in most scenarios.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;In other words, explicit incompatibility is very uncommon, but explicit compatibility adherence is recommendable.&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;24&quot; LastActivityDate=&quot;2009-04-30T07:56:20.070&quot; /&gt; &lt;row Id=&quot;6&quot; PostTypeId=&quot;1&quot; AcceptedAnswerId=&quot;537&quot; CreationDate=&quot;2009-04-30T07:57:06.247&quot; Score=&quot;8&quot; ViewCount=&quot;2648&quot; Body=&quot;&amp;lt;p&amp;gt;Our database currently only has one FileGroup, PRIMARY, which contains roughly 8GB of data (table rows, indexes, full-text catalog).&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;When is a good time to split this into secondary data files? What are some criteria that I should be aware of?&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;3&quot; LastActivityDate=&quot;2009-07-08T07:23:49.527&quot; Title=&quot;In SQL Server, when should you split your PRIMARY Data FileGroup into secondary data files?&quot; Tags=&quot;&amp;lt;sql-server&amp;gt;&amp;lt;files&amp;gt;&amp;lt;filegroups&amp;gt;&quot; AnswerCount=&quot;3&quot; FavoriteCount=&quot;1&quot; /&gt; &lt;row Id=&quot;7&quot; PostTypeId=&quot;1&quot; AcceptedAnswerId=&quot;17&quot; CreationDate=&quot;2009-04-30T07:57:09.117&quot; Score=&quot;12&quot; ViewCount=&quot;529&quot; Body=&quot;&amp;lt;p&amp;gt;What enterprise virus-scanning systems do you recommend?&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;32&quot; LastActivityDate=&quot;2009-04-30T11:51:09.290&quot; Title=&quot;What is the best enterprise virus-scanning system?&quot; Tags=&quot;&amp;lt;antivirus&amp;gt;&quot; AnswerCount=&quot;8&quot; CommentCount=&quot;3&quot; FavoriteCount=&quot;2&quot; /&gt; &lt;row Id=&quot;8&quot; PostTypeId=&quot;2&quot; ParentId=&quot;3&quot; CreationDate=&quot;2009-04-30T07:57:15.653&quot; Score=&quot;0&quot; ViewCount=&quot;&quot; Body=&quot;&amp;lt;p&amp;gt;You can have a local repository and configure all servers to point to it for updates. Not only you get speed of local downloads, you also get to control which official updates you want installed on your infrastructure in order to prevent any compatibility issues.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;On the Windows side of things, I&apos;ve used &amp;lt;a href=&amp;quot;http://technet.microsoft.com/en-us/wsus/default.aspx&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Windows Server Update Services&amp;lt;/a&amp;gt; with very satisfying results.&amp;lt;/p&amp;gt;&amp;#xA;&quot; OwnerUserId=&quot;36&quot; LastActivityDate=&quot;2009-04-30T07:57:15.653&quot; /&gt;</span><br></pre></td></tr></table></figure>


其他档案：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;users&gt; &lt;row Id=&quot;1&quot; Reputation=&quot;4220&quot; CreationDate=&quot;2009-04-30T07:08:27.067&quot; DisplayName=&quot;Jeff Atwood&quot; EmailHash=&quot;51d623f33f8b83095db84ff35e15dbe8&quot; LastAccessDate=&quot;2011-09-03T13:30:29.990&quot; WebsiteUrl=&quot;http://www.codinghorror.com/blog/&quot; Location=&quot;El Cerrito, CA&quot; Age=&quot;40&quot; AboutMe=&quot;&amp;lt;p&amp;gt;&amp;lt;img src=&amp;quot;http://img377.imageshack.us/img377/4074/wargames1xr6.jpg&amp;quot; width=&amp;quot;250&amp;quot;&amp;gt;&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;&amp;lt;a href=&amp;quot;http://www.codinghorror.com/blog/archives/001169.html&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Stack Overflow Valued Associate #00001&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;Wondering how our software development process works? &amp;lt;a href=&amp;quot;http://www.youtube.com/watch?v=08xQLGWTSag&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Take a look!&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&amp;#xA;&quot; Views=&quot;3562&quot; UpVotes=&quot;1995&quot; DownVotes=&quot;31&quot; /&gt; &lt;row Id=&quot;2&quot; Reputation=&quot;697&quot; CreationDate=&quot;2009-04-30T07:08:27.067&quot; DisplayName=&quot;Geoff Dalgas&quot; EmailHash=&quot;b437f461b3fd27387c5d8ab47a293d35&quot; LastAccessDate=&quot;2011-09-05T22:14:06.527&quot; WebsiteUrl=&quot;http://stackoverflow.com&quot; Location=&quot;Corvallis, OR&quot; Age=&quot;34&quot; AboutMe=&quot;&amp;lt;p&amp;gt;Developer on the StackOverflow team. Find me on&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;&amp;lt;a href=&amp;quot;http://www.twitter.com/SuperDalgas&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Twitter&amp;lt;/a&amp;gt;&amp;#xA;&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;&amp;#xA;&amp;lt;a href=&amp;quot;http://blog.stackoverflow.com/2009/05/welcome-stack-overflow-valued-associate-00003/&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Stack Overflow Valued Associate #00003&amp;lt;/a&amp;gt; &amp;lt;/p&amp;gt;&amp;#xA;&quot; Views=&quot;291&quot; UpVotes=&quot;46&quot; DownVotes=&quot;2&quot; /&gt; &lt;row Id=&quot;3&quot; Reputation=&quot;259&quot; CreationDate=&quot;2009-04-30T07:08:27.067&quot; DisplayName=&quot;Jarrod Dixon&quot; EmailHash=&quot;2dfa19bf5dc5826c1fe54c2c049a1ff1&quot; LastAccessDate=&quot;2011-09-01T20:43:27.743&quot; WebsiteUrl=&quot;http://stackoverflow.com&quot; Location=&quot;New York, NY&quot; Age=&quot;32&quot; AboutMe=&quot;&amp;lt;p&amp;gt;&amp;lt;a href=&amp;quot;http://blog.stackoverflow.com/2009/01/welcome-stack-overflow-valued-associate-00002/&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;Developer on the Stack Overflow team&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;p&amp;gt;Was dubbed &amp;lt;strong&amp;gt;SALTY SAILOR&amp;lt;/strong&amp;gt; by Jeff Atwood, as filth and flarn would oft-times fly when dealing with a particularly nasty bug!&amp;lt;/p&amp;gt;&amp;#xA;&amp;#xA;&amp;lt;ul&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;Twitter me: &amp;lt;a href=&amp;quot;http://twitter.com/jarrod_dixon&amp;quot; rel=&amp;quot;nofollow&amp;quot;&amp;gt;jarrod_dixon&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;li&amp;gt;Email me: jarrod.m.dixon@gmail.com&amp;lt;/li&amp;gt;&amp;#xA;&amp;lt;/ul&amp;gt;&amp;#xA;&quot; Views=&quot;210&quot; UpVotes=&quot;259&quot; DownVotes=&quot;4&quot; /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

我猜您正在寻找的是一个SAX解析器 ，它不会一次读取整个文档（就像DOM解析器一样），但是可以为特定事件定义回调（例如，新XML元素的开头） ）。 由于您要逐个元素地处理声音，因此听起来非常适合您。 我必须承认，我从未在C ++中进行过任何XML解析，但是他的两个库听起来很适合您的问题：


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../c如何检测当前会话是否通过RDP启动堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../c如何检测当前会话是否通过RDP启动堆栈内存溢出.html" itemprop="url">c如何检测当前会话是否通过RDP启动堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
How to detect if current session was started via RDP?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
考虑到Windows计算机上有一个正在运行的进程（C＃/。NET，以标准用户身份运行-没有任何管理权限），我希望该进程检查登录会话的启动方式-以终端服务/ RDP或交互式登录方式到控制台？


我所能找到的只是会话的当前状态。 但是我对它的当前状态（可以改变）不是很感兴趣，而对它的开始方式很感兴趣。


我花了一些时间对此进行研究，但找不到任何有用的东西。


更新1（不起作用）


我决定尝试一种搜索“ rdp”的方法，例如父流程，并提出了以下代码段：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static void ShowParentsToRoot() &#123; var process = Process.GetCurrentProcess(); while (process != null) &#123; Console.WriteLine($&quot;Process: processID = &#123;process.Id&#125;, processName = &#123;process.ProcessName&#125;&quot;); process = ParentProcessUtilities.GetParentProcess(process.Id); &#125; &#125;</span><br></pre></td></tr></table></figure>


我从这里借来了GetParentProcess代码。


而且它不起作用。 在交互式控制台会话中启动时，它会给我类似以下内容：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Process: processID = 11836, processName = My.App Process: processID = 27800, processName = TOTALCMD64 Process: processID = 6092, processName = explorer</span><br></pre></td></tr></table></figure>


如果在新的（新的登录名，不同的用户）mstsc会话中启动，结果是相同的（PID当然是不同的）。 有什么建议么？


更新2（工作）


RbMm提出的解决方案正是需要的。 原始代码是C ++，因此我努力提供了C＃版本。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class StackSample &#123; [Flags] public enum TokenAccess : uint &#123; STANDARD_RIGHTS_REQUIRED = 0x000F0000, TOKEN_ASSIGN_PRIMARY = 0x0001, TOKEN_DUPLICATE = 0x0002, TOKEN_IMPERSONATE = 0x0004, TOKEN_QUERY = 0x0008, TOKEN_QUERY_SOURCE = 0x0010, TOKEN_ADJUST_PRIVILEGES = 0x0020, TOKEN_ADJUST_GROUPS = 0x0040, TOKEN_ADJUST_DEFAULT = 0x0080, TOKEN_ADJUST_SESSIONID = 0x0100, TOKEN_ALL_ACCESS = STANDARD_RIGHTS_REQUIRED | TOKEN_ASSIGN_PRIMARY | TOKEN_DUPLICATE | TOKEN_IMPERSONATE | TOKEN_QUERY | TOKEN_QUERY_SOURCE | TOKEN_ADJUST_PRIVILEGES | TOKEN_ADJUST_GROUPS | TOKEN_ADJUST_DEFAULT | TOKEN_ADJUST_SESSIONID &#125; [DllImport(&quot;advapi32.dll&quot;, SetLastError = true)] public static extern bool OpenProcessToken(IntPtr ProcessHandle, uint DesiredAccess, out IntPtr TokenHandle); public enum TOKEN_INFORMATION_CLASS : uint &#123; TokenUser = 1, TokenGroups, TokenPrivileges, TokenOwner, TokenPrimaryGroup, TokenDefaultDacl, TokenSource, TokenType, TokenImpersonationLevel, TokenStatistics, TokenRestrictedSids, TokenSessionId, TokenGroupsAndPrivileges, TokenSessionReference, TokenSandBoxInert, TokenAuditPolicy, TokenOrigin &#125; public enum TOKEN_TYPE : uint &#123; TokenPrimary = 0, TokenImpersonation &#125; public enum SECURITY_IMPERSONATION_LEVEL : uint &#123; SecurityAnonymous = 0, SecurityIdentification, SecurityImpersonation, SecurityDelegation &#125; [StructLayout(LayoutKind.Sequential)] public struct LUID &#123; public UInt32 LowPart; public UInt32 HighPart; &#125; [StructLayout(LayoutKind.Explicit, Size = 8)] public struct LARGE_INTEGER &#123; [FieldOffset(0)] public Int64 QuadPart; [FieldOffset(0)] public UInt32 LowPart; [FieldOffset(4)] public Int32 HighPart; &#125; [StructLayout(LayoutKind.Sequential)] public struct TOKEN_STATISTICS &#123; public LUID TokenId; public LUID AuthenticationId; public LARGE_INTEGER ExpirationTime; public TOKEN_TYPE TokenType; public SECURITY_IMPERSONATION_LEVEL ImpersonationLevel; public UInt32 DynamicCharged; public UInt32 DynamicAvailable; public UInt32 GroupCount; public UInt32 PrivilegeCount; public LUID ModifiedId; &#125; [StructLayout(LayoutKind.Sequential)] public struct LSA_UNICODE_STRING &#123; public UInt16 Length; public UInt16 MaximumLength; public IntPtr buffer; &#125; [StructLayout(LayoutKind.Sequential)] public struct SECURITY_LOGON_SESSION_DATA &#123; public UInt32 Size; public LUID LoginID; public LSA_UNICODE_STRING Username; public LSA_UNICODE_STRING LoginDomain; public LSA_UNICODE_STRING AuthenticationPackage; public SECURITY_LOGON_TYPE LogonType; public UInt32 Session; public IntPtr PSiD; public UInt64 LoginTime; public LSA_UNICODE_STRING LogonServer; public LSA_UNICODE_STRING DnsDomainName; public LSA_UNICODE_STRING Upn; &#125; public enum SECURITY_LOGON_TYPE : uint &#123; Interactive = 2, //The security principal is logging on interactively. Network, //The security principal is logging using a network. Batch, //The logon is for a batch process. Service, //The logon is for a service account. Proxy, //Not supported. Unlock, //The logon is an attempt to unlock a workstation. NetworkCleartext, //The logon is a network logon with cleartext credentials. NewCredentials, // Allows the caller to clone its current token and specify new credentials for outbound connections. RemoteInteractive, // A terminal server session that is both remote and interactive. CachedInteractive, // Attempt to use the cached credentials without going out across the network. CachedRemoteInteractive, // Same as RemoteInteractive, except used internally for auditing purposes. CachedUnlock // The logon is an attempt to unlock a workstation. &#125; [DllImport(&quot;advapi32.dll&quot;, SetLastError = true)] public static extern bool GetTokenInformation( IntPtr tokenHandle, TOKEN_INFORMATION_CLASS tokenInformationClass, IntPtr tokenInformation, int tokenInformationLength, out int returnLength); [DllImport(&quot;secur32.dll&quot;)] public static extern uint LsaFreeReturnBuffer(IntPtr buffer); [DllImport(&quot;Secur32.dll&quot;)] public static extern uint LsaGetLogonSessionData(IntPtr luid, out IntPtr ppLogonSessionData); public static String GetLogonType() &#123; if (!OpenProcessToken(Process.GetCurrentProcess().Handle, (uint)TokenAccess.TOKEN_QUERY, out var hToken)) &#123; var lastError = Marshal.GetLastWin32Error(); Debug.Print($&quot;Unable to open process handle. &#123;new Win32Exception(lastError).Message&#125;&quot;); return null; &#125; int tokenInfLength = 0; GetTokenInformation(hToken, TOKEN_INFORMATION_CLASS.TokenStatistics, IntPtr.Zero, tokenInfLength, out tokenInfLength); if (Marshal.SizeOf&lt;TOKEN_STATISTICS&gt;() != tokenInfLength) &#123; var lastError = Marshal.GetLastWin32Error(); Debug.Print($&quot;Unable to determine token information struct size. &#123;new Win32Exception(lastError).Message&#125;&quot;); return null; &#125; IntPtr pTokenInf = Marshal.AllocHGlobal(tokenInfLength); if (!GetTokenInformation(hToken, TOKEN_INFORMATION_CLASS.TokenStatistics, pTokenInf, tokenInfLength, out tokenInfLength)) &#123; var lastError = Marshal.GetLastWin32Error(); Debug.Print($&quot;Unable to get token information. &#123;new Win32Exception(lastError).Message&#125;&quot;); Marshal.FreeHGlobal(pTokenInf); return null; &#125; uint getSessionDataStatus = LsaGetLogonSessionData(IntPtr.Add(pTokenInf, Marshal.SizeOf&lt;LUID&gt;()), out var pSessionData); Marshal.FreeHGlobal(pTokenInf); if (getSessionDataStatus != 0) &#123; Debug.Print(&quot;Unable to get session data.&quot;); return null; &#125; var logonSessionData = Marshal.PtrToStructure&lt;SECURITY_LOGON_SESSION_DATA&gt;(pSessionData); LsaFreeReturnBuffer(pSessionData); if (Enum.IsDefined(typeof(SECURITY_LOGON_TYPE), logonSessionData.LogonType)) &#123; return logonSessionData.LogonType.ToString(); &#125; Debug.Print(&quot;Could not determine logon type.&quot;); return null; &#125; &#125;</span><br></pre></td></tr></table></figure>


谢谢！


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

要检查会话的初始状态（它是如何开始启动的），我们可以调用LsaGetLogonSessionData它返回SECURITY_LOGON_SESSION_DATA ，其中LogonType是标识登录方法的SECURITY_LOGON_TYPE值。 如果会话由RDP启动-您在此处获得了RemoteInteractive 。 用于标识您可以从TOKEN_STATISTICS结构内的自令牌获得的登录会话的LUID- AuthenticationId 请注意，即使在受限的低完整性过程中也可以使用。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> HRESULT GetLogonType(SECURITY_LOGON_TYPE&amp; LogonType )</span><br><span class="line">&#123;</span><br><span class="line">    HANDLE hToken;</span><br><span class="line">    HRESULT hr;</span><br><span class="line"></span><br><span class="line">    if (OpenProcessToken(GetCurrentProcess(), TOKEN_QUERY, &amp;hToken))</span><br><span class="line">    &#123;</span><br><span class="line">        ULONG rcb;</span><br><span class="line">        TOKEN_STATISTICS ts;</span><br><span class="line"></span><br><span class="line">        hr = GetTokenInformation(hToken, ::TokenStatistics, &amp;ts, sizeof(ts), &amp;rcb) ? S_OK : HRESULT_FROM_WIN32(GetLastError());</span><br><span class="line"></span><br><span class="line">        CloseHandle(hToken);</span><br><span class="line"></span><br><span class="line">        if (hr == S_OK)</span><br><span class="line">        &#123;</span><br><span class="line">            PSECURITY_LOGON_SESSION_DATA LogonSessionData;</span><br><span class="line"></span><br><span class="line">            hr = HRESULT_FROM_NT(LsaGetLogonSessionData(&amp;ts.AuthenticationId, &amp;LogonSessionData));</span><br><span class="line"></span><br><span class="line">            if (0 &lt;= hr)</span><br><span class="line">            &#123;</span><br><span class="line">                LogonType = static_cast&lt;SECURITY_LOGON_TYPE&gt;(LogonSessionData-&gt;LogonType);</span><br><span class="line">                LsaFreeReturnBuffer(LogonSessionData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        hr = HRESULT_FROM_WIN32(GetLastError());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return hr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../23/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../23/">23</a><span class="page-number current">24</span><a class="page-number" href="../25/">25</a><span class="space">&hellip;</span><a class="page-number" href="../173/">173</a><a class="extend next" rel="next" href="../25/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="http://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">1724</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
