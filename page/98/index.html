<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客">
<meta property="og:url" content="https://luna.newban.cn/page/98/index.html">
<meta property="og:site_name" content="开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://luna.newban.cn/page/98/">





  <title>开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者的博客 – 全栈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="http://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows101903更新后C组件性能下降堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows101903更新后C组件性能下降堆栈内存溢出.html" itemprop="url">cWindows101903更新后C组件性能下降堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
C++ component performance is down after update Windows 10 1903



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我创建了一些程序的Excel组成部分。 但是，我将Windows 10 1803更新为1809或1903。与更新之前相比，此组件的性能下降了30％。


编程语言是C ++，我在这里发现性能下降。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Excel::_ApplicationPtr pExcel pExcel.CreateInstance (__uuidof (Excel::Application)); pWorkBooks = pExcel-&gt;GetWorkbooks(); pWorkBooks = WorkBooks-&gt;Open( iExcelPath.ConvertToChar() );</span><br></pre></td></tr></table></figure>


请任何人帮助。 谢谢。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows10UWP应用中的SettingsPane有哪些替代方案堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows10UWP应用中的SettingsPane有哪些替代方案堆栈内存溢出.html" itemprop="url">cWindows10UWP应用中的SettingsPane有哪些替代方案堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
What are some alternatives to SettingsPane in Windows 10 UWP apps?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在将8.1 Metro应用程序移植到Windows 10 UWP，但不建议使用SettingsPane。


我知道Microsoft在线提供了准则，但没有实际的实施建议。


我想知道你们是否对前进的道路有所了解。


我提供了关键的代码块来显示我要解决的问题。


我在这里浏览了其他一些问题，所有答复都链接到Microsoft发布的指南。


不幸的是，该文档仅提供一般设计指南，而没有实际的实施建议。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected override void OnWindowCreated(WindowCreatedEventArgs args) &#123; base.OnWindowCreated(args); SettingsPane.GetForCurrentView().CommandsRequested += OnCommandsRequested; &#125; private void OnCommandsRequested(SettingsPane sender, SettingsPaneCommandsRequestedEventArgs args) &#123; AddCommand(args, &quot;Location&quot;, ShowConnectionSettingsFlyout); AddCommand(args, &quot;UI Options&quot;, ShowUISettingsFlyout); &#125; private void AddCommand(SettingsPaneCommandsRequestedEventArgs args, string label, UICommandInvokedHandler handler) &#123; args.Request.ApplicationCommands.Add(new SettingsCommand(label, label, handler)); &#125;</span><br></pre></td></tr></table></figure>


1。


严重性代码说明项目文件行抑制状态错误CS1069在名称空间“ Windows.UI.ApplicationSettings”中找不到类型名称“ SettingsPane”。 此类型已转发给程序集'Windows，版本= 255.255.255.255，文化=中性，PublicKeyToken =空，ContentType = WindowsRuntime'考虑添加对该程序集的引用。 CycleCount C：\\ Users \\ xxxx \\ source \\ repos \\ CycleCount \\ CycleCount \\ App.xaml.cs 245有效


2。


严重性代码说明项目文件行抑制状态错误CS0731在程序集“ Windows”中，类型为“ Windows.UI.ApplicationSettings.SettingsPaneCommandsRequestedEventArgs”的类型转发器导致循环CycleCount C：\\ Users \\ xxxx \\ source \\ repos \\ CycleCount \\ CycleCount \\ App。 xaml.cs 245有效


3。


严重性代码说明项目文件行抑制状态错误CS0103当前上下文中不存在名称“ SettingsPane” CycleCount C：\\ Users \\ xxxx \\ source \\ repos \\ CycleCount \\ CycleCount \\ App.xaml.cs 242有效


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0 已采纳</strong></p>

最常见的方法是创建一个单独的“设置”页面，您可以在其中基本上放置与以前在“设置”窗格中相同的XAML代码。 然后，您需要在UI中放置一些位置来放置设置按钮，通常这是在NavigationView控件中，该控件甚至还有一个特殊的设置区域，可以通过将NavigationView.IsSettingsVisible属性设置为true来显示。 您可以处理此按钮上的click事件，然后导航到设置页面。 这是应用设置的官方指南 。 通常，我会在Windows 10设置应用程序中获得启发，并尝试使界面至少部分匹配其设计，以使用户熟悉它。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows10c在全屏模式下禁用边缘滑动堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows10c在全屏模式下禁用边缘滑动堆栈内存溢出.html" itemprop="url">cWindows10c在全屏模式下禁用边缘滑动堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Windows 10 c# Disable edge swipes in fullscreen mode



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我们有一个用C＃编写的桌面应用程序，在全屏模式下的触摸手势不起作用。 我检查了一些示例代码，很遗憾，我没有成功。 它需要与Windows 10和Windows 8兼容。是否有解决方案？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

从您的描述来看，您似乎想在全屏模式下使用C＃禁用Windows Edge-Swipe，对吗？ 在这种情况下，请参考以下步骤禁用Edge_Swipe。 检测应用程序是否处于全屏模式。 如果您的桌面应用程序是通用应用程序，则可以参考本文 ，然后使用ApplicationView.IsFullScreen属性或ApplicationView.IsFullScreenMode属性检查它是否处于全屏模式。 此外，您可以查看本文和检测全屏模式 。 有两种启用/禁用Windows Edge-Swipe的方法：组策略和注册表。 通过组策略禁用Windows Edge-Swipe。 我们可以导航至系统范围内的计算机配置>管理模板> Windows组件> Edge UI ，或针对当前用户导航至用户配置>管理模板> Windows组件> Edge UI 。 然后，编辑并禁用“ 允许边缘轻扫 ”。 有关更多信息，请单击Windows 10 Edge-Swipe ， 通过注册表禁用Windows边缘轻扫。 我们可以打开注册表编辑器，然后导航到“ HKEY_LOCAL_MACHINE \\ SOFTWARE \\ Policies \\ Microsoft \\ Windows \\ EdgeUI ”，然后设置AllowEdgeSwipe值（（删除）=启用； 0 =禁用）。 更多详细信息，请检查如何在Windows 10中禁用触摸屏边缘滑动 要修改注册表，我们可以使用Registry.SetValue方法 。 要更改组策略，请参考通过C＃编码或使用IGroupPolicyObject 更改组策略。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindowsC控制台应用程序尝试使用msinteropexcel和剪贴板出现了一些问题重复堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindowsC控制台应用程序尝试使用msinteropexcel和剪贴板出现了一些问题重复堆栈内存溢出.html" itemprop="url">cWindowsC控制台应用程序尝试使用msinteropexcel和剪贴板出现了一些问题重复堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
windows c# console app, try to use ms-interop.excel and clipboard, got some problem [duplicate]



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
这个问题已经在这里有了答案：


我想做的是开发一个Windows控制台应用程序，该应用程序可加载excel文件，获取指定范围并导出为jpg / png图像文件。 我尝试使用Microsoft.Office.Interop.Excel和Clipboard来执行此操作，但是将excel范围复制到剪贴板的copyPicture方法不起作用。


我正在使用Windows10，Visual Studio 2017，并将我使用的所有参考添加到我的项目中。


这是我的代码：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">using System; using System.Windows.Forms; using System.Drawing; using Excel = Microsoft.Office.Interop.Excel; namespace ConsoleApp1 &#123; class Program &#123; static void Main(string[] args) &#123; Excel.Application xlApp; Excel.Workbook xlWorkBook; Excel.Worksheet xlWorkSheet; Excel.Range range; string str; int rCnt = 0; int cCnt = 0; object misValue = System.Reflection.Missing.Value; xlApp = new Excel.Application(); xlWorkBook = xlApp.Workbooks.Open(@&quot;C:\Users\Public\Documents\testex.xlsx&quot;, 0, true, 5, &quot;&quot;, &quot;&quot;, true, Microsoft.Office.Interop.Excel.XlPlatform.xlWindows, &quot;\t&quot;, false, false, 0, true, 1, 0); xlWorkSheet = (Excel.Worksheet)xlWorkBook.Worksheets.get_Item(1); Excel.Range rg = xlWorkSheet.Range[&quot;A1:B2&quot;]; rg.CopyPicture(Excel.XlPictureAppearance.xlScreen, Excel.XlCopyPictureFormat.xlBitmap); if (Clipboard.GetDataObject() != null) &#123; IDataObject data = Clipboard.GetDataObject(); if (data.GetDataPresent(DataFormats.Bitmap)) &#123; Image image = (Image)data.GetData(DataFormats.Bitmap, true); image.Save(@&quot;C:\Users\Public\Documents\testexcel.jpg&quot;, System.Drawing.Imaging.ImageFormat.Jpeg); &#125; &#125; Console.Read(); &#125; &#125; &#125;</span><br></pre></td></tr></table></figure>


在我的代码中，一切都可以运行。 但是Clipboard.GetDataObject()为空。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

最后，我弄清楚原因是我错过了STAThreadAttribute 。 添加后： 这个问题已经解决。 感谢C＃Clipboard返回null，但不能为空 。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">class Program</span><br><span class="line">&#123;</span><br><span class="line">    STAThreadAttribute</span><br><span class="line">    static void Main(string[] args)</span><br><span class="line">    &#123;</span><br><span class="line">        // things about clipboard</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindowsDLL插件加载时崩溃堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindowsDLL插件加载时崩溃堆栈内存溢出.html" itemprop="url">cWindowsDLL插件加载时崩溃堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
crash in Windows dll plugin on load



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
寻找有关在加载dll时在Windows中导致此类崩溃的建议。


我正在用C ++编写Windows VST3 .dll插件，并在加载我的.dll时启动时崩溃。 通过Visual Studio 2019调试器运行主机应用程序和插件时，出现上述Access violation executing location ...对话框，并且调用堆栈为空，使我认为内存已完全损坏。


也许这是由于生成.dll时需要调整的链接选项引起的？


以下是一些事实：


不幸的是，将整个空白的VST3插件放在一起是太多代码，无法在StackOverflow问题中发布。 但是，因为如果我注释掉对第三方库的所有调用，就可以使插件正常工作，所以我认为代码本身不是问题，因此我认为dll（.vst3）文件的构建方式是问题所在。


构建.vst3 dll文件的CMakeLists.txt文件的关键部分如下所示：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FIND_LIBRARY ( SuperpoweredSDK NAMES SuperpoweredWin141_Debug_MD_x64.lib PATHS $&#123;SUPERPOWERED_DIR&#125;/libWindows ) SET ( TEST_EXTERNAL_DEPS PRIVATE Threads::Threads $&#123;SuperpoweredSDK&#125; ) FILE ( GLOB JUCE_SOURCE $&#123;CMAKE_HOME_DIRECTORY&#125;/JuceLibraryCode/*.cpp ) LIST ( FILTER JUCE_SOURCE EXCLUDE REGEX &quot;.+/JuceLibraryCode/include_juce_audio_plugin_client_[^u].+&quot; ) FILE ( GLOB PLUGIN_SOURCE *.cpp ) ADD_LIBRARY ( TestVST3 SHARED $&#123;JUCE_SOURCE&#125; $&#123;PLUGIN_SOURCE&#125; $&#123;CMAKE_HOME_DIRECTORY&#125;/JuceLibraryCode/include_juce_audio_plugin_client_VST3.cpp ) SET_TARGET_PROPERTIES ( TestVST3 PROPERTIES OUTPUT_NAME &quot;Test&quot; SUFFIX &quot;.vst3&quot; ) TARGET_LINK_LIBRARIES ( TestVST3 PUBLIC $&#123;TEST_EXTERNAL_DEPS&#125; )</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

加载dll时会在Windows中导致此类崩溃的原因 典型的原因是一些全局变量的初始化。 加载DLL时将崩溃的示例代码： 当您链接外部库但不调用它时，链接器的无效代码清除功能通常会删除已链接但未使用的完整.obj文件。 这也会将变量及其构造函数放到那里。 一种调试方式是在DllMain上设置断点。 但是实际上您已导出的代码中的DllMain不是另一个。 在VC ++ 2017 CRT中，一个名为dllmain_dispatch ，其源文件位于VC ++运行时， crt\\src\\vcruntime\\dll_dllmain.cpp 。 该dllmain_dispatch会在调用DllMain之前调用几个函数，其中一个函数dllmain_crt_process_attach调用_initterm ，并且实际上会调用所有全局函数的构造函数。 在您的情况下，其中至少有一个失败。 PS这样的崩溃的可能原因，您的第三方库尝试使用COM，而名为LoadLibrary的线程从未调用CoInitialize（）。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> class C</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    C() &#123; __debugbreak(); &#125; // Compiles into `int 3` interrupt, will definitely crash</span><br><span class="line">&#125;;</span><br><span class="line">static C g_c;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindowsSCexe如何查询服务上的控制代码堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindowsSCexe如何查询服务上的控制代码堆栈内存溢出.html" itemprop="url">cWindowsSCexe如何查询服务上的控制代码堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Windows SC.exe how to query control codes on a service



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我做了什么


我正在尝试在名为MyTestService的自定义Windows服务中实现ServiceBase.OnCustomCommand(int command) ，该自定义命令代码已在此答案中完成：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public enum MyCustomCommands &#123; ExecuteScript = 128 &#125;;</span><br></pre></td></tr></table></figure>


我注意到在128处启动自定义命令值是很常见的。


我试图实现自定义命令代码，如下所示：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public enum MyCustomCommandCodes &#123; Test1 = 1, Test2 = 2, &#125; protected override void OnCustomCommand(int command) &#123; switch (command) &#123; case (int)MyCustomCommandCodes.Test1: eventLog1.WriteEntry(&quot;Test1&quot;); break; case (int)MyCustomCommandCodes.Test2: eventLog1.WriteEntry(&quot;Test2&quot;); break; default: eventLog1.WriteEntry(&quot;default&quot;); break; &#125; &#125;</span><br></pre></td></tr></table></figure>


我正在使用Window的命令行实用程序Service Control（SC）调用OnCustomCommand 。


当我进入sc control MyTestService 1 ，发现不是调用案例Test1 ，而是实际上停止了该服务。


在我看来，这解释了为什么人们在128处开始命令值，这是为了防止与已经使用的代码重叠。


我希望能够看到Windows服务已经使用了哪些控制代码。


问题分为两部分 ：


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

根据@madreflection的注释，指出了ControlService函数： https ://docs.microsoft.com/zh-cn/windows/win32/api/winsvc/nf-winsvc-controlservice 用户定义的控制代码范围： 128 to 255 。 并且还说明了为什么sc control MyTestService 1停止服务，这是因为0x1对应于SERVICE_CONTROL_STOP控制代码。 这从另一个方向回答了我的问题，Microsoft提供了一个查找表。 仍然欢迎任何其他显示控制代码查询功能的答案:)


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindowsWFP驱动程序在ClassifyFn回调中处理数据包时获取BSOD堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindowsWFP驱动程序在ClassifyFn回调中处理数据包时获取BSOD堆栈内存溢出.html" itemprop="url">cWindowsWFP驱动程序在ClassifyFn回调中处理数据包时获取BSOD堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Windows WFP Driver: Getting BSOD when processing packets in ClassifyFn callback



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在尝试编写一个简单的防火墙应用程序，该应用程序可以允许或阻止从用户级进程进行的网络连接尝试。


为此，在WFPStarterKit教程之后，我创建了一个WFP驱动程序，该驱动程序设置为在FWPM_LAYER_OUTBOUND_TRANSPORT_V4层截取数据。


ClassifyFn回调函数负责拦截连接尝试，并允许或拒绝它。


击中ClassifyFn回调后，数据包的ProcessID以及其他一些信息将通过FltSendMessage函数发送到用户级进程。


用户级进程接收消息，检查ProcessID，然后向驱动程序回复布尔允许/拒绝命令。


尽管此方法在阻止第一个数据包时有效，但在某些情况下（尤其是在允许多个数据包时），该代码会生成带有INVALID_PROCESS_ATTACH_ATTEMPT错误代码的BSOD。 该错误是在调用FltSendMessage时触发的。


虽然我仍然无法查清确切的问题，但似乎在某些情况下，使标注线程等待（通过FltSendMessage）以等待用户级别的答复可能会产生此BSOD错误。


如果您能指出正确的方向，我将不胜感激。


这是我注册标注的函数：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NTSTATUS register_example_callout(DEVICE_OBJECT * wdm_device) &#123; NTSTATUS status = STATUS_SUCCESS; FWPS_CALLOUT s_callout = &#123; 0 &#125;; FWPM_CALLOUT m_callout = &#123; 0 &#125;; FWPM_DISPLAY_DATA display_data = &#123; 0 &#125;; if (filter_engine_handle == NULL) return STATUS_INVALID_HANDLE; display_data.name = EXAMPLE_CALLOUT_NAME; display_data.description = EXAMPLE_CALLOUT_DESCRIPTION; // Register a new Callout with the Filter Engine using the provided callout functions s_callout.calloutKey = EXAMPLE_CALLOUT_GUID; s_callout.classifyFn = example_classify; s_callout.notifyFn = example_notify; s_callout.flowDeleteFn = example_flow_delete; status = FwpsCalloutRegister((void *)wdm_device, &amp;s_callout, &amp;example_callout_id); if (!NT_SUCCESS(status)) &#123; DbgPrint(&quot;Failed to register callout functions for example callout, status 0x%08x&quot;, status); goto Exit; &#125; // Setup a FWPM_CALLOUT structure to store/track the state associated with the FWPS_CALLOUT m_callout.calloutKey = EXAMPLE_CALLOUT_GUID; m_callout.displayData = display_data; m_callout.applicableLayer = FWPM_LAYER_OUTBOUND_TRANSPORT_V4; m_callout.flags = 0; status = FwpmCalloutAdd(filter_engine_handle, &amp;m_callout, NULL, NULL); if (!NT_SUCCESS(status)) &#123; DbgPrint(&quot;Failed to register example callout, status 0x%08x&quot;, status); &#125; else &#123; DbgPrint(&quot;Example Callout Registered&quot;); &#125; Exit: return status; &#125;</span><br></pre></td></tr></table></figure>


这是标注函数：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/************************* ClassifyFn Function **************************/ void example_classify( const FWPS_INCOMING_VALUES * inFixedValues, const FWPS_INCOMING_METADATA_VALUES * inMetaValues, void * layerData, const void * classifyContext, const FWPS_FILTER * filter, UINT64 flowContext, FWPS_CLASSIFY_OUT * classifyOut) &#123; UNREFERENCED_PARAMETER(layerData); UNREFERENCED_PARAMETER(classifyContext); UNREFERENCED_PARAMETER(flowContext); UNREFERENCED_PARAMETER(filter); UNREFERENCED_PARAMETER(inMetaValues); NETWORK_ACCESS_QUERY AccessQuery; BOOLEAN SafeToOpen = TRUE; classifyOut-&gt;actionType = FWP_ACTION_PERMIT; AccessQuery.remote_address = inFixedValues-&gt;incomingValue[FWPS_FIELD_OUTBOUND_TRANSPORT_V4_IP_REMOTE_ADDRESS].value.uint32; AccessQuery.remote_port = inFixedValues-&gt;incomingValue[FWPS_FIELD_OUTBOUND_TRANSPORT_V4_IP_REMOTE_PORT].value.uint16; // Get Process ID AccessQuery.ProcessId = (UINT64)PsGetCurrentProcessId(); if (!AccessQuery.ProcessId) &#123; return; &#125; // Here we connect to our userlevel application using FltSendMessage. // Some checks are done and the SafeToOpen variable is populated with a BOOLEAN which indicates if to allow or block the packet. // However, sometimes, a BSOD is generated with an INVALID_PROCESS_ATTACH_ATTEMPT error on the FltSendMessage call QueryUserLevel(QUERY_NETWORK, &amp;AccessQuery, sizeof(NETWORK_ACCESS_QUERY), &amp;SafeToOpen, NULL, 0); if (!SafeToOpen) &#123; classifyOut-&gt;actionType = FWP_ACTION_BLOCK; &#125; return; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows上的sfMusicapimswincrtlocalel110dll无法打开共享对象文件堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows上的sfMusicapimswincrtlocalel110dll无法打开共享对象文件堆栈内存溢出.html" itemprop="url">cWindows上的sfMusicapimswincrtlocalel110dll无法打开共享对象文件堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
sf::Music on Windows: api-ms-win-crt-locale-l1-1-0.dll: cannot open shared object file



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我试图在Windows上使用SFML，但是当我使用sf :: Music时，我的应用程序崩溃并显示以下错误消息：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error while loading shared libraries: api-ms-win-crt-locale-l1-1-0.dll: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>


我在Windows 10 1909上使用SFML 2.5.1。


有人请知道如何解决该问题吗？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0 已采纳</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows函数NetUserChangePassword不再在Windows10下运行在Windows7下运行堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows函数NetUserChangePassword不再在Windows10下运行在Windows7下运行堆栈内存溢出.html" itemprop="url">cWindows函数NetUserChangePassword不再在Windows10下运行在Windows7下运行堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Windows function “NetUserChangePassword” is no longer working under Windows 10 (worked under Windows 7)



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在使用MSDN页面上的以下代码示例来更改用户的网络密码（ https://docs.microsoft.com/zh-cn/windows/win32/api/lmaccess/nf-lmaccess-netuserchangepassword ）：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#ifndef UNICODE #define UNICODE #endif #pragma comment(lib, &quot;netapi32.lib&quot;) #include &lt;stdio.h&gt; #include &lt;windows.h&gt; #include &lt;lm.h&gt; int wmain(int argc, wchar_t *argv[]) &#123; DWORD dwError = 0; NET_API_STATUS nStatus; // // All parameters are required. // if (argc != 5) &#123; fwprintf(stderr, L&quot;Usage: %s \\\\ServerName UserName OldPassword NewPassword\n&quot;, argv[0]); exit(1); &#125; // // Call the NetUserChangePassword function. // nStatus = NetUserChangePassword(argv[1], argv[2], argv[3], argv[4]); // // If the call succeeds, inform the user. // if (nStatus == NERR_Success) fwprintf(stderr, L&quot;User password has been changed successfully\n&quot;); // // Otherwise, print the system error. // else fprintf(stderr, &quot;A system error has occurred: %d\n&quot;, nStatus); return 0; &#125;</span><br></pre></td></tr></table></figure>


在Windows 7下，可以使用此程序更改用户密码。 例：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; NetUserChangePassword.exe \\192.168.1.2 TestUser TestPassword TestPassword &gt; User password has been changed successfully</span><br></pre></td></tr></table></figure>


在Windows 10下，完全相同的程序不再起作用：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; NetUserChangePassword.exe \\192.168.1.2 TestUser TestPassword TestPassword &gt; A system error has occurred: 5</span><br></pre></td></tr></table></figure>


两台计算机（Win7和Win10）上的安全设置相同，并且防火墙已关闭。 如何解决此问题的想法将不胜感激！


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

如果您正在为Active Directory编程，则可以调用IADsUser::ChangePassword方法来获得与调用NetUserChangePassword函数可以实现的结果相同的结果。 如果应用程序在运行Active Directory的域控制器上调用NetUserChangePassword函数，则默认ACL仅允许域管理员和帐户操作员调用此函数。 在成员服务器或工作站上，只有管理员和超级用户可以调用此功能。 用户可以更改自己的密码。 在某些情况下，调用NetUserChangePassword函数的进程还必须启用SE_CHANGE_NOTIFY_NAME特权。 因此，您需要检查两个信息： 您的程序所运行的帐户是否符合要求的特权？ 例如，要查找帐户所扮演的角色，可以使用以下代码示例（在C＃中）。 请参考WindowsPrincipal.IsInRole方法。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AppDomain myDomain = Thread.GetDomain(); myDomain.SetPrincipalPolicy(PrincipalPolicy.WindowsPrincipal); WindowsPrincipal myPrincipal = (WindowsPrincipal)Thread.CurrentPrincipal; Console.WriteLine(&quot;&#123;0&#125; belongs to: &quot;, myPrincipal.Identity.Name.ToString()); Console.WriteLine(&quot;&#123;0&#125;? &#123;1&#125;.&quot;, &quot;Domain Admins&quot;, myPrincipal.IsInRole(&quot;Domain Admins&quot;)); Console.WriteLine(&quot;&#123;0&#125;? &#123;1&#125;.&quot;, &quot;AccountOperator&quot;, myPrincipal.IsInRole(WindowsBuiltInRole.AccountOperator)); Console.WriteLine(&quot;&#123;0&#125;? &#123;1&#125;.&quot;, &quot;Administrators&quot;, myPrincipal.IsInRole(WindowsBuiltInRole.Administrator)); Console.WriteLine(&quot;&#123;0&#125;? &#123;1&#125;.&quot;, &quot;PowerUser&quot;, myPrincipal.IsInRole(WindowsBuiltInRole.PowerUser));</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWindows在atexit处理程序中获取exit设置的当前进程退出代码堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWindows在atexit处理程序中获取exit设置的当前进程退出代码堆栈内存溢出.html" itemprop="url">cWindows在atexit处理程序中获取exit设置的当前进程退出代码堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Windows in atexit() handler getting the current process exit code set by ::exit()



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我在linux上使用on_exit() ，该函数获取退出代码作为参数。 我想在Windows上实现相同的功能，并且没有提供此功能的API。


我的想法是调用GetExitCodeProcess(GetCurrentProcess(), &exitcode) STILL_ACTIVE (259) GetExitCodeProcess(GetCurrentProcess(), &exitcode) ，但是它给了我STILL_ACTIVE (259) 。


在文档（ https://docs.microsoft.com/zh-cn/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess ）中指出，最后一件事情发生在退出过程中，实际的退出代码替换了STILL_ACTIVE 。 我可以以某种方式获取真实的退出代码吗？ 我知道::exit()被调用了，因为正在运行的功能是由atexit()注册的。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

获取退出代码的最简单方法是另一个保护进程。 如果不是这种选择，则可以挂钩ExitProcess函数并从中获取退出代码。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../97/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../97/">97</a><span class="page-number current">98</span><a class="page-number" href="../99/">99</a><span class="space">&hellip;</span><a class="page-number" href="../173/">173</a><a class="extend next" rel="next" href="../99/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="http://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">1724</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
