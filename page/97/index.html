<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="../../css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="../../images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="../../images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="../../images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="../../images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="../../atom.xml" title="开发者博客" type="application/atom+xml">






<meta property="og:type" content="website">
<meta property="og:title" content="开发者博客">
<meta property="og:url" content="https://luna.newban.cn/page/97/index.html">
<meta property="og:site_name" content="开发者博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="开发者博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<!--谷歌广告验证代码-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-2626449904708114",
          enable_page_level_ads: true
     });
</script>
<!--谷歌广告验证代码-->



  <link rel="canonical" href="https://luna.newban.cn/page/97/">





  <title>开发者博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
  
<a href="https://www.github.com/songjianzaina" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">开发者博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">开发者的博客 – 全栈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="http://www.newban.cn/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="http://code.newban.cn/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWINDOWS如何查找程序的内存地址是否静态堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWINDOWS如何查找程序的内存地址是否静态堆栈内存溢出.html" itemprop="url">cWINDOWS如何查找程序的内存地址是否静态堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
WINDOWS How to find whether a memory address is static to the program



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWPF中的Moveble标签输入控件堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWPF中的Moveble标签输入控件堆栈内存溢出.html" itemprop="url">cWPF中的Moveble标签输入控件堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Moveble tag input control in WPF



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
寻找WPF控件的解决方案，该解决方案可以将标签控件添加到画布中并且可以移动。


https://imgur.com/K6zYc0a


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWPF信息亭应用程序C的特定光标速度堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWPF信息亭应用程序C的特定光标速度堆栈内存溢出.html" itemprop="url">cWPF信息亭应用程序C的特定光标速度堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Cursor speed specific to a WPF kiosk application C#



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
在WPF应用程序中处理鼠标速度变化的最佳方法是什么？


编辑更多上下文：


我正在开发将在Windows 10中运行的信息亭应用程序。它具有自己的鼠标速度控制设置页面，并且默认速度比正常速度慢得多。 我之前的程序员让应用程序在指针进入应用程序边界时将信息亭应用程序的指针速度设置为默认值，并检查指针是否超出界限以恢复速度。


所以我和我的团队遇到的问题是开发过程中。 如果系统鼠标速度在Visual Studio中达到断点，则保持设置为信息亭应用程序的速度。 在生产中，不应出现这种情况，因为用户将无法离开应用程序。 这就是为什么我很难找到一种改变鼠标速度的更好方法的原因。


这个问题要求类似的东西，但不是我想要的东西。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1</strong></p>

您已经回答了您的问题。 在回车时设置系统鼠标速度，并在回车时重置它。 在应用程序关闭时将其重置。 将原始鼠标速度存储在某个静态变量中。 看一下这个线程： 动态更改鼠标速度 您可以捕获所有未处理的异常： 然后，如果出现任何未处理的错误，请重置鼠标光标速度。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> // UI exceptions</span><br><span class="line">Application.ThreadException += HandleErrorUI;</span><br><span class="line"></span><br><span class="line">// Set the unhandled exception mode to force all Windows Forms errors</span><br><span class="line">// to go through our handler.</span><br><span class="line">Application.SetUnhandledExceptionMode(UnhandledExceptionMode.CatchException);</span><br><span class="line"></span><br><span class="line">// Add the event handler for handling non-UI thread exceptions to the event. </span><br><span class="line">AppDomain.CurrentDomain.UnhandledException += HandleError;</span><br><span class="line">// handle all task exceptions</span><br><span class="line">TaskScheduler.UnobservedTaskException += TaskScheduler_UnobservedTaskException;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWPF如何在保持滚动条功能的同时为文本框设置静态大小堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWPF如何在保持滚动条功能的同时为文本框设置静态大小堆栈内存溢出.html" itemprop="url">cWPF如何在保持滚动条功能的同时为文本框设置静态大小堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
WPF - How do I set a static size to a textbox while maintaining scrollbar functionality



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我有以下内容：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid MinWidth=&quot;800&quot;&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition MinHeight=&quot;430&quot; MaxHeight=&quot;430&quot;&gt;&lt;/RowDefinition&gt; &lt;RowDefinition Height=&quot;Auto&quot;&gt;&lt;/RowDefinition&gt; &lt;/Grid.RowDefinitions&gt; &lt;TextBox Grid.Row=&quot;0&quot; x:Name=&quot;DisplayLogs&quot; Text=&quot;&#123;Binding LogText&#125;&quot; ScrollViewer.VerticalScrollBarVisibility=&quot;Visible&quot; IsReadOnly=&quot;True&quot; TextWrapping=&quot;Wrap&quot; /&gt; ... &lt;/Grid&gt;</span><br></pre></td></tr></table></figure>


由于设置了MaxHeight我不再能够滚动。 我尝试了很多事情的组合，但没有成功。


如何在仍然可以使用TextBox滚动条的同时将TextBox设置为静态大小？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

MinWidth =“ 800”导致问题。 尝试将其删除。 具有MinHeight =“ 430” MaxHeight =“ 430”的文本框容器应包含大量文本，然后才能激活滚动查看器。


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWPF调整大小的位图图像上的工件堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWPF调整大小的位图图像上的工件堆栈内存溢出.html" itemprop="url">cWPF调整大小的位图图像上的工件堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
WPF - artifacts on bitmap image on resize



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在C＃（WPF）中实现错误扩散算法（颜色减少），并且正在使用writeableBitmap。 以下函数打开带有计算图像的新窗口：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private void OpenNewWindow() &#123; // TODO: Bug with image resizes const int margin = 50; currAlgWindow = new Window &#123; Owner = this &#125;; var w = algorithmBitmap.Width; var h = algorithmBitmap.Height; var canvas = new Canvas &#123; Width = w + margin * 2, Height = h + margin * 2 &#125;; var img = new Image &#123; Source = algorithmBitmap &#125;; Canvas.SetLeft(img, (canvas.Width - w) / 2); Canvas.SetTop(img, (canvas.Height - h) / 2); canvas.Children.Add(img); currAlgWindow.SizeToContent = SizeToContent.WidthAndHeight; currAlgWindow.Content = canvas; currAlgWindow.WindowStartupLocation = WindowStartupLocation.CenterOwner; currAlgWindow.Show(); &#125;</span><br></pre></td></tr></table></figure>


我遇到的最奇怪的问题是，在调整新Window的大小时，即使在任何地方都没有onSizeChanged事件，分配的图像也会发生变化 。 例： 1. currAlgWindow.Show()之后的图片 2.调整窗口大小后的图像。 3.进一步调整大小后的图像


移动窗口也会稍微改变图像（可见刷新）。 所有问题都不会在原始图像上发生，而只会在计算出的图像上发生。 我还提供算法代码：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Algorithm &#123; protected WriteableBitmap bitmap; protected byte[] originalCopy; protected int bytesPerPixel; protected int width; protected int height; protected Algorithm() &#123; &#125; public virtual WriteableBitmap Bitmap &#123; get =&gt; bitmap; set &#123; bitmap = value; bytesPerPixel = (bitmap.Format.BitsPerPixel + 7) / 8; width = bitmap.PixelWidth; height = bitmap.PixelHeight; originalCopy = new byte[height * bitmap.BackBufferStride]; bitmap.CopyPixels(originalCopy, bitmap.BackBufferStride, 0); &#125; &#125; public abstract void Apply(int Kr, int Kg, int Kb); protected static int RoundToNeareastMultiple(int num, int multiple) &#123; return (int)(((num + multiple / 2) / multiple) * multiple); &#125; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class ErrorDiffusionDithering : Algorithm &#123; public ErrorDiffusionDithering(WriteableBitmap imageBitmap) &#123; this.Bitmap = imageBitmap; &#125; public override void Apply(int Kr, int Kg, int Kb) &#123; int itR = 255 / (Kr - 1); int itG = 255 / (Kg - 1); int itB = 255 / (Kb - 1); var bmpRect = new System.Windows.Int32Rect(0, 0, width, height); bitmap.WritePixels(bmpRect, originalCopy, bitmap.BackBufferStride, 0); // Copy cached original image bitmap.Lock(); unsafe &#123; byte* bmpArray = (byte*)bitmap.BackBuffer.ToPointer(); for (int i = 0; i &lt; height; ++i) &#123; byte* currPos = bmpArray + i * bitmap.BackBufferStride; Position row = GetPos(i, height); for (int j = 0; j &lt; width; ++j) &#123; Position col = GetPos(j, width); byte newVal = RoundToNeareastMultiple(currPos[0], itB).ToByte(); PropagateError(currPos[0] - newVal, 0, currPos, row, col); currPos[0] = newVal; newVal = RoundToNeareastMultiple(currPos[1], itG).ToByte(); PropagateError(currPos[1] - newVal, 1, currPos, row, col); currPos[1] = newVal; newVal = RoundToNeareastMultiple(currPos[2], itR).ToByte(); PropagateError(currPos[2] - newVal, 2, currPos, row, col); currPos[2] = newVal; currPos += bytesPerPixel; &#125; &#125; &#125; bitmap.AddDirtyRect(bmpRect); bitmap.Unlock(); &#125; private unsafe void PropagateError(int error, int colorNum, byte* currPos, Position row, Position col) &#123; // x - from left to right // y - from top to bottom int ind; if (col != Position.Last) &#123; ind = bytesPerPixel + colorNum; // pixel[x + 1][y] := pixel[x + 1][y] + quant_error * 7 / 16 currPos[ind] = (currPos[ind] + ((error * 7) &gt;&gt; 4)).ToByte(); &#125; if (row != Position.Last) &#123; if (col != Position.First) &#123; ind = bitmap.BackBufferStride - bytesPerPixel + colorNum; // pixel[x - 1][y + 1] := pixel[x - 1][y + 1] + quant_error * 3 / 16 currPos[ind] = (currPos[ind] + ((error * 3) &gt;&gt; 4)).ToByte(); &#125; ind = bitmap.BackBufferStride + colorNum; // pixel[x][y + 1] := pixel[x][y + 1] + quant_error * 5 / 16 currPos[ind] = (currPos[ind] + ((error * 5) &gt;&gt; 4)).ToByte(); if (col != Position.Last) &#123; ind = bitmap.BackBufferStride + bytesPerPixel + colorNum; //pixel[x + 1][y + 1] := pixel[x + 1][y + 1] + quant_error * 1 / 16 currPos[ind] = (currPos[ind] + ((error * 1) &gt;&gt; 4)).ToByte(); &#125; &#125; &#125; private enum Position &#123; First, Last, Other &#125;; private Position GetPos(int r, int dim) &#123; return r == dim - 1 ? Position.Last : r == 0 ? Position.First : Position.Other; &#125; &#125;</span><br></pre></td></tr></table></figure>


此外，在此处可以看到的图片上的工件外观与在计算机上所看到的外观不同-例如，将其保存为其他格式后，将以其他方式显示。 我还在另一台计算机上测试了该应用程序，并且没有出现该问题。 我对造成问题的真正原因完全感到困惑-屏幕，系统，软件，代码？


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWSALookupServiceBegin上的错误代码10022无效的预订堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWSALookupServiceBegin上的错误代码10022无效的预订堆栈内存溢出.html" itemprop="url">cWSALookupServiceBegin上的错误代码10022无效的预订堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Error code 10022 (Invalid arugment) on WSALookupServiceBegin()



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我目前正在尝试使用Window Winsock API进行蓝牙设备发现。 我是C和C ++编码的新手，如果在这里有任何愚蠢的错误，我深表歉意。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;winsock2.h&gt; #include &lt;ws2tcpip.h&gt; #include &lt;ws2bth.h&gt; #include &lt;stdio.h&gt; #pragma comment(lib, &quot;ws2_32.lib&quot;) int main() &#123; int iResult; // Initialize winsock WSADATA wsaData; iResult = WSAStartup(MAKEWORD(2, 2), &amp;wsaData); if (iResult != 0) &#123; printf(&quot;WSAStartup failed: %d\n&quot;, iResult); return 1; &#125; // Create query parameters WSAQUERYSETW querySet; memset(&amp;querySet, 0, sizeof(querySet)); querySet.dwSize = sizeof(querySet); querySet.dwNameSpace = NS_BTH; // Create flags and handle DWORD flags = LUP_DEEP | LUP_RETURN_ALL; HANDLE handle; // Begin service lookup iResult = WSALookupServiceBeginW(&amp;querySet, flags, &amp;handle); if(iResult != 0) &#123; printf(&quot;Failed to begin service lookup: %d\n&quot;, WSAGetLastError()); return 1; &#125; &#125;</span><br></pre></td></tr></table></figure>


我一直在寻找使用WinSock进行蓝牙设备发现的示例，但是我一直找不到。 我确定我只是在搜索中使用了错误的关键字。 但是，在运行此代码时，它将一直有效到实际调用WSALookupServiceBeginW()为止。 调用此方法时，出现错误代码10022，根据Microsoft文档，这意味着我传递了无效的参数。 但是，我不确定哪个参数无效。 是我的查询参数吗？ 我的旗帜？ 我的querySet？


如果有人知道我在此特定代码块中做错了什么，或者知道一个合适的地方，我可以找到有关如何使用WinSock API的信息，我也将不胜感激。


编辑1：我不是编码新手，只是C和C ++编码（和一般Windows API）。 我不会说我是专家，但是我会说我非常精通Java编程语言。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0</strong></p>

我遇到的问题是我在WSALookupServiceBegin()函数中使用了错误的标志。 这些标志应该包含LUP_CONTAINERS和LUP_FLUSH_CACHE的值，但它们没有。 感谢评论中提供解决方案的人员以及有关如何更好地使用Winsock的更多信息！ :)


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWeb应用程序中的会话超时堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWeb应用程序中的会话超时堆栈内存溢出.html" itemprop="url">cWeb应用程序中的会话超时堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Session timeout in Web appicaltion



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
在aspx Webform应用程序中。 我已将session.timeout设置为10分钟。


但是该网页每5分钟发送一次自动ajax请求（使用javascript计时器）


因此，即使用户闲置超过10分钟也不会发生会话超时。


如果用户保持空闲状态，则用户会话应在10分钟后过期，请勿考虑自动ajax请求。 有没有办法检查上一次手动用户交互时间？


任何解决方案将不胜感激


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：1 已采纳</strong></p>

这是一个使用JQuery的简单脚本，用于处理mousemove和keypress事件。 如果时间到了，页面将重新加载。 客户端 ： c＃代码获取所有会话并设置null ：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    var idleTime = 0;</span><br><span class="line">    $(document).ready(function () &#123;</span><br><span class="line">        //Increment the idle time counter every minute.</span><br><span class="line">        var idleInterval = setInterval(timerIncrement, 60000); // 1 minute</span><br><span class="line"></span><br><span class="line">        //Zero the idle timer on mouse movement.</span><br><span class="line">        $(this).mousemove(function (e) &#123;</span><br><span class="line">            idleTime = 0;</span><br><span class="line">        &#125;);</span><br><span class="line">        $(this).keypress(function (e) &#123;</span><br><span class="line">            idleTime = 0;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    function timerIncrement() &#123;</span><br><span class="line">        idleTime = idleTime + 1;</span><br><span class="line">        if (idleTime &gt; 9) &#123; // 10 minutes</span><br><span class="line">           // Here You&apos;d have to have a little ajax call to server to set all session variable value as null.</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function setAllSessionNull()&#123;</span><br><span class="line">//make ajax call to server to set all session variable value as null.</span><br><span class="line">// redirect to login page</span><br><span class="line">&#125;</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWinAPIC仅在当前版本的Windows中存在时才如何调用API方法堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWinAPIC仅在当前版本的Windows中存在时才如何调用API方法堆栈内存溢出.html" itemprop="url">cWinAPIC仅在当前版本的Windows中存在时才如何调用API方法堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
WinAPI C++ - How to call an API method only if present in the current version of Windows?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
在我的最新项目中，我使用了C Win API SetThreadDpiAwarenessContext方法，并且在Windows 10上运行良好。


我的一位用户使用Windows 8，并且由于该方法仅适用于Windows 10版本1607，因此他遇到了以下错误：


如果我是正确的，则发生此错误，因为Windows 8的API中没有该方法。 现在这是我的问题：


仅当用户使用Windows 10及更高版本时，才可以调用该方法吗？


我需要一种不需要为每个版本重新编译的方法，以便可以将可执行文件分发给所有用户。


我在网上搜索，但很遗憾，找不到任何有用的信息。


期待听到您的反馈，谢谢。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWinAPI如何将程序的所有标准输出和外部DLL重定向到Win32标准输出句柄堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWinAPI如何将程序的所有标准输出和外部DLL重定向到Win32标准输出句柄堆栈内存溢出.html" itemprop="url">cWinAPI如何将程序的所有标准输出和外部DLL重定向到Win32标准输出句柄堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
WinAPI - How to redirect all stdout of a program and external DLLs to the Win32 standard output handle?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我希望能够将Windows应用程序的所有标准输出重定向到Win32标准输出句柄，而不是使用控制台句柄。


对于上下文，Emacs Win32 FAQ表示：


明确使用控制台句柄（CON或CON :）而不是stdin和stdout的程序不能用作Emacs的子进程，并且它们也无法在shell模式下工作。 Emacs或在shell模式下用于将此类进程的输入和输出从控制台重定向到输入和输出管道的任何shell。 唯一的解决方法是使用不直接使用控制台的程序的不同实现。 （ https://www.gnu.org/software/emacs/manual/html_node/efaq-w32/Subprocess-hang.html ）


我遇到了常见问题解答描述的问题：从Emacs启动时，该程序将运行，但是在程序退出之前，其所有输出都不会显示在Emacs的shell窗口中，就像stdout已缓冲并且在运行时未刷新一样。 如果从cmd.exe或ConEmu运行，则该程序将按预期实时输出stdout。


我要完成的是使程序的所有输出都出现在Emacs shell中，以便在打印后立即跳转到编译器错误位置。 我愿意重写程序的源代码来完成此任务。 我想知道通过使用“ stdin和stdout”而不是“控制台的句柄”来完成此操作需要哪些“不同的实现”细节。


据我了解：


我尝试使用此代码：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt; #include &lt;cstdlib&gt; int main() &#123; HANDLE hStdout = CreateFile(L&quot;CONOUT$&quot;, GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL); HANDLE hStdin = CreateFile(L&quot;CONIN$&quot;, GENERIC_READ | GENERIC_WRITE, FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL); SetStdHandle(STD_OUTPUT_HANDLE, hStdout); SetStdHandle(STD_ERROR_HANDLE, hStdout); SetStdHandle(STD_INPUT_HANDLE, hStdin); std::cout &lt;&lt; &quot;Hello, world.&quot; &lt;&lt; std::endl; printf(&quot;Hello, world.\n&quot;); std::cin.get(); return 0; &#125;</span><br></pre></td></tr></table></figure>


这具有预期的效果，但仅对与重定向代码相同的二进制文件中的printf和std::cout用法有效。 我的程序加载了一个使用printf的外部DLL，并且其输出均未重定向。


另外，我也不想使用AllocConsole()或类似的东西，因为那样会打开一个单独的窗口，该窗口不与父进程（Emacs）集成。 我想要的是重定向所有标准输出，以便它显示在运行程序的同一终端/控制台中，而不是显示在其他窗口中（如果有意义）。 因为我不使用AllocConsole()那么这样的代码_open_osfhandle((long)hStdout, O_WRONLY|O_TEXT)总是返回-1出于某种原因，所以好像我不能用dup2()所描述的在这里 。


也可以看看：


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><p><strong>===============&gt;&gt;#1 票数：0 已采纳</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://luna.newban.cn../../cWinapi如何隐藏显示第三方程序窗口堆栈内存溢出.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="开发者">
      <meta itemprop="description" content>
      <meta itemprop="image" content="../../images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="开发者博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="../../cWinapi如何隐藏显示第三方程序窗口堆栈内存溢出.html" itemprop="url">cWinapi如何隐藏显示第三方程序窗口堆栈内存溢出</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-31T00:00:00+00:00">
                2020-08-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="原文标题"><a href="#原文标题" class="headerlink" title="原文标题:"></a>原文标题:</h2>
Winapi how to hide/show a third-party program window?



<h2 id="问题"><a href="#问题" class="headerlink" title="问题:"></a>问题:</h2>
我正在尝试隐藏/显示第三方程序（例如Discord）：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;windows.h&gt; void show_hide(HWND window) &#123; if (IsWindowVisible(window) == TRUE) &#123; ShowWindow(window, SW_HIDE); &#125; else &#123; ShowWindow(window, SW_SHOW); &#125; &#125; BOOL CALLBACK enum_windows_cb(HWND window, const LPARAM lParam) &#123; const char* target = &quot;Discord&quot;; char title[255]; if (GetWindowText(window, title, sizeof(title))) &#123; if (strcmpi(title, target) == 0) &#123; show_hide(window); return FALSE; &#125; &#125; return TRUE; &#125; int main(int argc, char *argv[]) &#123; EnumWindows(&amp;enum_windows_cb, 0); return 0; &#125;</span><br></pre></td></tr></table></figure>


一切正常，但是如果我通过单击关闭按钮隐藏第三方程序，则程序将显示冻结的窗口，直到按下托盘图标。


视频演示： https ： //www.youtube.com/watch？v = P-_Fi-Dew1w


我还通过Microsoft SPY ++ https://pastebin.com/YwGt88yh编写了消息日志


它记录了三个动作：单击关闭按钮隐藏程序，单击托盘图标显示程序，而我的程序尝试显示窗口。


我还尝试在ShowWindow之后一一添加这些功能：


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetForegroundWindow(window); SendMessage(window, WM_SYSCOMMAND, SC_RESTORE, 0); UpdateWindow(window); RedrawWindow(window, 0, nil, RDW_INVALIDATE or RDW_ALLCHILDREN or RDW_UPDATENOW or RDW_FRAME); SendMessage(window, WM_ACTIVATEAPP, TRUE, GetWindowThreadProcessId(window, 0));</span><br></pre></td></tr></table></figure>


但这没有帮助。 我做错什么了？ 我使用Windows 10。


<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="../96/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../96/">96</a><span class="page-number current">97</span><a class="page-number" href="../98/">98</a><span class="space">&hellip;</span><a class="page-number" href="../173/">173</a><a class="extend next" rel="next" href="../98/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">开发者</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="http://code.newban.cn/archives/">
              
                  <span class="site-state-item-count">1724</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="../../atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">开发者</span>
  <div>
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
  </div>
  
</div>


  <div class="powered-by">由 <a rel="external nofollow" class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a rel="external nofollow" class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="../../lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="../../js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="../../js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="../../js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
